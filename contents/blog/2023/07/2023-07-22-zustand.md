---
layout: post
title: zustand
date: 2023-07-22
published: 2023-07-22
category: ê°œë°œ
tags: ['ìƒíƒœê´€ë¦¬']
comments: true,
thumbnail: './assets/22/thumbnail.png'
github: 'https://github.com/seungahhong/states-todos'
---

ì°¸ê³ ì½”ë“œ: [GitHub - seungahhong/states-todos](https://github.com/seungahhong/states-todos)

# ì„¤ì¹˜

```bash
npm install zustand

or

yarn add zustand
```

# zustand ê°œë…

- ìƒíƒœê´€ë¦¬ ì„¤ëª…
  ìš”ì¦˜ ìƒíƒœê´€ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ ë°©ì‹ì„ 3ê°€ì§€ë¡œ ë‚˜ëˆ ì„œ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
  - Flux (Redux, Zustand)
    - ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” Flux ë°©ì‹ìœ¼ë¡œì¨, ì €ì¥ì†Œ(store)/ì•¡ì…˜í•¨ìˆ˜(action)/ë¦¬ë“€ì„œ ë“±ì„ í†µí•´ì„œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ì‹
  - Proxy (Mobx, Valtio)
    - ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš©ë˜ëŠ” ì¼ë¶€ ìƒíƒœë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•´ì„œ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ì‹
  - Atomic (Jotai, Recoil)
    - Reactì— ì‚¬ìš©ë˜ëŠ” stateì™€ ë¹„ìŠ·í•˜ê²Œ ë¦¬ì•¡íŠ¸ íŠ¸ë¦¬ ì•ˆì—ì„œ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ì‹
- zustand ê°œë…
  - store êµ¬í˜„ ë°©ì‹ ë° ë³€ê²½ ë°©ì‹ì´ ê°„ë‹¨í•¨(reduxì— ë¹„í•´ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œê°€ ì ë‹¤)
  - Providerë¡œ ë˜í•‘í•  í•„ìš”ê°€ ì—†ë‹¤.
  - Context APIë¥¼ ì‚¬ìš©í•  ë•Œì™€ ë‹¬ë¦¬ ìƒíƒœ ë³€ê²½ ì‹œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì¼ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.(ë³€ê²½ëœ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸)
  - íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì—®ì´ì§€ ì•ŠëŠ”ë‹¤(Reactì™€ í•¨ê»˜ ì“¸ ìˆ˜ ìˆëŠ” APIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µ â†’ hooks ì œê³µ)
  - í•œ ê°œì˜ ì¤‘ì•™ì— ì§‘ì¤‘ëœ í˜•ì‹ì˜ ìŠ¤í† ì–´ êµ¬ì¡°ë¥¼ í™œìš©í•˜ë©´ì„œ, ìƒíƒœë¥¼ ì •ì˜í•˜ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ë‹¨ìˆœí•˜ë‹¤.
  - reduxë³´ë‹¤ëŠ” flux êµ¬ì¡°ì™€ ìœ ì‚¬í•¨.
  - ë‹¤ì–‘í•œ middleware ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µ(redux, immer, selector(ìƒíƒœë³€ê²½ ì‹œ ìë™ í˜¸ì¶œ), redux-devtools)

# zustand íŠ¹ì§•

- **Fetching everything**
  storeì•ˆì— ìƒíƒœê°’ë“¤ ëª¨ë‘ ì–»ì–´ì˜¬ ìˆœ ìˆì§€ë§Œ, ëª¨ë“  ìƒíƒœê°€ ë³€ê²½ë  ë–„ë§ˆë‹¤ ì»´í¬ë„ŒíŠ¸ê°€ ì—…ë°ì´íŠ¸ ë¨ì—ë”°ë¼ì„œ ì„ íƒí•´ì„œ ìƒíƒœê°’ì„ ì–»ì–´ì˜¤ë„ë¡ í•´ì•¼í•¨.
  ```tsx
  const { todo, fetchTodo, fetchTodos } = useStore();
  ```
- **Selecting multiple state slices**
  ê¸°ë³¸ì ìœ¼ë¡œ strict compare(old === new) ë³€ê²½ë  ì‹œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§ í•©ë‹ˆë‹¤.
  reduxì˜ useSelector, jotaiì˜ selectAtom, recoilì˜ selector ê¸°ëŠ¥ê³¼ ë™ì¼
  ```tsx
  const todo = useStore(state => state.todo);
  const fetchTodo = useStore(state => state.fetchTodo);
  const fetchTodos = useStore(state => state.fetchTodos);
  ```
- **Memoizing selectors**
  React í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì—ì„œ useCallbackê³¼ ê°™ì´ ì‚¬ìš©í•œë‹¤ë©´ selectorë¥¼ ë©”ëª¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë Œë”ë§í•  ë•Œë§ˆë‹¤ ë¶ˆí•„ìš”í•œ ê³„ì‚°ì´ ë°©ì§€ë©ë‹ˆë‹¤.
  ```tsx
  const todo = useStore(useCallback((state) => state.todo, [todo])
  ```
- **Using subscribe with selector**
  ìƒíƒœê´€ë¦¬ë¥¼ êµ¬ë…í•´ì„œ ìƒíƒœê°’ì´ ë³€ê²½ë  ê²½ìš° í˜¸ì¶œë  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  mobxì˜ autorun/computedì˜ ë™ì¼í•œ ê¸°ëŠ¥ê³¼ ë™ì¼

  ```tsx
  import { subscribeWithSelector } from "zustand/middleware";
  export const useStore = create<TodoState>()(
  	subscribeWithSelector(
      todo: {
        todoItems: [],
        loading: true,
        error: false,
      },
  	)
  	);

  // todoItemsê°€ ë³€ê²½ë  ê²½ìš° subscribe 2ë²ˆì§¸ ì¸ìì˜ callback í•¨ìˆ˜ í˜¸ì¶œ
  useEffect(() => {
    // const todoLength = useMemo(() => todoItems.length, [todoItems]);
    useStore.subscribe(
      (state) => state.todo.todoItems,
      (todoItems) => console.log(todoItems.length)
    );

    return () => {
      useStore.destroy();
    };
  }, []);

  ```

- **Async actions**

  ```tsx
  fetchTodos: async () => {
    set((state) => {
      state.todo.loading = true;
    });

    try {
      const response = await fetchTodo();
      set((state) => {
        state.todo.loading = false;
        state.todo.todoItems = [].concat(response.data);
      });
    } catch (e) {
      set((state) => {
        state.todo.loading = false;
        state.todo.error = e;
      });
    }
  },
  ```

- **Read from state in actions**
  ```tsx
  const useStore = create((set, get) => ({
    todo: {
      todoItems: [],
      loading: true,
      error: false,
    },
    action: () => {
      const todo = get().todo
      // ...
    }
  })
  ```
- **Immer middleware vs npm Immer**
  Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©ê°€ëŠ¥ì§€ë§Œ, Zustand middleware Immer ì‚¬ìš©ê°€ëŠ¥í•¨.

  ```tsx
  import { immer } from 'zustand/middleware/immer';
  export const useStore = create<TodoState>()(
    immer(set => ({
      todo: {
        todoItems: [],
        loading: true,
        error: false,
      },
      fetchTodos: async () => {
        set(state => {
          state.todo.loading = true;
        });

        try {
          const response = await fetchTodo();
          set(state => {
            state.todo.loading = false;
            state.todo.todoItems = [].concat(response.data);
          });
        } catch (e) {
          set(state => {
            state.todo.loading = false;
            state.todo.error = e;
          });
        }
      },
      fetchTodo: async (id: number) => {
        set(state => {
          return produce(state, draft => {
            draft.todo.loading = true;
          });
        });

        try {
          const response = await fetchTodo(id);
          set(state => {
            return produce(state, draft => {
              draft.todo.loading = false;
              draft.todo.todoItems = [].concat(response.data);
            });
          });
        } catch (e) {
          set(state =>
            produce(state, draft => {
              draft.todo.loading = false;
              draft.todo.error = e;
            }),
          );
        }
      },
    })),
  );
  ```

- **Redux devtools**

  ```tsx
  import { devtools } from 'zustand/middleware';

  const useStore = create(devtools(store));
  ```

# zustand ê·¸ì™¸ íŠ¹ì§•

- **Using zustand without React :**

[GitHub - pmndrs/zustand: ğŸ» Bear necessities for state management in React](https://github.com/pmndrs/zustand#using-zustand-without-react)

- **Transient updates (for often occurring state-changes)**

[GitHub - pmndrs/zustand: ğŸ» Bear necessities for state management in React](https://github.com/pmndrs/zustand#transient-updates-for-often-occurring-state-changes)

- **Middleware**

[GitHub - pmndrs/zustand: ğŸ» Bear necessities for state management in React](https://github.com/pmndrs/zustand#middleware)

- **Overwriting state**

[GitHub - pmndrs/zustand: ğŸ» Bear necessities for state management in React](https://github.com/pmndrs/zustand#overwriting-state)

- **React context:**

[GitHub - pmndrs/zustand: ğŸ» Bear necessities for state management in React](https://github.com/pmndrs/zustand#react-context)

# ê°œì¸ì˜ê²¬

- ìƒíƒœê´€ë¦¬(redux, contextapi)ì— ë‹¨ì ì„ í•´ì†Œí•˜ê¸° ìœ„í•œë‹¤ë©´ ì¶©ë¶„íˆ ê²€í† í•´ë³¼ë§Œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°™ìŠµë‹ˆë‹¤.
  - ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìµœì†Œí™”(action, reducer, state, type ë“±ë“±)
  - provider ë˜í•‘í•  í•„ìš”ì—†ìŒ
  - ìì‹ ë¦¬ë Œë”ë§ì„ ìƒíƒœë³„ë¡œ ì—…ë°ì´íŠ¸ ê°€ëŠ¥
- redux,mobx ìƒíƒœê´€ë¦¬ ë³´ë‹¤ëŠ” ì‰½ê²Œ í•™ìŠµì´ ê°€ëŠ¥í•˜ê³ , ë¹ ë¥´ê²Œ ë„ì…í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
- zustand ìì²´ì—ì„œ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë§ì•„ì„œ ì‰½ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.(ë‹¨, ë¼ì´ë¸ŒëŸ¬ë¦¬ í’€ì§€ì›ì´ ë˜ëŠ”ì§€ ì—¬ë¶€ í™•ì¸)
- ë¦¬ì•¡íŠ¸ì˜ hooks ê¸°ë°˜ì˜ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆì–´ì„œ í™•ì¥ì„±, ì¬ì‚¬ìš©ì„±ì— ì¢‹ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

# ì°¸ê³ í˜ì´ì§€

[https://github.com/pmndrs/zustand](https://github.com/pmndrs/zustand)

[ë¦¬ì•¡íŠ¸ ìƒíƒœê´€ë¦¬ì— ê´€í•œ ì–•ì€ ê³ ì°°](https://hanch-dev.tistory.com/21)

[React ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Zustandì˜ ì½”ë“œë¥¼ íŒŒí—¤ì³ë³´ì](https://ui.toast.com/weekly-pick/ko_20210812)

[[ReactğŸŒ€] ì°¨ì„¸ëŒ€ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬, Jotai VS Zustand â­ (Feat. Recoil)](https://programming119.tistory.com/263)

[Zustand ë²ˆì—­](https://www.rldnrl.dev/blog/zustand)
