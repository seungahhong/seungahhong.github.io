---
layout: post
title: jotai
date: 2022-06-14
published: 2022-06-14
category: ê°œë°œ
tags: ['ìƒíƒœê´€ë¦¬']
comments: true,
thumbnail: './images/14/thumbnail.png'
github: 'https://github.com/seungahhong/states-todos'
---

# ì„¤ì¹˜

```bash
npm install jotai

or

yarn add jotai
```

# ì°¸ê³ ì½”ë“œ

ì°¸ê³ ì½”ë“œ: [GitHub - seungahhong/states-todos](https://github.com/seungahhong/states-todos)

# Jotai ê°œë…, íŠ¹ì¥ì  ì„¤ëª…

- ìƒíƒœê´€ë¦¬ ì„¤ëª…
  ìš”ì¦˜ ìƒíƒœê´€ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ ë°©ì‹ì„ 3ê°€ì§€ë¡œ ë‚˜ëˆ ì„œ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
  - Flux (Redux, Zustand)
    - ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” Flux ë°©ì‹ìœ¼ë¡œì¨, ì €ì¥ì†Œ(store)/ì•¡ì…˜í•¨ìˆ˜(action)/ë¦¬ë“€ì„œ ë“±ì„ í†µí•´ì„œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ì‹
  - Proxy (Mobx, Valtio)
    - ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš©ë˜ëŠ” ì¼ë¶€ ìƒíƒœë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•´ì„œ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ì‹
  - Atomic (Jotai, Recoil)
    - Reactì— ì‚¬ìš©ë˜ëŠ” stateì™€ ë¹„ìŠ·í•˜ê²Œ ë¦¬ì•¡íŠ¸ íŠ¸ë¦¬ ì•ˆì—ì„œ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ì‹
- Jotai ê°œë…
  - ì£¼ìš”ê°œë…
    - ìµœì†Œ API
    - TypeScript ë‚´ì¥
    - ì‘ì€ ë²ˆë“¤ í¬ê¸°(3kb)
    - ë§ì€ ì¶”ê°€ ìœ í‹¸ë¦¬í‹° ë° ê³µì‹ í†µí•©
    - Next.js ë° React Native ì§€ì›
    - ë¦¬ì•¡íŠ¸ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥
  - ì†Œê°œ
    - Jotai ì¼ë³¸ì–´ë¡œ ìƒíƒœë¥¼ ëœ»í•˜ê³ , ê°™ì€ ê°œë°œ ê·¸ë£¹ì¸Â [Pmndrs](https://pmnd.rs/)ì—ì„œ ë§Œë“ Â [Zustand](https://github.com/pmndrs/zustand) ë¼ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ìˆëŠ”ë° ì´ëŠ” ë…ì¼ì–´ë¡œ ìƒíƒœë¥¼ ëœ»í•©ë‹ˆë‹¤.
    - Contextì˜ re-rendering ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ React íŠ¹í™” ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
    - ë¦¬ì•¡íŠ¸ì—ì„œëŠ” useContext, useStateë¥¼ top-down ë°©ì‹ì„ ê°œì„ í•˜ê¸° ìœ„í•´ì„œ, Recoilê³¼ ë¹„ìŠ·í•œê²Œ atomicí•œ ìƒíƒœê´€ë¦¬ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë¨(bottom-up ë°©ì‹)
      ![Untitled](./images/14/Untitled.png)
- Jotai íŠ¹ì¥ì 
  - ê¸°ë³¸ì ìœ¼ë¡œ re-rendering ë¬¸ì œë¥¼ ì¤„ì—¬ì£¼ê³ ,selectAtom,splitAtomÂ ê³¼ ê°™ì€ re-rendering ì„ ì¤„ì´ê¸° ìœ„í•œ ìœ í‹¸ë“¤ë„ ì§€ì›í•œë‹¤.
  - ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œê°€ reduxì— ë¹„í•˜ë©´ í˜„ì €í•˜ê²Œ ì¤„ì–´ë“ ë‹¤.
  - React ì˜ ì£¼ìš” featureì¼ Suspense(Concurrent mode)ë¥¼ ì ìš©í•˜ëŠ”ë°ì— ì í•©í•˜ê²Œ ì„¤ê³„
  - Jotai ê°€ ê°•ì¡°í•˜ëŠ” ë‘ê°€ì§€ íŠ¹ì§•
    - Primitive: ë¦¬ì•¡íŠ¸ ê¸°ë³¸ state í•¨ìˆ˜ì¸Â useStateÂ ì™€ ìœ ì‚¬í•œ ì¸í„°í˜ì´ìŠ¤
    - Flexible: atomë“¤ë¼ë¦¬ ì„œë¡œ ê²°í•© ë° ìƒíƒœì— ê´€ì—¬í•  ìˆ˜ ìˆê³ , ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ê³¼ ì›í• í•œ ê²°í•©ì„ ì§€ì›(íŠ¹íˆ, reduxì™€ ìƒíƒœê´€ë¦¬ ì—°ë™ ê°€ëŠ¥)

# Jotai ì£¼ìš” íŠ¹ì§•

- atom

  - ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ê¸°ë³¸ë‹¨ìœ„ë¡œì¨ atomì„ ì´ìš©í•´ì„œ stateë¥¼ ìƒì„±
  - useStateì™€ ìœ ì‚¬í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ(useAtom)

  ```tsx
  // useState
  const [filter, setTodoFilter] = useState(todoListFilterState);

  // get, set hooks
  const [filter, setTodoFilter] = useAtom(todoListFilterState);
  ```

  - í™•ì¥ ìœ í‹¸ë“¤ì„ ì œê³µ(useAtomValue, useUpdateAtom, atomWithQuery ë“±ë“±)

  ```tsx
  // read-only
  const filterItems = useAtomValue(filteredTodoListState);

  // writable
  const fetchTodoAction = useUpdateAtom(fetchAsyncTodoAction);

  // react-query í†µí•©
  export const fetchAsyncJotaiWithReactQueryTodoAction = atomWithQuery(get => ({
    queryKey: ['users', get(fetchState)],
    queryFn: async ({ queryKey: [, id] }) => {
      const response = await fetchTodo(id);
      return [].concat(response.data);
    },
  }));
  ```

  - recoil ê³¼ ë‹¤ë¥´ê²Œ ë”°ë¡œ í‚¤ë¥¼ ë„£ì–´ì¤„ í•„ìš”ì—†ìŒ.

  ```tsx
  // recoil
  export const TodoItemAtom = atom<TodoState>({
    key: 'TodoItemState',
    default: initialState,
  });

  // jotai
  export const TodoItemAtom = atom<TodoState>(initialState);
  ```

  - atom(InitialValue) ë¡œ ì„ ì–¸

  ```tsx
  export const TodoItemAtom = atom<TodoState>(initialState);
  const [todo, setTodoItemAtom] = useAtom(TodoItemAtom);
  ```

  - atom(initialValue, (get, set, args) => {})

  ```tsx
  // only get
  export const fetchAsyncTodosAction = atom(async get => {
    const response = await fetchTodo();
    return response.data;
  });

  const [todos] = useAtom(fetchAsyncTodosAction);

  // get set
  export const fetchAsyncTodoAction = atom(
    async get => {
      const response = await fetchTodo(get(fetchState));
      return [].concat(response.data);
    },
    (get, set, payload: number) => {
      set(fetchState, payload);
    },
  );

  const [todo, fetchTodoAction] = useAtom(fetchAsyncTodoAction);
  ```

  - selectAtom: atomì˜ ì „ì²´ ê°’ë§Œì´ ì•„ë‹Œ ì¼ë¶€ê°€ í•„ìš”í•œ ê²½ìš°

  ```tsx
  export const todoItemData = selectAtom(TodoItemAtom, todoItem => {
    return todoItem.data;
  });
  ```

- Provider
  atomì˜ ê°’ì€ ê¸€ë¡œë²Œì— ì¡´ì¬í•˜ëŠ” atomì— ì €ì¥ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ Contextì™€ ë¹„ìŠ·í•˜ê²Œ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ìƒì— ì €ì¥ë©ë‹ˆë‹¤ .Â [Provider](https://jotai.org/docs/api/core#provider)ë¥¼ ì‚¬ìš©í•˜ë©´ atomì´ ì €ì¥ë  Contextë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì¦‰ ì°¸ì¡°í•˜ëŠ” Providerê°€ ë‹¤ë¥´ë©´ ê°™ì€ atomì„ useí•´ë„ ê°’ì´ ë‹¤ë¦…ë‹ˆë‹¤) Providerë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ì €ì¥ì†Œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.

  ```tsx
  // ì ìš© ì „
  export const TodoItemAtom = atom<TodoState>(initialState);

  const TodoWithProvider = () => {
    const [data, setTodoItemAtom] = useAtom(TodoItemAtom);
    ...
  };

  // ê¸°ë³¸ ì €ì¥ì†Œ ì‚¬ìš©
  const TodoWithProvider = (state: TodoState) => {
    return (
      <TodoItem />
    );
  };

  // Provider ì ìš© í›„
  export const TodoItemAtom = atom<TodoState>(initialState);

  const TodoWithProvider = () => {
    const [data, setTodoItemAtom] = useAtom(TodoItemAtom);
    ...
  };

  // Provider ì €ì¥ì†Œ ì‚¬ìš©
  const TodoWithProvider = (state: TodoState) => {
    return (
      <Provider
        initialValues={[
          [TodoItemAtom, state],
        ] as Array<[Atom<unknown>, unknown]>}
      >
        <TodoItem />
      </Provider>
    );
  };
  ```

- onMount
  atomì— ê³ ì •ëœ ê°’ ëŒ€ì‹ ì— ì²˜ìŒ ì‚¬ìš©ë˜ëŠ” ì‹œì ì— ê°’ì´ ì •í•´ì§€ë„ë¡ í•˜ê¸° ìœ„í•´ì„œ onMount ì‚¬ìš©ê°€ëŠ¥
  ```tsx
  export const fetchState = atom<number>(1);
  fetchState.onMount = set => {
    set(2);
  };
  ```
- atom ì¡°í•© ë° ë¶„ë¦¬

  ```tsx
  import { atom } from 'jotai';

  const orderer_email_atom = atom('');
  const orderer_mobile_tel_atom = atom('');
  const orderer_name_atom = atom('');
  const orderer_atom = atom(get => ({
    email: get(orderer_email_atom),
    mobile_tel: get(orderer_mobile_tel_atom),
    name: get(orderer_name_atom),
  }));
  ```

# Jotai ë¹„ë™ê¸°

- async atom

  ```tsx
  export const fetchAsyncTodosAction = atom(async (get) => {
    const response = await fetchTodo();
    return response.data;
  });

  export const fetchAsyncTodoAction = atom(
    async (get) => {
      const response = await fetchTodo(get(fetchState));
      return [].concat(response.data);
    },
    (get, set, payload: number) => {
      set(fetchState, payload);
    }
  );

  const fetchCountAtom = atom(
    (get) => get(countAtom),
    async (_get, set, url) => {
      const response = await fetch(url)
      set(countAtom, (await response.json()).count)
    }
  )

  function Controls() {
    const [count, compute] = useAtom(fetchCountAtom)
    return <button onClick={() => compute("http://count.host.com")}>compute</button>
  ì¶œì²˜: https://programming119.tistory.com/263 [ê°œë°œì ì•„ì €ì”¨ë“¤ í˜ì„ëª¨ì•„:í‹°ìŠ¤í† ë¦¬]
  ```

- suspend ì§€ì›
  ```tsx
  const asyncAtom = atom(async get => get(countAtom) * 2);
  const ComponentUsingAsyncAtoms = () => {
    const [num] = useAtom(asyncAtom);
    // here `num` is always `number` even though asyncAtom returns a Promise
  };
  const App = () => {
    return (
      <Suspense fallback={/* What to show while suspended */}>
        <ComponentUsingAsyncAtoms />
      </Suspense>
    );
  };
  ```
- lodable ì§€ì›

  ```tsx
  /*
  {
      state: 'loading' | 'hasData' | 'hasError',
      data?: any,
      error?: any,
  }
  */

  import { loadable } from "jotai/utils"

  const asyncAtom = atom(async (get) => ...)
  const loadableAtom = loadable(asyncAtom)
  // Does not need to be wrapped by a <Suspense> element
  const Component = () => {
    const value = useAtom(loadableAtom)
    if (value.state === 'hasError') return <Text>{value.error}</Text>
    if (value.state === 'loading') {
      return <Text>Loading...</Text>
    }
    console.log(value.data) // Results of the Promise
    return <Text>Value: {value.data}</Text>
  }
  ```

# Jotai í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬

- react-query í†µí•©

  ```bash
  npm install react-query
  or
  yarn add react-query
  ```

  ```bash
  import { useAtom } from 'jotai'
  import { atomWithQuery, atomWithInfiniteQuery } from 'jotai/query'

  export const fetchAsyncJotaiWithReactQueryTodoAction = atomWithQuery((get) => ({
    queryKey: ["users", get(fetchState)],
    queryFn: async ({ queryKey: [, id] }) => {
      const response = await fetchTodo(id);
      return [].concat(response.data);
    },
  }));

  const idAtom = atom(1)
  const userAtom = atomWithInfiniteQuery((get) => ({
    queryKey: ['users', get(idAtom)],
    queryFn: async ({ queryKey: [, id] }) => {
      const res = await fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
      return res.json()
    },
    // infinite queries can support paginated fetching
    getNextPageParam: (lastPage, pages) => lastPage.nextCursor,
  }))

  const UserData = () => {
    const [data] = useAtom(userAtom)
    return data.pages.map((userData, index) => (
      <div key={index}>{JSON.stringify(userData)}</div>
    ))
  }
  ```

- redux í†µí•©
  ```bash
  import { useAtom } from 'jotai'
  import { atomWithStore } from 'jotai/redux'
  import { createStore } from 'redux'
  const initialState = { count: 0 }
  const reducer = (state = initialState, action: { type: 'INC' }) => {
    if (action.type === 'INC') {
      return { ...state, count: state.count + 1 }
    }
    return state
  }
  const store = createStore(reducer)
  const storeAtom = atomWithStore(store)
  const Counter: React.FC = () => {
    const [state, dispatch] = useAtom(storeAtom)
    return (
      <>
        count: {state.count}
        <button onClick={() => dispatch({ type: 'INC' })}>button</button>
      </>
    )
  }
  ```
- ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
  - immer
  - optics
  - react-query
  - xstate
  - valtio
  - zustand
  - redux

# ê°œì¸ì˜ê²¬

- ë©€í‹° ìŠ¤í† ì–´ë¥¼ í†µí•´ì„œ ìƒíƒœê´€ë¦¬ë¥¼ ì§€ì›ì´ í•„ìš”í•˜ë‹¤ë©´ ì¶©ë¶„íˆ ì‚¬ìš©í•´ë„ ì¢‹ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°™ë‹¤.
- Jotai ìì²´ì—ì„œ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë§ì•„ì„œ ì‰½ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•  ê²ƒ ê°™ë‹¤.(ë‹¨, ë¼ì´ë¸ŒëŸ¬ë¦¬ í’€ì§€ì›ì´ ë˜ëŠ”ì§€ ì—¬ë¶€ í™•ì¸)
- recoil ìƒíƒœê´€ë¦¬ë³´ë‹¤ëŠ” ë¬¸ë²• ìì²´ê°€ ì‰¬ì›Œ ë³´ì¸ë‹¤.
  - ëª¨ë“  ë‹¨ìœ„ë¥¼ atomìœ¼ë¡œ í†µì¼
  - unique keyê°€ ì—†ëŠ”ê²ƒë„ í¸í•˜ê²Œ ëŠê»´ì§
- ì—¬ëŸ¬ íšŒì‚¬ì—ì„œ ì ìš©ì„ í•´ë³¸ê²ƒìœ¼ë¡œ ë³´ì•„ì„œ ì–´ëŠì •ë„ ì•ˆì •ì„±ì€ í™•ë³´ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤.(ì¹´ì¹´ì˜¤ìŠ¤íƒ€ì¼, í™”í•´ ë“±ë“±)
- ë¦¬ì•¡íŠ¸ íŠ¸ë¦¬ê¸°ë°˜ì˜ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³¼ë§Œí•œ ìƒíƒœê´€ë¦¬ íˆ´ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

# ì°¸ê³ í˜ì´ì§€

- [Jotai ë ˆì‹œí”¼](https://devblog.kakaostyle.com/ko/2022-01-13-2-jotai-recipe/)
- [[ReactğŸŒ€] ì°¨ì„¸ëŒ€ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬, Jotai VS Zustand â­ (Feat. Recoil)](https://programming119.tistory.com/263)
- [Atomic state management - Jotai - í™”í•´ ë¸”ë¡œê·¸ | ê¸°ìˆ  ë¸”ë¡œê·¸](http://blog.hwahae.co.kr/all/tech/tech-tech/6099/)
- [ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ jotai í›‘ì–´ë³´ê¸°](https://velog.io/@ggong/%EC%83%81%ED%83%9C-%EA%B4%80%EB%A6%AC%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-jotai)
- [Introduction - Jotai](https://jotai.org/docs/introduction)
