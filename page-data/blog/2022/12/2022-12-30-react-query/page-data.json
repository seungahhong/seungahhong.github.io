{"componentChunkName":"component---src-components-templates-post-template-tsx","path":"/blog/2022/12/2022-12-30-react-query/","result":{"data":{"site":{"siteMetadata":{"title":"홍승아 기술 블로그","description":"홍승아 기술 블로그에 오신걸 환영합니다.","author":"홍승아","type":"website","siteUrl":"https://seungahhong.github.io","social":{"facebook":"https://www.facebook.com/people/%ED%99%8D%EC%8A%B9%EC%95%84/100002349562000/","github":"https://github.com/seungahhong","notion":"https://material-debt-c1c.notion.site/daa60481e37840ea9e1b7e1b12269942","linkedin":"https://www.linkedin.com/in/seungahhong/"}}},"allFile":{"edges":[{"node":{"name":"facebook","publicURL":"/static/b185e9b61bb465d92b14ed1c9a9ded61/facebook.svg","childImageSharp":null}},{"node":{"name":"github","publicURL":"/static/4a6687a74051de2b3536e95d0b6c992a/github.svg","childImageSharp":null}},{"node":{"name":"linkedin","publicURL":"/static/3dc9e0d0f748678205218f1c72941cc2/linkedin.svg","childImageSharp":null}},{"node":{"name":"notion","publicURL":"/static/19b0f81386812ed2f2f3a7aea202935f/notion.svg","childImageSharp":null}},{"node":{"name":"background","publicURL":"/static/77f5c833c2343c992fd263c780495905/background.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,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"},"images":{"fallback":{"src":"/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg","srcSet":"/static/77f5c833c2343c992fd263c780495905/9330e/background.jpg 139w,\n/static/77f5c833c2343c992fd263c780495905/53b4d/background.jpg 278w,\n/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg 555w","sizes":"(min-width: 555px) 555px, 100vw"},"sources":[{"srcSet":"/static/77f5c833c2343c992fd263c780495905/3ee68/background.webp 139w,\n/static/77f5c833c2343c992fd263c780495905/d0ff1/background.webp 278w,\n/static/77f5c833c2343c992fd263c780495905/21b9c/background.webp 555w","type":"image/webp","sizes":"(min-width: 555px) 555px, 100vw"}]},"width":555,"height":961}}}}]},"allMarkdownRemark":{"edges":[{"node":{"html":"<h1 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h1>\n<ul>\n<li>React를 위한 Data Synchronization Library</li>\n<li>React application에서 <strong>서버 상태</strong>를 fetching, caching, synchronizing, updating 작업을 쉽게 만들어 줍니다.</li>\n</ul>\n<h1 id=\"서버-상태\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C\" aria-label=\"서버 상태 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서버 상태</h1>\n<ul>\n<li>원격에 위치한 공간에 저장되며 앱이 소유하거나 제어하지 않습니다.</li>\n<li>데이터를 가져오고 업데이트하기 위해선 비동기 API가 필요합니다.</li>\n<li>다른 사람과 함께 사용하며, 내가 모르는 사이에 업데이트될 수 있습니다.</li>\n<li>앱에서 사용하는 데이터가 “유효 기간이 지난” 상태가 될 가능성을 가집니다.</li>\n</ul>\n<h1 id=\"react-query-장점\" style=\"position:relative;\"><a href=\"#react-query-%EC%9E%A5%EC%A0%90\" aria-label=\"react query 장점 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Query 장점</h1>\n<ul>\n<li>캐싱</li>\n<li>서버 데이터 중복 호출 제거 (따닥 방지)</li>\n<li>만료된 데이터를 백그라운드에서 제거하기</li>\n<li>데이터가 언제 만료되는지 알고 있기</li>\n<li>만료된 데이터는 가능한 빨리 업데이트하기</li>\n<li>페이지네이션, 레이지 로딩 데이터의 성능 최적화</li>\n<li>서버 상태의 메모리 관리 및 가비지 콜렉션</li>\n<li>쿼리 결과의 구조 공유를 통한 메모이제이션</li>\n</ul>\n<h1 id=\"react-query-단점\" style=\"position:relative;\"><a href=\"#react-query-%EB%8B%A8%EC%A0%90\" aria-label=\"react query 단점 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Query 단점</h1>\n<ul>\n<li>라이브러리 의존성 추가</li>\n<li>러닝 커브</li>\n<li>Query lifecycle의 이해</li>\n</ul>\n<h1 id=\"query의-상태\" style=\"position:relative;\"><a href=\"#query%EC%9D%98-%EC%83%81%ED%83%9C\" aria-label=\"query의 상태 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Query의 상태</h1>\n<p>React Query를 통해 관리하는 쿼리 데이터는 라이프사이클에 따라 fetching, fresh, stale, inactive, delete 상태를 가집니다.</p>\n<ul>\n<li>fetching - 요청 중인 쿼리</li>\n<li>fresh - 만료되지 않은 쿼리. 컴포넌트가 마운트, 업데이트되어도 데이터를 다시 요청하지 않습니다.(staleTime범위)</li>\n<li>stale - 만료된 쿼리. 컴포넌트가 마운트, 업데이트되면 데이터를 다시 요청합니다.(staleTime 종료될 경우)</li>\n<li>inactive - 사용하지 않는 쿼리. 일정 시간이 지나면 가비지 컬렉터가 캐시에서 제거합니다.(cacheTime범위)\n<ul>\n<li>cacheTime이 유지된 상태에서 사이트로 포커스가 다시 올경우 stale 쿼리가 수행되지만, 화면에는 cache된 데이터로 보여주게 된다.</li>\n</ul>\n</li>\n<li>delete - 가비지 컬렉터에 의해 캐시에서 제거된 쿼리(cacheTime 종료될 경우)</li>\n</ul>\n<h1 id=\"주요개념\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94%EA%B0%9C%EB%85%90\" aria-label=\"주요개념 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주요개념</h1>\n<p>다음은 React Query에서 제공하는 API의 기본이 되는 설정입니다.</p>\n<ul>\n<li><code class=\"language-text\">useQuery</code>(그리고 <code class=\"language-text\">useInfiniteQuery</code>)로 가져온 데이터는 기본적으로 stale 상태가 됩니다.\n<ul>\n<li><code class=\"language-text\">staleTime</code> 옵션으로 데이터가 stale 상태로 바뀌는데 걸리는 시간을 늘릴 수 있습니다.</li>\n</ul>\n</li>\n<li>stale 쿼리는 다음 경우에 백그라운드에서 다시 가져옵니다.\n<ul>\n<li>새로운 쿼리 인스턴스가 마운트되었을 때</li>\n<li>브라우저 윈도우가 다시 포커스되었을 때</li>\n<li>네트워크가 다시 연결되었을 때</li>\n<li><code class=\"language-text\">refetchInterval</code> 옵션이 있을 때</li>\n</ul>\n</li>\n<li>활성화된 <code class=\"language-text\">useQuery</code>, <code class=\"language-text\">useInfiniteQuery</code> 인스턴스가 없는 쿼리 결과는 “inactive” 라벨이 붙으며 다음에 사용될 때까지 남아있습니다.\n<ul>\n<li>inactive 쿼리는 300초(5분) 후에 메모리에서 해제됩니다.</li>\n</ul>\n</li>\n<li>백그라운드에서 3회 이상 실패한 쿼리는 에러 처리됩니다.\n<ul>\n<li><code class=\"language-text\">retry</code> 옵션으로 쿼리 함수에서 오류 발생시 재시도할 횟수, <code class=\"language-text\">retryDelay</code> 옵션으로 재시도 대기 시간을 설정</li>\n</ul>\n</li>\n<li>쿼리 결과는 memoization을 위해 structural sharing을 사용하며 데이터 reference는 변경되지 않습니다.\n<ul>\n<li>immutable.js에서 사용하는 기술.(<a href=\"https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2\" target=\"_blank\" rel=\"nofollow\">참고할만한 글</a>)</li>\n<li>99.9% 케이스에서는 이 옵션을 끌 필요가 없습니다.</li>\n<li>structural sharing은 JSON 호환 데이터에만 적용되며, 다른 타입의 쿼리 결과는 항상 변경되었다고 판단합니다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"데이터-가져오기-usequery\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-usequery\" aria-label=\"데이터 가져오기 usequery permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 가져오기 (useQuery)</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> isLoading<span class=\"token punctuation\">,</span> isError <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">,</span> queryFunction<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>queryKey는 쿼리 캐시에 대한 key이며, string, array, object가 가능합니다.</p>\n<p>queryFuntion은 Promise를 리턴하는 함수입니다. axios.get 이나 fetch 가 될 수 있습니다.</p>\n<p>options 는 useQuery에 대한 옵션으로 cacheTime, staleTime, onSuccess, onError 등을 설정할 수 있습니다.</p>\n<h2 id=\"데이터-업데이트하기-usemutation\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%ED%95%98%EA%B8%B0-usemutation\" aria-label=\"데이터 업데이트하기 usemutation permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 업데이트하기 (useMutation)</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> mutation <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>newTodo <span class=\"token operator\">=></span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/todos'</span><span class=\"token punctuation\">,</span> newTodo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> handleSubmit <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  mutation<span class=\"token punctuation\">.</span><span class=\"token function\">mutate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">:</span> <span class=\"token string\">'Do Laundry'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// mutate이 후 의존적인 액션이 있다면 mutateAsync를 사용합니다.</span>\n  <span class=\"token keyword\">await</span> mutation<span class=\"token punctuation\">.</span><span class=\"token function\">mutateAsync</span><span class=\"token punctuation\">(</span>newTodo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setAnotherState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">createAnotherAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>mutation<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>데이터의 CUD에는 useMutation을 사용하면 되고, options도 useQuery와 비슷하게 onSuccess, onError 콜백과 mutate를 호출할 때 실행되는 onMutate 콜백도 있습니다.</p>\n<h2 id=\"쿼리-무효화-invalidation\" style=\"position:relative;\"><a href=\"#%EC%BF%BC%EB%A6%AC-%EB%AC%B4%ED%9A%A8%ED%99%94-invalidation\" aria-label=\"쿼리 무효화 invalidation permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿼리 무효화 (Invalidation)</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 캐시에 있는 모든 쿼리를 무효화한다.</span>\nqueryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// todo로 시작하는 모든 쿼리를 무효화한다. ex) ['todos', 1], ['todos', 2], ...</span>\nqueryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token string\">'todos'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ['todos', 1] 키를 가진 쿼리를 무효화한다.</span>\nqueryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useMutation등으로 업데이트 된 데이터를 다시 가져와야 하는 경우 (캐시를 무효화하고 싶은 경우) invalidateQueries 함수를 사용할 수 있습니다.</p>\n<h2 id=\"개발자-도구-reactquerydevtools\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B0%9C%EC%9E%90-%EB%8F%84%EA%B5%AC-reactquerydevtools\" aria-label=\"개발자 도구 reactquerydevtools permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개발자 도구 (ReactQueryDevTools)</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ReactQueryDevtools <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query/devtools'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// useQuery Hook이 QueryClient에 접근하기 위해 QueryClientProvider를 컴포넌트 트리 상위에 추가해야합니다.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Example</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"staletime-vs-cachetime\" style=\"position:relative;\"><a href=\"#staletime-vs-cachetime\" aria-label=\"staletime vs cachetime permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>staleTime vs cacheTime</h1>\n<p>컴포넌트A가 마운트 되면서 생성된 인스턴스는 <code class=\"language-text\">staleTime (디폴트 0)</code> 이 지나버렸기 때문에 언마운트 시점에 캐시가 <code class=\"language-text\">inactive</code> 상태가 되었고 컴포넌트B가 마운트 되면서 새로운 인스턴스가 생성되었다.</p>\n<p>이 상황에서 <code class=\"language-text\">cacheTime</code> 과 <code class=\"language-text\">staleTime</code> 가 시작되는 시점을 잘못 이해하고 있었다.</p>\n<p>쿼리 인스턴스가 마운트 되는 순간에는 <code class=\"language-text\">staleTime</code> 이 시작된다. <code class=\"language-text\">cacheTime</code> 은 쿼리 인스턴스가 완전히 언마운트 되어서 <code class=\"language-text\">inactive</code> 상태가 되고 나면 시작된다.</p>\n<p>마운트 되는 시점에 시작된 staleTime에서는 active, fresh한 상태를 가지고 있다.</p>\n<p>그러다 staleTime이 끝나면 stale 상태를 가지고 있지만 아직 cacheTime이 시작되는 않는다. (화면에 아직 유효한 데이터가 존재하기 때문에 캐시 타임이 흐르지 않는다)</p>\n<p>언마운트 되면서 화면에 존재하던 것들이 사라지고 inactive 상태를 지니면 이제서야 cacheTime이 시작된다. 이 cacheTime 동안에는 정말 캐시로 존재하기 때문에 다시 호출하면 이 캐싱된 데이터를 재사용할 수 있다.</p>\n<p>그렇다면 staleTime과 cacheTime의 차이가 정확하게 무엇이였을까?</p>\n<p>캐시를 사용하려고 하는건데 그럼 cacheTime만 있으면 되는게 아닌가? (staleTime=0, cacheTime=5분 으로 설정된 디폴트 옵션을 사용하면 되지 않나?)</p>\n<p><code class=\"language-text\">staleTime</code> 은 <code class=\"language-text\">fresh -> stale</code> 로 변경되는 시간이다. <code class=\"language-text\">cacheTime</code> 은 <code class=\"language-text\">inactive</code> 한 상태의 쿼리를 캐시로 유지하는 시간이다.</p>\n<p>기본값이 <code class=\"language-text\">staleTime=0, cacheTime=5분</code> 인 이유이다.</p>\n<p><code class=\"language-text\">staleTime=0</code> 으로 두면서 모든 쿼리가 호출이 끝나면 바로 <code class=\"language-text\">stale</code> 해지고, 다시 호출하면 서버로부터 가져오는 것을 기본으로 하는 것이다.</p>\n<p>이때 리액트 쿼리는 캐싱된 데이터로 조금이나마 빠른 응답을 시켜주기 위해 <code class=\"language-text\">cacheTime=5분</code> 으로 기본 설정해주었고, <code class=\"language-text\">stale</code> 해진 쿼리를 서버로부터 다시 <code class=\"language-text\">fresh</code> 한 데이터를 가져오기 전까지 사용할 수 있다.</p>\n<h1 id=\"isfetching-vs-isloading\" style=\"position:relative;\"><a href=\"#isfetching-vs-isloading\" aria-label=\"isfetching vs isloading permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>isFetching vs isLoading</h1>\n<p>isFetching은 캐싱 된 데이터 유무에 상관없이 데이터 Fetching 때마다 true를 리턴합니다.</p>\n<p>isLoading은 캐싱 된 데이터가 없을 때만 true를 리턴합니다. (initialData 옵션을 설정하면 항상 false를 리턴합니다.)</p>\n<p>둘의 차이를 알면 더 적합한 Loading Indicator를 사용할 수 있습니다.</p>\n<h1 id=\"enabled-refetch\" style=\"position:relative;\"><a href=\"#enabled-refetch\" aria-label=\"enabled refetch permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>enabled refetch</h1>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isLoading<span class=\"token punctuation\">,</span> isFetching<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> isError<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> refetch <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'super-heroes'</span><span class=\"token punctuation\">,</span>\n  getSuperHero<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    enabled<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> handleClickRefetch <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">refetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>refetch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span>data<span class=\"token operator\">?.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>hero<span class=\"token operator\">:</span> Data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>hero<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>hero<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClickRefetch<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Fetch Heroes</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">enabled</code>는 쿼리가 자동으로 실행되지 않도록 할 때 설정할 수 있다. <code class=\"language-text\">false</code>를 주면 자동 실행되지 않는다. 또한 useQuery 리턴 데이터중 status가 idle 상태로 시작한다.</li>\n<li><code class=\"language-text\">refetch</code>는 쿼리를 <code class=\"language-text\">수동</code>으로 다시 요청하는 기능이다. 쿼리 오류가 발생하면 오류만 기록된다. 오류를 발생시키려면 <code class=\"language-text\">throwOnError</code>속성을 <code class=\"language-text\">true</code>로해서 전달해야 한다.</li>\n<li>보통 자동으로 쿼리 요청을 하지 않고 버튼 클릭이나 특정 이벤트를 통해 요청을 시도할 때 같이 사용한다.</li>\n<li>만약 <code class=\"language-text\">enabled: false</code>를 줬다면 <code class=\"language-text\">queryClient</code>가 쿼리를 다시 가져오는 방법들 중 <code class=\"language-text\">invalidateQueries</code>와 <code class=\"language-text\">refetchQueries</code>를 무시한다.</li>\n</ul>\n<h1 id=\"infinite-scroll-pagination\" style=\"position:relative;\"><a href=\"#infinite-scroll-pagination\" aria-label=\"infinite scroll pagination permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Infinite scroll, pagination</h1>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ref<span class=\"token punctuation\">,</span> inView <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useInView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  status<span class=\"token punctuation\">,</span>\n  data<span class=\"token punctuation\">,</span>\n  error<span class=\"token punctuation\">,</span>\n  isFetching<span class=\"token punctuation\">,</span>\n  isFetchingNextPage<span class=\"token punctuation\">,</span>\n  isFetchingPreviousPage<span class=\"token punctuation\">,</span>\n  fetchNextPage<span class=\"token punctuation\">,</span>\n  fetchPreviousPage<span class=\"token punctuation\">,</span>\n  hasNextPage<span class=\"token punctuation\">,</span>\n  hasPreviousPage<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'projects'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pageParam <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/projects?cursor='</span> <span class=\"token operator\">+</span> pageParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">getPreviousPageParam</span><span class=\"token operator\">:</span> firstPage <span class=\"token operator\">=></span> firstPage<span class=\"token punctuation\">.</span>previousId <span class=\"token operator\">??</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> lastPage <span class=\"token operator\">=></span> lastPage<span class=\"token punctuation\">.</span>nextId <span class=\"token operator\">??</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReact<span class=\"token punctuation\">.</span><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inView<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchNextPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>inView<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h1>\n<ul>\n<li>\n<p>효과적인 query key 관리: <a href=\"https://www.zigae.com/react-query-key/\" target=\"_blank\" rel=\"nofollow\">https://www.zigae.com/react-query-key/</a></p>\n</li>\n<li>\n<p>class component에도 React Query를 적용할 수 있나요?</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/65609409/how-can-i-use-react-query-in-a-react-class-component\" target=\"_blank\" rel=\"nofollow\">https://stackoverflow.com/questions/65609409/how-can-i-use-react-query-in-a-react-class-component</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">UseQuery</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> props<span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">.</span>fn<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UseQuery</span></span>\n  <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>“todos”</span>\n  <span class=\"token attr-name\">fn</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">options</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span> staleTime<span class=\"token operator\">:</span> <span class=\"token number\">5000</span> <span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token punctuation\">{</span>query <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">UseQuery</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n<li>\n<p>쿼리 결과에 의존하는 다른 쿼리를 호출해야하는 경우?</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 쿼리 config의 enabled 사용. enabled가 true 일 때만 쿼리를 호출</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> getUserByEmail<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> userID <span class=\"token operator\">=</span> user<span class=\"token operator\">?.</span>id<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isIdle<span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> projects <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'projects'</span><span class=\"token punctuation\">,</span> userID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getProjectsByUser</span><span class=\"token punctuation\">(</span>userID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// The query will not execute until the userId exists</span>\n    enabled<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>userID<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// isIdle will be `true` until `enabled` is true and the query begins to fetch.</span>\n<span class=\"token comment\">// It will then go to the `isLoading` stage and hopefully the `isSuccess` stage :)</span></code></pre></div>\n</li>\n</ul>\n<h1 id=\"참고페이지\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80\" aria-label=\"참고페이지 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고페이지</h1>\n<ul>\n<li><a href=\"https://jiggag.github.io/blog/react-query-cache-is-alive/\" target=\"_blank\" rel=\"nofollow\">리액트 쿼리, 캐시가 살아있다</a></li>\n<li><a href=\"https://tech.kakao.com/2022/06/13/react-query/\" target=\"_blank\" rel=\"nofollow\">My구독의 React Query 전환기</a></li>\n<li><a href=\"https://github.com/ssi02014/react-query-tutorial\" target=\"_blank\" rel=\"nofollow\">https://github.com/ssi02014/react-query-tutorial</a></li>\n<li><a href=\"https://github.com/ssi02014/react-query-tutorial#enabled-refetch\" target=\"_blank\" rel=\"nofollow\">GitHub - ssi02014/react-query-tutorial: 😃 react-query 자주 사용되는 개념 정리</a></li>\n</ul>","frontmatter":{"title":"react-query","date":"2022.12.30","category":"개발","tags":["상태관리"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EA%B0%9C%EC%9A%94\">개요</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C\">서버 상태</a></p>\n</li>\n<li>\n<p><a href=\"#react-query-%EC%9E%A5%EC%A0%90\">React Query 장점</a></p>\n</li>\n<li>\n<p><a href=\"#react-query-%EB%8B%A8%EC%A0%90\">React Query 단점</a></p>\n</li>\n<li>\n<p><a href=\"#query%EC%9D%98-%EC%83%81%ED%83%9C\">Query의 상태</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A3%BC%EC%9A%94%EA%B0%9C%EB%85%90\">주요개념</a></p>\n<ul>\n<li><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-usequery\">데이터 가져오기 (useQuery)</a></li>\n<li><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%ED%95%98%EA%B8%B0-usemutation\">데이터 업데이트하기 (useMutation)</a></li>\n<li><a href=\"#%EC%BF%BC%EB%A6%AC-%EB%AC%B4%ED%9A%A8%ED%99%94-invalidation\">쿼리 무효화 (Invalidation)</a></li>\n<li><a href=\"#%EA%B0%9C%EB%B0%9C%EC%9E%90-%EB%8F%84%EA%B5%AC-reactquerydevtools\">개발자 도구 (ReactQueryDevTools)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#staletime-vs-cachetime\">staleTime vs cacheTime</a></p>\n</li>\n<li>\n<p><a href=\"#isfetching-vs-isloading\">isFetching vs isLoading</a></p>\n</li>\n<li>\n<p><a href=\"#enabled-refetch\">enabled refetch</a></p>\n</li>\n<li>\n<p><a href=\"#infinite-scroll-pagination\">Infinite scroll, pagination</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80\">참고페이지</a></p>\n</li>\n</ul>"}}]}},"pageContext":{"slug":"/blog/2022/12/2022-12-30-react-query/","previous":{"fields":{"slug":"/blog/2023/01/2023-01-01-fe-process/"},"frontmatter":{"title":"FE 개발 프로세스"}},"next":{"fields":{"slug":"/blog/2022/08/2022-08-07-cypress/"},"frontmatter":{"title":"cypress"}}}},"staticQueryHashes":["3940312266","4157816502"]}