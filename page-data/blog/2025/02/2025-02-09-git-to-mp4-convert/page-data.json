{"componentChunkName":"component---src-components-templates-post-template-tsx","path":"/blog/2025/02/2025-02-09-git-to-mp4-convert/","result":{"data":{"site":{"siteMetadata":{"title":"홍승아 기술 블로그","description":"홍승아 기술 블로그에 오신걸 환영합니다.","author":"홍승아","type":"website","siteUrl":"https://seungahhong.github.io","social":{"facebook":"https://www.facebook.com/people/%ED%99%8D%EC%8A%B9%EC%95%84/100002349562000/","github":"https://github.com/seungahhong","notion":"https://material-debt-c1c.notion.site/daa60481e37840ea9e1b7e1b12269942","linkedin":"https://www.linkedin.com/in/seungahhong/"}}},"allFile":{"edges":[{"node":{"name":"facebook","publicURL":"/static/b185e9b61bb465d92b14ed1c9a9ded61/facebook.svg","childImageSharp":null}},{"node":{"name":"github","publicURL":"/static/4a6687a74051de2b3536e95d0b6c992a/github.svg","childImageSharp":null}},{"node":{"name":"linkedin","publicURL":"/static/3dc9e0d0f748678205218f1c72941cc2/linkedin.svg","childImageSharp":null}},{"node":{"name":"notion","publicURL":"/static/19b0f81386812ed2f2f3a7aea202935f/notion.svg","childImageSharp":null}},{"node":{"name":"background","publicURL":"/static/77f5c833c2343c992fd263c780495905/background.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,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"},"images":{"fallback":{"src":"/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg","srcSet":"/static/77f5c833c2343c992fd263c780495905/9330e/background.jpg 139w,\n/static/77f5c833c2343c992fd263c780495905/53b4d/background.jpg 278w,\n/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg 555w","sizes":"(min-width: 555px) 555px, 100vw"},"sources":[{"srcSet":"/static/77f5c833c2343c992fd263c780495905/3ee68/background.webp 139w,\n/static/77f5c833c2343c992fd263c780495905/d0ff1/background.webp 278w,\n/static/77f5c833c2343c992fd263c780495905/21b9c/background.webp 555w","type":"image/webp","sizes":"(min-width: 555px) 555px, 100vw"}]},"width":555,"height":961}}}}]},"allMarkdownRemark":{"edges":[{"node":{"html":"<h1 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h1>\n<p>리소스 중에 용량이 큰 gif 포멧을 효율적인 압축 방식을 제공하는 mp4 비디오 포멧으로 변경해서 리소스 수신 용량을 줄이고 로딩 속도를 개선하기 위해서 해당 기능을 서비스에 적용을 위한 성능개선 작업을 진행하였습니다.</p>\n<h1 id=\"요구사항-분석\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\" aria-label=\"요구사항 분석 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요구사항 분석</h1>\n<ul>\n<li>변환 형식\n<ul>\n<li>img > gif → video > mp4</li>\n<li>동일한 파일명이 있는 mp4 파일이 있는 경우 gif 보다는 mp4 로딩되도록 처리</li>\n</ul>\n</li>\n<li>placeholder 적용\n<ul>\n<li>dataset에서 저장된 이미지 너비, 높이값을 바탕으로 placeholder 높이값 지정</li>\n</ul>\n</li>\n<li>사이즈 재 계산\n<ul>\n<li>브라우저 리사이즈 발생 시 너비/높이 사이즈를 재계산</li>\n</ul>\n</li>\n<li>뷰포트 기준 mp4 로딩/재생/일시중지 작업\n<ul>\n<li>viewport 기준 영역에 도달했을 때 mp4 로딩 되도록 수정</li>\n</ul>\n</li>\n<li>gif 동작과 동일한 기능 제공\n<ul>\n<li>autoplay, mute, loop, playinline</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"gif-이미지-파일과-동일한-파일명에-mp4-파일-존재-유무-판단\" style=\"position:relative;\"><a href=\"#gif-%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%8C%8C%EC%9D%BC%EA%B3%BC-%EB%8F%99%EC%9D%BC%ED%95%9C-%ED%8C%8C%EC%9D%BC%EB%AA%85%EC%97%90-mp4-%ED%8C%8C%EC%9D%BC-%EC%A1%B4%EC%9E%AC-%EC%9C%A0%EB%AC%B4-%ED%8C%90%EB%8B%A8\" aria-label=\"gif 이미지 파일과 동일한 파일명에 mp4 파일 존재 유무 판단 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gif 이미지 파일과 동일한 파일명에 mp4 파일 존재 유무 판단</h1>\n<ul>\n<li>\n<p>예제코드</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createVideoFromGif</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>element<span class=\"token operator\">:</span> HTMLImageElement<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> videoElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  videoElement<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'muted'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  videoElement<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loop'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  videoElement<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'video/mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 모바일 브라우저에서 비디오를 인라인으로 재생하기 위해서는 다음 주요 속성을 추가해야 한다.</span>\n  <span class=\"token comment\">// Android용 Chrome의 경우 autoplay, muted만 필요하지만 Safari를 사용하는 경우 playsinline 모두 필요!</span>\n  videoElement<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'playsinline'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 지연 로딩을 위해서 적용된 dataset.src를 video에도 적용하기 위해서 추가</span>\n  videoElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gif'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// layout shift 방지를 위해서 사용되는 이미지 높이/너비값을 저장한 dataset도 video 태그에도 적용</span>\n  videoElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>naturalWidth <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n  videoElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>naturalHeight <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> videoElement<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<h1 id=\"초기-로딩-시-layout-shift-방지를-위한-mp4-placeholder-지정\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EA%B8%B0-%EB%A1%9C%EB%94%A9-%EC%8B%9C-layout-shift-%EB%B0%A9%EC%A7%80%EB%A5%BC-%EC%9C%84%ED%95%9C-mp4-placeholder-%EC%A7%80%EC%A0%95\" aria-label=\"초기 로딩 시 layout shift 방지를 위한 mp4 placeholder 지정 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>초기 로딩 시 layout shift 방지를 위한 mp4 placeholder 지정</h1>\n<ul>\n<li>\n<p>예제코드</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">&lt;</span>video <span class=\"token operator\">~</span><span class=\"token operator\">~</span> data<span class=\"token operator\">-</span>natural<span class=\"token operator\">-</span>width<span class=\"token operator\">=</span><span class=\"token string\">\"300\"</span> data<span class=\"token operator\">-</span>natural<span class=\"token operator\">-</span>height<span class=\"token operator\">=</span><span class=\"token string\">\"300\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">const</span> video <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> dataset<span class=\"token punctuation\">,</span> style <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> video<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> naturalHeight<span class=\"token punctuation\">,</span> naturalWidth <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> dataset<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// layout shift 방지를 위한 엘리먼트 높이값 지정</span>\n<span class=\"token keyword\">const</span> heightRate <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>naturalHeight <span class=\"token operator\">/</span> naturalWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nstyle<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>naturalWidth <span class=\"token operator\">*</span> heightRate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<h1 id=\"사용자-viewport-최초-진입재진입벗어날-경우에-대한-mp4-처리\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-viewport-%EC%B5%9C%EC%B4%88-%EC%A7%84%EC%9E%85%EC%9E%AC%EC%A7%84%EC%9E%85%EB%B2%97%EC%96%B4%EB%82%A0-%EA%B2%BD%EC%9A%B0%EC%97%90-%EB%8C%80%ED%95%9C-mp4-%EC%B2%98%EB%A6%AC\" aria-label=\"사용자 viewport 최초 진입재진입벗어날 경우에 대한 mp4 처리 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 viewport 최초 진입/재진입/벗어날 경우에 대한 mp4 처리</h1>\n<ul>\n<li>\n<p>예제코드</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">const</span> video <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>entry <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> target<span class=\"token punctuation\">,</span> intersectionRatio <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>intersectionRatio <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t      <span class=\"token comment\">// 비디오가 뷰포트에 진입한 경우</span>\n\t        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>src <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 최초 mp4가 뷰포트에 진입한 경우(지연로딩)</span>\n\t\t        target<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">;</span>\n\n\t\t        target<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t\t<span class=\"token comment\">// NotAllowedError</span>\n              <span class=\"token comment\">// 브라우저에서 미디어 재생이 되지 않는 경우, 보통 사파리 브라우저 정책으로 인해 안되는 경우</span>\n              <span class=\"token comment\">// Auto-play was prevented(low power mode)</span>\n              <span class=\"token comment\">// Do something like adding controls to allow user to manually play</span>\n\n              <span class=\"token comment\">// NotSupportedError</span>\n              <span class=\"token comment\">// MediaSource가 지원되는 포맷으로 표현되지 않는 경우(예: 안드로이드 웹뷰에서 mp4 사이즈가 큰 경우)</span>\n\t\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>target <span class=\"token operator\">&amp;&amp;</span> target<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t\t\t<span class=\"token keyword\">const</span> imageElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t\t<span class=\"token comment\">// 브라우저 로딩 이슈로 인해서 로딩이 안될 경우 .gif 확장자로 다시 재로딩</span>\n\t\t\t\t\t\t\t  imageElement<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gif'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t\t\t  <span class=\"token comment\">// 이미지 높이값도 동일한게 지정</span>\n\t\t\t\t\t\t\t  imageElement<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t\t\ttarget<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>imageElement<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t        <span class=\"token punctuation\">}</span>\n\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>paused<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 비디오가 일시정지 된 경우</span>\n            target<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 브라우저 로딩이 실패한 경우</span>\n              <span class=\"token comment\">// NotAllowedError</span>\n              <span class=\"token comment\">// 브라우저에서 미디어 재생이 되지 않는 경우, 보통 사파리 브라우저 정책으로 인해 안되는 경우</span>\n              <span class=\"token comment\">// Auto-play was prevented(low power mode)</span>\n              <span class=\"token comment\">// Do something like adding controls to allow user to manually play</span>\n\n              <span class=\"token comment\">// NotSupportedError</span>\n              <span class=\"token comment\">// MediaSource가 지원되는 포맷으로 표현되지 않는 경우(예: 안드로이드 웹뷰에서 mp4 사이즈가 큰 경우)</span>\n\t\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>target <span class=\"token operator\">&amp;&amp;</span> target<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t\t\t<span class=\"token keyword\">const</span> imageElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t\t<span class=\"token comment\">// 브라우저 로딩 이슈로 인해서 로딩이 안될 경우 .gif 확장자로 다시 재로딩</span>\n\t\t\t\t\t\t\t  imageElement<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gif'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t\t\t  <span class=\"token comment\">// 이미지 높이값도 동일한게 지정</span>\n\t\t\t\t\t\t\t  imageElement<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t\t\ttarget<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>imageElement<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t        <span class=\"token comment\">// 비디오가 뷰포트를 벗어난 경우</span>\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>target<span class=\"token punctuation\">.</span>paused<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            target<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>","frontmatter":{"title":"FE 성능개선 - gif to mp4 변환","date":"2025.02.09","category":"개발","tags":["performance"]},"tableOfContents":"<ul>\n<li><a href=\"#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li><a href=\"#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D\">요구사항 분석</a></li>\n<li><a href=\"#gif-%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%8C%8C%EC%9D%BC%EA%B3%BC-%EB%8F%99%EC%9D%BC%ED%95%9C-%ED%8C%8C%EC%9D%BC%EB%AA%85%EC%97%90-mp4-%ED%8C%8C%EC%9D%BC-%EC%A1%B4%EC%9E%AC-%EC%9C%A0%EB%AC%B4-%ED%8C%90%EB%8B%A8\">gif 이미지 파일과 동일한 파일명에 mp4 파일 존재 유무 판단</a></li>\n<li><a href=\"#%EC%B4%88%EA%B8%B0-%EB%A1%9C%EB%94%A9-%EC%8B%9C-layout-shift-%EB%B0%A9%EC%A7%80%EB%A5%BC-%EC%9C%84%ED%95%9C-mp4-placeholder-%EC%A7%80%EC%A0%95\">초기 로딩 시 layout shift 방지를 위한 mp4 placeholder 지정</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-viewport-%EC%B5%9C%EC%B4%88-%EC%A7%84%EC%9E%85%EC%9E%AC%EC%A7%84%EC%9E%85%EB%B2%97%EC%96%B4%EB%82%A0-%EA%B2%BD%EC%9A%B0%EC%97%90-%EB%8C%80%ED%95%9C-mp4-%EC%B2%98%EB%A6%AC\">사용자 viewport 최초 진입/재진입/벗어날 경우에 대한 mp4 처리</a></li>\n</ul>"}}]}},"pageContext":{"slug":"/blog/2025/02/2025-02-09-git-to-mp4-convert/","previous":null,"next":{"fields":{"slug":"/blog/2024/12/2024-12-05-react-v19/"},"frontmatter":{"title":"react v19"}}}},"staticQueryHashes":["3940312266","4157816502"],"slicesMap":{}}