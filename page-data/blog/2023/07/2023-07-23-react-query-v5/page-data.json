{"componentChunkName":"component---src-components-templates-post-template-tsx","path":"/blog/2023/07/2023-07-23-react-query-v5/","result":{"data":{"site":{"siteMetadata":{"title":"홍승아 기술 블로그","description":"홍승아 기술 블로그에 오신걸 환영합니다.","author":"홍승아","type":"website","siteUrl":"https://seungahhong.github.io","social":{"facebook":"https://www.facebook.com/people/%ED%99%8D%EC%8A%B9%EC%95%84/100002349562000/","github":"https://github.com/seungahhong","notion":"https://material-debt-c1c.notion.site/daa60481e37840ea9e1b7e1b12269942","linkedin":"https://www.linkedin.com/in/seungahhong/"}}},"allFile":{"edges":[{"node":{"name":"facebook","publicURL":"/static/b185e9b61bb465d92b14ed1c9a9ded61/facebook.svg","childImageSharp":null}},{"node":{"name":"github","publicURL":"/static/4a6687a74051de2b3536e95d0b6c992a/github.svg","childImageSharp":null}},{"node":{"name":"linkedin","publicURL":"/static/3dc9e0d0f748678205218f1c72941cc2/linkedin.svg","childImageSharp":null}},{"node":{"name":"notion","publicURL":"/static/19b0f81386812ed2f2f3a7aea202935f/notion.svg","childImageSharp":null}},{"node":{"name":"background","publicURL":"/static/77f5c833c2343c992fd263c780495905/background.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAjABQDASIAAhEBAxEB/8QAGwABAAEFAQAAAAAAAAAAAAAAAAcEBggJCgX/xAAXAQEBAQEAAAAAAAAAAAAAAAAHBQYI/9oADAMBAAIQAxAAAAG5fRl7U4Ddg9LblwJg9mPTTxjbDu2KyVVZmqWuNuZyEMin/wD/xAAcEAADAQEBAAMAAAAAAAAAAAADBAUGAgcAARb/2gAIAQEAAQUCocsCqedUserp/wBPHH8jrdcIUUCzly6d9kvsIW5VVVRpQmuEKvdas00RPa7ztxVPfbJZDS1qT9pMnf30lSbAH//EACYRAAIBAgYBBAMAAAAAAAAAAAECAwQRAAUGEiEiURUjJDEyQWH/2gAIAQMBAT8Bzv5dFVU/uOqwNDUzQtZ5I5I5Cw3LwrSlW3MlnQv1Kk3I0npF+3q1dz5y/MOLWG3lr9fxH8Axnea1WXZnSUNRX08GXSVirDBIIxJJU7WXsZS14nXmMohJkSVS0bKRMuvKG3WPLI1+lSSirEkCg2G9UfarW5IH0f0Dxitmmk1PvklkdzqqMl3dmYlaqqRTuJJuqkqPCmw4xFGhjQlEJKgklQST5Jtj/8QAJREAAgEDAwQCAwAAAAAAAAAAAQIDBBESBSEiAAYTMRRRIzJB/9oACAECAQE/Ae1JFnkdPKKaSJ6b42KoyySCQKZGV8hIo2Zl2BV25C11v3Iu2NGP6cVpCtzYkg7fsTf0PfrrQaWOv0RsKKSerpaYg1NN5eNOHGCgxGLGpSzK4Zx+PBhlkTEmga9EiRqlVZERR4a+hMQsq8YzJBmUU8VyubD217mijSPRI0jRY0GjiyIoVReGFjxUAbnc/Z36lVfI/Fff0Ov/xAAnEAACAgIBAwMFAQEAAAAAAAACAwEEBRIRABMhFCIjBhUxMkEzQv/aAAgBAQAGPwK6haou0UFLaxMVvXbjsnEOhRDx/mLSZA8SJLIp0kJiOIN1ux6qp3Jp4744r3LUEJahcOB3aLI+NZiLHCPCzaXtL5N0tbAtaonVAYszGPawGWlkJ6wMz7Y8TE/mZ6mMuEVFgtoMKzPaBkysglEsOQEhktpAIOC4ITVO4dZB5bxMXAq1ZmDBczEtdLmP/bxAQCBDUjOJZ3Q7fBMbcRzZkvlYwmbunWC7xbq2nuc88z+0e7meeeqH1LFmweGysIpWVy9p1aOTAfEwki7SBtpiHrKBHl6nrjzrzSr/AFLinRTy2O9fi6EZ6vVX6w8hX+2NYu/DAxmSTDoKiu8sStLddMlxsA9W7f1JlalDLcJr2KmftprZJA1lClK2AK0gYAoAFbljK3DHcAzgtuk2LnpTwaqbrZ22optGL2MkbaeHXEvTVf2YYyswEy8LSAFJAZj04U/eJydx9Aq966JhaJ+NriijaymQkPZXfdgspkBSveWuawobzwFC5coY7IFm6isusKWU7I48GbUjpPQ+u0q9grNGxfJMTCxC8vQeJ2K4Ny494VnenrqIuEJUGpQK0DqkfdOxFAbmXuMiLz0JTPMzERPMDPjYv5Mcfz+dQAEmY8T8tSo8vKw/7ehh6x+BHbUY8DER1//EABgQAQEBAQEAAAAAAAAAAAAAAAERACEx/9oACAEBAAE/IbjsjUQRDOG9yM8H6LHI1AF3hlR4BZJXKJMAACir473dyInWJOxmpkMQVQyHcnAdNamkCXWEAXfdQjTuahHixtYFU0pQAeZZgBWyPe+FR7akoVqS8vRqyotR0D6hilumzYosaSmxtobuIHifhRG0qHV6ADEvZwQQODoHg26va3vwzkwOFw+G/9oADAMBAAIAAwAAABCXI3JwL//EABgRAQEBAQEAAAAAAAAAAAAAAAERIQBR/9oACAEDAQE/EHVZhUihLRqkO8CCpiJbbqCaOqvbbsrimolDvsLCAEV0QgdoxxETJNt6DzBak1rJJOTOQCBVCVXVVV17/8QAGhEBAQEBAAMAAAAAAAAAAAAAAREhADFhkf/aAAgBAgEBPxCdZEzDipJRYSdhRs8DCKDVDaK1Cpytj88Ix2j+p65EH8wCDqRIkDLkWSkDjoBM4JqrvLRZWqsrmrPR87//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPxBCvOwQu7PBe3aLTISCyfpEzgoKtriaxgWDxMzHb6d+Bd6TsASFFvYtFa9FIPaEtI3sbizgSsxk2P2s9d12ptjbwWm2LYGMjAp2NKChKJmGwzNWyYEVqx80qLWAlWnhTgQBmZsmRhBMOyzEJshRGqitlRChJ6SsgOcmYx4ScH8i4H//2Q=="},"images":{"fallback":{"src":"/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg","srcSet":"/static/77f5c833c2343c992fd263c780495905/9330e/background.jpg 139w,\n/static/77f5c833c2343c992fd263c780495905/53b4d/background.jpg 278w,\n/static/77f5c833c2343c992fd263c780495905/c2a83/background.jpg 555w","sizes":"(min-width: 555px) 555px, 100vw"},"sources":[{"srcSet":"/static/77f5c833c2343c992fd263c780495905/3ee68/background.webp 139w,\n/static/77f5c833c2343c992fd263c780495905/d0ff1/background.webp 278w,\n/static/77f5c833c2343c992fd263c780495905/21b9c/background.webp 555w","type":"image/webp","sizes":"(min-width: 555px) 555px, 100vw"}]},"width":555,"height":961}}}}]},"allMarkdownRemark":{"edges":[{"node":{"html":"<h1 id=\"v5-변경사항\" style=\"position:relative;\"><a href=\"#v5-%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD\" aria-label=\"v5 변경사항 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v5 변경사항</h1>\n<h2 id=\"install\" style=\"position:relative;\"><a href=\"#install\" aria-label=\"install permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install</h2>\n<h3 id=\"react-query--tanstackreact-query로-변경\" style=\"position:relative;\"><a href=\"#react-query--tanstackreact-query%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"react query  tanstackreact query로 변경 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>react-query → @tanstack/react-query로 변경</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i @tanstack/react-query@alpha\n<span class=\"token comment\"># or</span>\n$ <span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> @tanstack/react-query@alpha\n<span class=\"token comment\"># or</span>\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @tanstack/react-query@alpha</code></pre></div>\n<h2 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requirements</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">Chrome <span class=\"token operator\">>=</span> <span class=\"token number\">84</span><span class=\"token punctuation\">;</span>\nFirefox <span class=\"token operator\">>=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">;</span>\nEdge <span class=\"token operator\">>=</span> <span class=\"token number\">84</span><span class=\"token punctuation\">;</span>\nSafari <span class=\"token operator\">>=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\niOS <span class=\"token operator\">>=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\nopera <span class=\"token operator\">>=</span> <span class=\"token number\">70</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"new-features\" style=\"position:relative;\"><a href=\"#new-features\" aria-label=\"new features permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>New Features</h2>\n<ul>\n<li>\n<p>Simplified optimistic updates</p>\n<ul>\n<li>낙관적 UI 업데이트에 필요한 variables 사용방법이 간단해졌습니다(리턴값으로 variables가 리턴)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> queryInfo <span class=\"token operator\">=</span> <span class=\"token function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> addTodoMutation <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">mutationFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>newTodo<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> newTodo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> variables<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// I will fire first</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">onError</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">,</span> variables<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// I will fire first</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">onSettled</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">,</span> variables<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\naddTodoMutation<span class=\"token punctuation\">.</span><span class=\"token function\">mutate</span><span class=\"token punctuation\">(</span>variables<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  onError<span class=\"token punctuation\">,</span>\n  onSuccess<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queryInfo<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>queryInfo<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>todo <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>todo<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>todo<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>addTodoMutation<span class=\"token punctuation\">.</span>isPending <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span>\n          <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>addTodoMutation<span class=\"token punctuation\">.</span>submittedAt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> opacity<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token punctuation\">{</span>addTodoMutation<span class=\"token punctuation\">.</span>variables<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>New combine option for useQueries</p>\n<ul>\n<li>useQueries에 호출되는 query에 대한 합칠 수 있는 combine 속성이 추가 되었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> ids <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> combinedQueries <span class=\"token operator\">=</span> <span class=\"token function\">useQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queries<span class=\"token operator\">:</span> ids<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchPost</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">combine</span><span class=\"token operator\">:</span> results <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      data<span class=\"token operator\">:</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=></span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      pending<span class=\"token operator\">:</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=></span> result<span class=\"token punctuation\">.</span>isPending<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Limited, Infinite Queries with new maxPages option</p>\n<ul>\n<li>Infinite Query 는 많은 페이지를 가져올수록, 더 많은 메모리를 소비하고, 이는 모든 페이지가 순차적으로 refetch되어야 하므로 query refetch 과정을 느려지게 됩니다.</li>\n<li>maxPages를 제공함으로써 최대 페이지수를 제공해서 꼭 필요한 페이지만 얻어오도록 처리가 가능하다.</li>\n</ul>\n</li>\n<li>\n<p>Prefetching Infinite Queries</p>\n<ul>\n<li>Infinite Queries에서도 프리페치 기능이 추가되었습니다.</li>\n<li>1 페이지 이상의 데이터를 미리 로딩하고 싶으면, pages 옵션에 숫자를 지정해서 미리 page 데이터를 로딩이 가능합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">prefetchTodos</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// The results of this query will be cached like a normal query</span>\n  <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'projects'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> fetchProjects<span class=\"token punctuation\">,</span>\n    defaultPageParam<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>lastPage<span class=\"token punctuation\">,</span> pages<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> lastPage<span class=\"token punctuation\">.</span>nextCursor<span class=\"token punctuation\">,</span>\n    pages<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// prefetch the first 3 pages</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Typing Query Options(Typesafe way to create Query Options)</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> queryOptions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">queryOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> fetchGroups<span class=\"token punctuation\">,</span>\n    staleTime<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nqueryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> queryOptions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">queryOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> fetchGroups<span class=\"token punctuation\">,</span>\n    staleTime<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nqueryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token function\">groupOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"change-features\" style=\"position:relative;\"><a href=\"#change-features\" aria-label=\"change features permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Change Features</h2>\n<ul>\n<li>\n<p>Supports a single signature, one object</p>\n<ul>\n<li>함수 호출 시그니처(객체 형식) 만을 지원</li>\n<li>useQuery, useInfiniteQuery 등을 인자로 제공함에 따라서 타입스크립트에서 많은 오버르도를 가지곤 했고, 이걸 통해서 타입 유지, 인자별로 어떤 타입이지를 체크하는 런타임 검사가 필요했습니다.</li>\n<li>따라서 v5부터는 오직 객체 형식만 지원합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">-</span><span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> mutationFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  <span class=\"token function\">useIsFetching</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">useIsFetching</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  <span class=\"token function\">useIsMutating</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">useIsMutating</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> mutationKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">isFetching</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">isFetching</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">ensureQueryData</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">ensureQueryData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueriesData</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueriesData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">setQueriesData</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> updater<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">setQueriesData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> updater<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">removeQueries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">removeQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">resetQueries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">resetQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">cancelQueries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">cancelQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">refetchQueries</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">refetchQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">fetchQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">fetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">fetchInfiniteQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">fetchInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchInfiniteQuery</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>options <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryCache<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryCache<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryCache<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryCache<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Callback on useQuery(and QueryObserver) have been removed\noptions에 onSuccess, onError, onSettled 콜백 함수가 제거되었습니다.(단, mutation에 대해서는 적용하지 않음)</p>\n<ul>\n<li>쿼리당 한번만 호출되는 콜백인 전역 캐시 단계 콜백 사용\n<ul>\n<li>쿼리 마다 다른 메시지를 보여줄 경우에는 meta 필드를 사용</li>\n</ul>\n</li>\n<li>추가적인 렌더링 사이클\n<ul>\n<li>useState로 관를 할 경우 값이 동기화 되는 중간레이어에 상태가 렌더링 되는 경우가 발생</li>\n<li>원하는 상태값을 객체 형식으로 리턴하도록 처리</li>\n</ul>\n</li>\n<li>fetch가 발생해야 실행되는 콜백 함수 사용대시 실제 data changed를 deps로 걸어서 변경해보자.\n<a href=\"https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose\" target=\"_blank\" rel=\"nofollow\">https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// <span class=\"token operator\">&lt;=</span> v4\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function-name function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin class-name\">return</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span><span class=\"token punctuation\">]</span>,\n    queryFn: fetchTodos,\n    onError: <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n      toast.error<span class=\"token punctuation\">(</span>error.message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function-name function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  const <span class=\"token punctuation\">[</span>todoCount, setTodoCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React.useState<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  const <span class=\"token punctuation\">{</span> data: todos <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span><span class=\"token punctuation\">]</span>,\n    queryFn: fetchTodos,\n    //😭 please dont\n    onSuccess: <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n      setTodoCount<span class=\"token punctuation\">(</span>data.length<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin class-name\">return</span> <span class=\"token punctuation\">{</span> todos, todoCount <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function-name function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  const <span class=\"token punctuation\">{</span> dispatch <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> useDispatch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin class-name\">return</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span><span class=\"token punctuation\">]</span>,\n    queryFn: fetchTodos,\n    onSuccess: <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n      dispatch<span class=\"token punctuation\">(</span>setTodos<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">))</span>\n    <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n// <span class=\"token operator\">>=</span> v5\nconst queryClient <span class=\"token operator\">=</span> new QueryClient<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryCache: new QueryCache<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    onError: <span class=\"token punctuation\">(</span>error, query<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>query.meta.errorMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        toast.error<span class=\"token punctuation\">(</span>query.meta.errorMessage<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>,\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function-name function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin class-name\">return</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span><span class=\"token punctuation\">]</span>,\n    queryFn: fetchTodos,\n    meta: <span class=\"token punctuation\">{</span>\n      errorMessage: <span class=\"token string\">'Failed to fetch todos'</span>,\n    <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function-name function\">useTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  const <span class=\"token punctuation\">{</span> data: todos <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span><span class=\"token punctuation\">]</span>,\n    queryFn: fetchTodos,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  const todoCount <span class=\"token operator\">=</span> todos?.length ?? <span class=\"token number\">0</span>\n\n  <span class=\"token builtin class-name\">return</span> <span class=\"token punctuation\">{</span> todos, todoCount <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token keyword\">function</span> useTodos<span class=\"token punctuation\">(</span>filters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  const <span class=\"token punctuation\">{</span> dispatch <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> useDispatch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  const query <span class=\"token operator\">=</span> useQuery<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey: <span class=\"token punctuation\">[</span><span class=\"token string\">'todos'</span>, <span class=\"token string\">'list'</span>, <span class=\"token punctuation\">{</span> filters <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,\n    queryFn: <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> fetchTodos<span class=\"token punctuation\">(</span>filters<span class=\"token punctuation\">)</span>,\n    staleTime: <span class=\"token number\">2</span> * <span class=\"token number\">60</span> * <span class=\"token number\">1000</span>,\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  React.useEffect<span class=\"token variable\"><span class=\"token punctuation\">((</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> {\n    if <span class=\"token punctuation\">(</span>query.data<span class=\"token punctuation\">)</span> {\n      dispatch<span class=\"token punctuation\">(</span>setTodos<span class=\"token punctuation\">(</span>query.data<span class=\"token punctuation\">))</span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>, <span class=\"token punctuation\">[</span>query.data<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin class-name\">return</span> query\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Rename cacheTime to gcTime</p>\n<ul>\n<li>쿼리가 사용되지 않는 상태에서의 사용되는 cacheTime 명칭이 헷갈리는 이슈로 명칭이 gc(garbage collect)로 변경됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token constant\">MINUTE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  defaultOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    queries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">-</span>      cacheTime<span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token constant\">MINUTE</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>      gcTime<span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token constant\">MINUTE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Infinite queries now need a defaultPageParam</p>\n<ul>\n<li>이전에는 pageParam 기본값을 지정할 수 있었지만, v5에서는 defaultPageParam으로 지정하는 방식으로 변경되었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">-</span> <span class=\"token function\">refetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token function-variable function\">refetchPage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> index <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// index === {refetch하고 싶은 페이지}</span>\n\n<span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n   queryKey<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">-</span>  <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pageParam <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchSomething</span><span class=\"token punctuation\">(</span>pageParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>  <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pageParam <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchSomething</span><span class=\"token punctuation\">(</span>pageParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>  defaultPageParam<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n   <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>lastPage<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> lastPage<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>status: loading → status: pending, isLoading → isPending, isInitialLoading → isLoading</p>\n<ul>\n<li>v4 오프라인 모드 지원을 위해서 상태가 변경되었던게 다시 의미에 맞게 정리 되었습니다.</li>\n</ul>\n</li>\n<li>\n<p>The minimum required Typescript version is now 4.7</p>\n<ul>\n<li>타입스크립트 타입 추론 관련한 중요한 버그 수정이 있어서 해당 버전을 최소 버전으로 지정</li>\n</ul>\n</li>\n<li>\n<p>Typescript: Error is now the default type for errors instead of unknown</p>\n<ul>\n<li>API 에 기본 타입에러는 Error 입니다. 단, 이전에는 타입스크립트에서 타입 지정이 모호한 경우 unknown을 사용했었지만, v5 넘어오면서 기본 타입이 Error로 변경되었습니다.</li>\n<li>만약 커스텀 에러를 던지고 싶다면 에러 필드의 타입을 구체화 하면 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> queryFn<span class=\"token operator\">:</span> fetchGroups <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ^? const error: Error</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Group<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'groups'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> fetchGroups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ^? const error: string | null</span></code></pre></div>\n</li>\n<li>\n<p>The minimum required React version is now 18.0</p>\n<ul>\n<li>v5 이후부터는 react v18 이상을 지원합니다. 이유는 내부적으로 useSyncExternalStore 사용하는데 해당 함수는 react v18 이상에서 지원하기 때문입니다.</li>\n</ul>\n</li>\n<li>\n<p>The useErrorBoundary options has been renamed to throwOnError</p>\n<ul>\n<li>특정 프레임워크에 종속되지 않고. react use/ErrorBoudary 컴포넌트명을 혼동을 피하기 위해서 throwOnError 로 변경</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  defaultOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    queries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">-</span> useErrorBoundary<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\tthrowOnError<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    mutations<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">-</span> useErrorBoundary<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t\tthrowOnError<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>getQueryData, getQueryState now accepts querykey only as an argument</p>\n<ul>\n<li>queryClient.getQueryData, queryClient.getQueryState 인자를 오직 쿼리키만 받기로 변경됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">-</span>queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryData</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryData</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryState</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">,</span> filters<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryState</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>The remove method has bean removed from useQuery</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey<span class=\"token punctuation\">,</span> queryFn <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">removeQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> queryKey <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>The isDataEqual options has been removed from useQuery</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> replaceEqualDeep <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span>\n\n<span class=\"token operator\">-</span> <span class=\"token function-variable function\">isDataEqual</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>oldData<span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">customCheck</span><span class=\"token punctuation\">(</span>oldData<span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">+</span> <span class=\"token function-variable function\">structuralSharing</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>oldData<span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">customCheck</span><span class=\"token punctuation\">(</span>oldData<span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> oldData <span class=\"token operator\">:</span> <span class=\"token function\">replaceEqualDeep</span><span class=\"token punctuation\">(</span>oldData<span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>The deprecated custom logger has been removed</p>\n<ul>\n<li>v4에서 deprecated 된 logger 관련 처리가 아예 삭제됨</li>\n</ul>\n</li>\n<li>\n<p>Private class fields and methods</p>\n<ul>\n<li><strong><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields\" target=\"_blank\" rel=\"nofollow\">ECMAScript Private class features</a></strong> 스펙이 실제 react-query 코드에 적용됨</li>\n</ul>\n</li>\n<li>\n<p>eslint prefer-query-object-syntax rule is removed</p>\n</li>\n<li>\n<p>Removed keepPreviousData in favor of placeholderData identity function</p>\n<ul>\n<li>keepPreviousData 옵션과 isPreviousData 제거 되었습니다. placeholderData, isPlaceholderData 플래그와 거의 유사한 동작이여서 제거 되었습니다.</li>\n<li>단, keepPreviouseData는 이전 query 상태를 주웠지만, placeholder는 언제나 최신 상태를 전달해줍니다. 혹여 이전 상태여부를 알아야할 경우에는 dataUpdateAt 상태를 관리한다면 구현이 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>updatedAt<span class=\"token punctuation\">,</span> setUpdatedAt<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n   data<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">-</span>  isPreviousData<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>  isPlaceholderData<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n  queryFn<span class=\"token punctuation\">,</span>\n<span class=\"token operator\">-</span> keepPreviousData<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span> placeholderData<span class=\"token operator\">:</span> keepPreviousData\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dataUpdatedAt <span class=\"token operator\">></span> updatedAt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setUpdatedAt</span><span class=\"token punctuation\">(</span>dataUpdatedAt<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>dataUpdatedAt<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Removed custom context prop in favor of custom queryClient instance, Remove contextsharing\n모든 react-query hook에서 사용할 수 있는 context 옵션이 삭제 되었습니다.(그로 인해서 contextSharing 옵션도 같이 삭제 되었습니다.)\ncontext는 리액트에서만 사용이 가능함으로, 멀티 플랫폼에서 사용 가능하도록 queryClient를 전달하도록 변경되었습니다. 기존 context 기능도 queryClient 접근 권한만 주는거라서 동작에는 기존 동작에는 이슈가 없습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> queryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./my-client'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'users'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">-</span>   context<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">+</span>  queryClient<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Removed refetchPage in favor of maxPages</p>\n<ul>\n<li>v4에서 refetchPage를 제공했지만, 전체페이지 로딩(필터)한다면 infinite queries에 용도와 맞지 않는 이슈가 있어서 refechPage는 삭제처리 하였음</li>\n<li>단, 최대 페이지 수를 제한하는 기능인 maxPages 옵션이 추가되었습니다.</li>\n</ul>\n</li>\n<li>\n<p>Window focus refetching no longer listens to the focus event</p>\n<ul>\n<li>visibilitychange 이벤트를 지원하는 브라우저만 지원하기로 결정했기 때문에, 이전에 사용하던 focus 이벤트는 listen 하지 않음</li>\n</ul>\n</li>\n<li>\n<p>No longer using unstable_batchedUpdates as the batching function in React and React Native</p>\n<ul>\n<li>react, react-native에서 배치 실행 시 사용되는 unstable_batchedUpdates를 더 이상 사용하지 않음.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> notifyManager <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/query-core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> batch <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'solid-js'</span><span class=\"token punctuation\">;</span>\n\nnotifyManager<span class=\"token punctuation\">.</span><span class=\"token function\">setBatchNotifyFunction</span><span class=\"token punctuation\">(</span>batch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Hydrate has been renamed to HydrationBoundary and the useHydrate hook has been removed\nHydrate 이름이 HydrationBoundary로 변경, useHydrate hook은 제거 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">-</span> <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Hydrate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span>\n<span class=\"token operator\">+</span> <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HydrationBoundary <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span>\n\n<span class=\"token operator\">-</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hydrate</span></span> <span class=\"token attr-name\">state</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>dehydratedState<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n+ </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HydrationBoundary</span></span> <span class=\"token attr-name\">state</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>dehydratedState<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n- </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Hydrate</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n+ </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">HydrationBoundary</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"v4--v5-migraion-tools-codemod\" style=\"position:relative;\"><a href=\"#v4--v5-migraion-tools-codemod\" aria-label=\"v4  v5 migraion tools codemod permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v4 → v5 migraion tools: <a href=\"https://tanstack.com/query/v5/docs/react/guides/migrating-to-v5#codemod\" target=\"_blank\" rel=\"nofollow\">CodeMod</a></h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># jsx/js 인 경우</span>\nnpx jscodeshift ./path/to/src/ <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--extensions</span><span class=\"token operator\">=</span>js,jsx <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--transform</span><span class=\"token operator\">=</span>./node_modules/@tanstack/react-query/build/codemods/v5/remove-overloads/remove-overloads.js\n\n<span class=\"token comment\"># tsx/ts 인 경우</span>\nnpx jscodeshift ./path/to/src/ <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--extensions</span><span class=\"token operator\">=</span>ts,tsx <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--parser</span><span class=\"token operator\">=</span>tsx <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--transform</span><span class=\"token operator\">=</span>./node_modules/@tanstack/react-query/build/codemods/v5/remove-overloads/remove-overloads.js</code></pre></div>\n<h1 id=\"참고페이지\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80\" aria-label=\"참고페이지 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고페이지</h1>\n<ul>\n<li><a href=\"https://wonsss.github.io/library/tanstack-query-v5/#7-%EC%A7%80%EC%9B%90-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%B3%80%EA%B2%BD\" target=\"_blank\" rel=\"nofollow\">TanStack Query v5에서 변경사항</a></li>\n<li><a href=\"https://github.com/TanStack/query/milestone/2\" target=\"_blank\" rel=\"nofollow\">v5 Milestone · TanStack/query</a></li>\n<li><a href=\"https://tanstack.com/query/v5/docs/react/guides/migrating-to-v5\" target=\"_blank\" rel=\"nofollow\">Migrating to TanStack Query v5 | TanStack Query Docs</a></li>\n<li><a href=\"https://beomy.github.io/tech/react/tanstack-query-v4/#tanstackqueryprefer-query-object-syntax\" target=\"_blank\" rel=\"nofollow\">[React] TanStack Query v4 (React Query)</a></li>\n<li><a href=\"https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose\" target=\"_blank\" rel=\"nofollow\">Breaking React Query’s API on purpose</a></li>\n<li><a href=\"https://velog.io/@cnsrn1874/breaking-react-querys-api-on-purpose#%EB%82%98%EC%81%9C-api\" target=\"_blank\" rel=\"nofollow\">[번역] React Query API의 의도된 중단</a></li>\n</ul>","frontmatter":{"title":"react-query(v5)","date":"2023.07.23","category":"개발","tags":["상태관리"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#v5-%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD\">v5 변경사항</a></p>\n<ul>\n<li><a href=\"#install\">Install</a></li>\n<li><a href=\"#requirements\">Requirements</a></li>\n<li><a href=\"#new-features\">New Features</a></li>\n<li><a href=\"#change-features\">Change Features</a></li>\n<li><a href=\"#v4--v5-migraion-tools-codemod\">v4 → v5 migraion tools: CodeMod</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80\">참고페이지</a></p>\n</li>\n</ul>"}}]}},"pageContext":{"slug":"/blog/2023/07/2023-07-23-react-query-v5/","previous":{"fields":{"slug":"/blog/2023/08/2023-08-15-ecmascript/"},"frontmatter":{"title":"ecmascript"}},"next":{"fields":{"slug":"/blog/2023/07/2023-07-22-zustand/"},"frontmatter":{"title":"zustand"}}}},"staticQueryHashes":["3940312266","4157816502"],"slicesMap":{}}