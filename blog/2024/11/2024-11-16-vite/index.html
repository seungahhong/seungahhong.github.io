<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style data-styled="" data-styled-version="6.1.15">.dpzVnt{display:flex;flex:1;position:relative;margin:0 auto;align-items:start;width:1024px;max-width:1024px;}/*!sc*/
@media (max-width:1024px){.dpzVnt{margin:0;width:auto;}}/*!sc*/
data-styled.g1[id="PostContent__PostWrapper-sc-9jovib-0"]{content:"dpzVnt,"}/*!sc*/
.eUbyKZ{border-bottom:1px solid #e6e6e6;}/*!sc*/
.eUbyKZ>div{display:flex;flex:1;align-items:center;justify-content:space-between;margin:0 auto;max-width:1024px;padding:0 20px;}/*!sc*/
@media (max-width:1024px){.eUbyKZ>div{margin:0;min-width:auto;}}/*!sc*/
.eUbyKZ h1{font-size:24px;margin:12px 0 8px;}/*!sc*/
data-styled.g2[id="PostContent__PostHeadWrapper-sc-9jovib-1"]{content:"eUbyKZ,"}/*!sc*/
.bDPFHN{width:80%;}/*!sc*/
@media (max-width:1024px){.bDPFHN{width:100%;}}/*!sc*/
data-styled.g3[id="PostContent__PostContentWrapper-sc-9jovib-2"]{content:"bDPFHN,"}/*!sc*/
.dwHlbl{padding:0 20px;margin-bottom:48px;}/*!sc*/
.dwHlbl>h1{margin-bottom:8px;font-size:40px;}/*!sc*/
data-styled.g4[id="PostContent__PostTitle-sc-9jovib-3"]{content:"dwHlbl,"}/*!sc*/
.cbTbsU{display:inline-block;margin:12px 0 0 10px;position:sticky;top:20px;left:100%;transition:all 0.125s esse-in 0s;color:rgba(0,0,0,0.4);padding:0.25rem 0.75rem;border-left:2px solid gray;overflow:hidden auto;max-height:calc(-128px + 100vh);}/*!sc*/
.cbTbsU ul{list-style:none;}/*!sc*/
.cbTbsU ul li{margin-top:5px;}/*!sc*/
.cbTbsU ul li a{display:inline-block;}/*!sc*/
.cbTbsU ul li a.reach{color:#000000;}/*!sc*/
.cbTbsU ul ul{margin-left:12px;}/*!sc*/
@media (max-width:1024px){.cbTbsU{display:none;}}/*!sc*/
data-styled.g5[id="PostContent__TocRenderer-sc-9jovib-4"]{content:"cbTbsU,"}/*!sc*/
.lcuqXx{display:flex;flex-direction:column;word-break:keep-all;margin-bottom:250px;padding:0 20px;width:100%;line-height:1.8;font-size:16px;font-weight:400;}/*!sc*/
@media (max-width:1024px){.lcuqXx{margin-bottom:48px;}}/*!sc*/
.lcuqXx p{padding:3px 0;}/*!sc*/
.lcuqXx h1,.lcuqXx h2,.lcuqXx h3{font-weight:800;}/*!sc*/
.lcuqXx *+h1{margin-top:60px;}/*!sc*/
.lcuqXx *+h2{margin-top:40px;}/*!sc*/
.lcuqXx *+h3{margin-top:30px;}/*!sc*/
.lcuqXx hr+h1,.lcuqXx hr+h2,.lcuqXx hr+h3{margin-top:0;}/*!sc*/
.lcuqXx h1{font-size:30px;}/*!sc*/
.lcuqXx h2{font-size:25px;}/*!sc*/
.lcuqXx h3{font-size:20px;}/*!sc*/
.lcuqXx blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}/*!sc*/
.lcuqXx ol,.lcuqXx ul{margin-left:20px;padding:10px 0;}/*!sc*/
.lcuqXx hr{border:1px solid #000000;margin:100px 0;}/*!sc*/
.lcuqXx a{color:#4263eb;text-decoration:underline;}/*!sc*/
.lcuqXx pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}/*!sc*/
.lcuqXx pre[class*='language-'] ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.5);border-radius:3px;}/*!sc*/
.lcuqXx code[class*='language-'],.lcuqXx pre[class*='language-']{tab-size:2;}/*!sc*/
.lcuqXx img{width:100%;}/*!sc*/
.lcuqXx summary{cursor:pointer;font-size:24px;}/*!sc*/
data-styled.g6[id="PostContent__MarkdownRenderer-sc-9jovib-5"]{content:"lcuqXx,"}/*!sc*/
.eozcVb{margin:40px 0;display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0 20px;}/*!sc*/
.eozcVb h5{font-size:24px;margin-bottom:8px;}/*!sc*/
.eozcVb a{border-radius:6px;font-size:20px;color:#cc007a;font-weight:700;}/*!sc*/
data-styled.g7[id="PostContent__PostNavigator-sc-9jovib-6"]{content:"eozcVb,"}/*!sc*/
.kaFjH{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.7);color:#161b21;width:40px;height:40px;min-width:40px;font-size:20px;border:none;border-radius:50%;}/*!sc*/
.kaFjH>img{width:35px;height:35px;}/*!sc*/
data-styled.g8[id="PostContent__SocialLink-sc-9jovib-7"]{content:"kaFjH,"}/*!sc*/
.iqMMNl{display:grid;place-items:center;margin-top:auto;margin-left:0;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}/*!sc*/
@media (max-width:1024px){.iqMMNl{margin-left:0;}}/*!sc*/
data-styled.g16[id="Footer__FooterWrapper-sc-rphy7j-0"]{content:"iqMMNl,"}/*!sc*/
html{line-height:1.15;-webkit-text-size-adjust:100%;}/*!sc*/
body{margin:0;}/*!sc*/
main{display:block;}/*!sc*/
h1{font-size:2em;margin:0.67em 0;}/*!sc*/
hr{box-sizing:content-box;height:0;overflow:visible;}/*!sc*/
pre{font-family:monospace,monospace;font-size:1em;}/*!sc*/
a{background-color:transparent;}/*!sc*/
abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp{font-family:monospace,monospace;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
img{border-style:none;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
button,input{overflow:visible;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;}/*!sc*/
button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}/*!sc*/
button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}/*!sc*/
fieldset{padding:0.35em 0.75em 0.625em;}/*!sc*/
legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
textarea{overflow:auto;}/*!sc*/
[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}/*!sc*/
[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
details{display:block;}/*!sc*/
summary{display:list-item;}/*!sc*/
template{display:none;}/*!sc*/
[hidden]{display:none;}/*!sc*/
*{padding:0;margin:0;box-sizing:border-box;}/*!sc*/
html,body,#___gatsby{height:100%;word-break:keep-all;overflow-wrap:break-word;}/*!sc*/
#gatsby-focus-wrapper{height:100%;}/*!sc*/
a,a:hover{color:inherit;text-decoration:none;cursor:pointer;}/*!sc*/
.utterances{max-width:1024px;margin:0 auto;}/*!sc*/
data-styled.g18[id="sc-global-dhQtTb1"]{content:"sc-global-dhQtTb1,"}/*!sc*/
.iJvdpr{display:flex;flex-direction:column;height:100%;}/*!sc*/
data-styled.g19[id="Template__Container-sc-1a9t0ug-0"]{content:"iJvdpr,"}/*!sc*/
</style><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seungahhong.github.io/blog/2024/11/2024-11-16-vite/" data-baseprotocol="https:" data-basehost="seungahhong.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-TYGQRJE1B8', 'auto', {});
      
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G8Z1HZWWYL"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G8Z1HZWWYL', {"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Template__Container-sc-1a9t0ug-0 iJvdpr"><header class="PostContent__PostHeadWrapper-sc-9jovib-1 eUbyKZ"><div><a href="/"><h1>홍승아블로그</h1></a><a href="https://github.com/seungahhong" rel="noopener noreferrer" title="notion" target="_blank" size="35" class="PostContent__SocialLink-sc-9jovib-7 kaFjH"><img src="/static/4a6687a74051de2b3536e95d0b6c992a/github.svg" alt="Github Link Image"/></a></div></header><div class="PostContent__PostWrapper-sc-9jovib-0 dpzVnt"><div class="PostContent__PostContentWrapper-sc-9jovib-2 bDPFHN"><div class="PostContent__PostTitle-sc-9jovib-3 dwHlbl"><h1>CRA To Vite Migration</h1><time>2024.11.16</time></div><article class="PostContent__MarkdownRenderer-sc-9jovib-5 lcuqXx"><h1 id="vite를-사용해야-하는-이유" style="position:relative;"><a href="#vite%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0" aria-label="vite를 사용해야 하는 이유 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Vite를 사용해야 하는 이유</h1>
<h3 id="기존-모듈-번들러-문제점" style="position:relative;"><a href="#%EA%B8%B0%EC%A1%B4-%EB%AA%A8%EB%93%88-%EB%B2%88%EB%93%A4%EB%9F%AC-%EB%AC%B8%EC%A0%9C%EC%A0%90" aria-label="기존 모듈 번들러 문제점 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>기존 모듈 번들러 문제점</h3>
<ul>
<li>
<p>브라우저에서 Native ESM 방식을 지원하기 전까지는 Javascript 모듈화를 브라우저 레벨에서 진행할 수 없었고, 해당 소스 모듈을 브라우저에서 지원하기 위해서 require/IIFE/import,expor를 통한 모듈화 문법을 이용하여서 여러개의 파일로 합쳐주거나 의미 있는 단위로 묶어주는 기능을 번들링이라고 하며, 현재는 <a href="https://webpack.js.org/" target="_blank" rel="nofollow"><strong>Webpack</strong></a>, <a href="https://rollupjs.org/" target="_blank" rel="nofollow"><strong>Rollup</strong></a> 그리고 <a href="https://parceljs.org/" target="_blank" rel="nofollow"><strong>Parcel</strong></a>을 도구들이 지원하고 있습니다.</p>
</li>
<li>
<p>하지만 애플리케이션이 점점 더 발전함에 따라서 JS 도구들의 성능 병목 현상이 발생, HMR 사용하더라도 변경된 파일 적용 시 수초가 걸려서 개발자 생산성을 떨어뜨는 문제가 발생하고 있습니다.</p>
</li>
<li>
<p>ESM(ECMAScript Modules)</p>
<ul>
<li>ESM은 모듈화 문법인 import, export를 별도의 도구 없이 브라우저 자체에서 소화해 낼 수 있는 모듈 방식을 의미한다. 만약 아래와 같은 코드를 웹팩과 같은 번들러 없이 브라우저에서 실행하면 에러가 발생합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> sum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'test.js'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span>"app<span class="token punctuation">.</span>js<span class="token operator">></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></div>
<p><img src="./assets/06/Untitled.png" alt="Untitled">
예전에는 브라우저가 import와 export를 해석할 수 있는 능력이 없었지만 이제는 다음과 같이 속성을 추가하면 브라우저에서 import와 export를 소화할 수 있게 되었습니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"module"</span> src<span class="token operator">=</span>"app<span class="token punctuation">.</span>mjs<span class="token operator">></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></div>
</li>
</ul>
<h3 id="vite-특징" style="position:relative;"><a href="#vite-%ED%8A%B9%EC%A7%95" aria-label="vite 특징 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Vite 특징</h3>
<ul>
<li>
<p>콜드 스타트 방식의 개발 서버 구동에 대한 성능 개선
<img src="./assets/06/Untitled1.png" alt="Untitled"></p>
<ul>
<li>
<p>Dependencies: node_modulesd와 같이 내용이 바뀌지 않는 소스코드에 대해서 esbuild 이용한 사전 번들링 기능 제공</p>
<ul>
<li>
<p>esbuild는 webpack, parcel과 같은 기존의 번들러 대비 10-100배 빠른 속도를 제공</p>
</li>
<li>
<p>esbuild 로 node_modules 의 모든 패키지를 사전 번들링하여 아래와 같이 serving 하고 캐시</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// Dependencies package import 할 경우</span>
<span class="token keyword">import</span> dayjs <span class="token keyword">from</span> <span class="token string">'dayjs'</span><span class="token punctuation">;</span>

<span class="token comment">// vite esm 지원을 위한 변환/캐싱</span>
<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>deps<span class="token operator">/</span>dayjs<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>b09621d8</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Source code: Native ESM 방식을 적용해서 브라우저가 모듈을 직접 가져오고 변환 및 제공하도록 처리
<img src="./assets/06/Untitled2.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li>
<p>HMR 성능 개선
기존 번들러 기반에서는 소스 코드 변경 시 다시 번들링 과정을 다시 수행하다보니 성능이 느려지는 이슈를 Native ESM 방식을 사용하여 변경된 모듈만 교체해서 성능 개선
HTTP 헤더를 활용하여 페이지 로드 속도 개선(요청 횟수 최소화)</p>
<ul>
<li>304 Not Modified: 클라이언트 캐시 사용</li>
<li>Cache-Control: max-age=31536000, immutalble 이용한 캐시 사용</li>
</ul>
</li>
<li>
<p>프로덕션 환경 Rollup 사용</p>
<ul>
<li>가장 빠른 성능을 자랑하는 esbuild이지만 아쉬운 생태계와 브라우저용 번들링에서는 안정성이 떨어진다는 평가가 있어서 vite에서는 프로덕션 환경에서 Rollup 번들러를 사용(트리 셰이킹, 지연로딩, 파일 분활 등 성능 이점 제공)</li>
<li>Rollup은 v4에서 파서를 SWC 전환 → Rust 포팅인 Rolldown 만드는 작업을 진행 중이며 개발이 완료된다면 esbuild를 모두 대체 가능(개발/빌드 사이에 불이치 제거 목표)</li>
<li><a href="https://www.youtube.com/watch?v=EKvvptbTx6k" target="_blank" rel="nofollow">https://www.youtube.com/watch?v=EKvvptbTx6k</a></li>
</ul>
</li>
</ul>
<h1 id="cra-to-vite-migration" style="position:relative;"><a href="#cra-to-vite-migration" aria-label="cra to vite migration permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CRA to Vite Migration</h1>
<h2 id="base" style="position:relative;"><a href="#base" aria-label="base permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>base</h2>
<ul>
<li>
<p><strong>Remove CRA package for Vite</strong>
기존 CRA 환경에서 사용되는 패키지 삭제
기존에 설치된 node_modules가 있는경우 폴더 자체를 삭제</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> remove react-scripts react-app-rewired babel-loader webpack-merge tsconfig-paths-webpack-plugin

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules</code></pre></div>
</li>
<li>
<p><strong>Setting the Stage with Vite Installation</strong>
<strong>vite: 모던 웹 프로젝트 빌드 도구</strong></p>
<ul>
<li>@vitejs/plugin-react: @vitejs/plugin-react는 vite에서 React를 사용할 때 필요한 구성을 추가하여 React 애플리케이션의 빠른 개발 및 번들링을 지원</li>
<li>vite-tsconfig-paths: tsconfig.json 파일에 설정된 경로 별칭을 Vite에서도 적용할 수 있도록 지원. vite-tsconfig-paths를 사용하면 TypeScript 설정에 정의된 경로 별칭이 Vite에서도 인식되어 모듈 경로를 해석할 때 사용 가능</li>
<li>vite-plugin-svgr
<ul>
<li>SVG를 React 컴포넌트로 변환하는 Vite 플러그인</li>
<li>단, 3.3.0 이후 버전 설치 시 빌드, 타입 에러 발생(3.3.0 사용 시 아래와 같은 svgr을 리액트 컴포넌트로 변경 가능)</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">import</span> <span class="token punctuation">{</span> ReactComponent as ChannelLogo <span class="token punctuation">}</span> from <span class="token string">'../../assets/artwork-illust-pm-assign-info-channel-talk.svg'</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>vite-plugin-checker
<ul>
<li>vite를 사용하는 프로젝트에서 타입 체크, ESLint, VLS (Volar Language Server) 등을 포함한 여러 검사 기능을 제공하는 플러그인</li>
<li>비동기로 체크를 하기 때문에 개발 서버 환경 로딩 속도에 영향을 주지 않는 장점이 있다.</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add vite @vitejs/plugin-react vite-tsconfig-paths vite-plugin-svgr@3.3.0

yarn add vite-plugin-checker -D</code></pre></div>
</li>
<li>
<p><strong>Updating package.json for Vite Commands</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">scripts<span class="token string">": {
  "</span>start<span class="token string">": "</span>vite<span class="token string">", // dev-server
  "</span>build<span class="token string">": "</span>vite build", // build
<span class="token punctuation">}</span>,</code></pre></div>
</li>
<li>
<p><strong>Renaming React File Extensions to .jsx or .tsx</strong>
React JSX 문법을 사용하는 파일에 대해서만, jsx/tsx로 변경해주시면 됩니다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mv</span> src/App.js src/App.jsx
<span class="token function">mv</span> src/index.ts src/index.tsx</code></pre></div>
</li>
<li>
<p><strong>Move the index.html File</strong></p>
<ul>
<li>public 패스의 index.html 삭제하지 않을 경우 vite에서 개발 환경 로딩 시 public/index.html 선 로딩함으로 꼭 루트로 옮겨주세요!!</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mv</span> public/index.html <span class="token builtin class-name">.</span></code></pre></div>
</li>
<li>
<p><strong>Add module script to the bottom of the body tag</strong>
초기 로딩 시 코드 진입점을 명시해주세요.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  {/* others here */}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/src/index.tsx<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></div>
</li>
<li>
<p><strong>Update tsconfig.json</strong>
isolatedModules 사용이유</p>
<ul>
<li><strong>모듈 간의 의존성 격리</strong>: 각 모듈이 서로의 타입에 의존하지 않도록 하여, 컴파일 시 모듈을 개별적으로 처리합니다. 이를 통해 TypeScript의 컴파일 시간이 줄어들 수 있습니다.</li>
<li><strong>성능 향상</strong>: 독립적으로 모듈을 컴파일하면, 변화가 발생한 모듈만 다시 컴파일되므로 전체 컴파일 속도가 개선됩니다.</li>
<li><strong>ESM 호환성</strong>: ES 모듈과의 호환성을 높여, 다양한 빌드 도구와의 통합 시 더 나은 결과를 제공합니다.</li>
<li><strong>검사 오류 방지</strong>: 모든 모듈이 개별적으로 체크되므로, 한 모듈에서의 타입 오류가 다른 모듈에 영향을 미치는 것을 방지할 수 있습니다.
include에 vite.config.js 패스 설정</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span>
  <span class="token string">"extends"</span><span class="token builtin class-name">:</span> <span class="token string">"./tsconfig.extend.json"</span>,
  <span class="token string">"compilerOptions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"lib"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"dom"</span>, <span class="token string">"dom.iterable"</span>, <span class="token string">"es2020"</span><span class="token punctuation">]</span>,
    <span class="token string">"target"</span><span class="token builtin class-name">:</span> <span class="token string">"ES6"</span>,
    <span class="token string">"types"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"vite/client"</span>, <span class="token string">"react"</span>, <span class="token string">"react-dom"</span>, <span class="token string">"node"</span><span class="token punctuation">]</span>,
    <span class="token string">"isolatedModules"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span> // 추가
  <span class="token punctuation">}</span>,
  <span class="token string">"include"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"./src/**/*"</span>,
    <span class="token string">"vite.config.js"</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"exclude"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"node_modules"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
<li>
<p><strong>Add module html minify</strong>
CRA 프로젝트에서는 내장된 plugins중에 HtmlWebpackPlugin 통해서 html minify를 해주고 있는데, vite에서 내장이 되어 있지 않아서 직접 설치후에 환경 설정을 추가해줘야 합니다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">// Installation
<span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-html

// vite.config.js
createHtmlPlugin<span class="token punctuation">(</span><span class="token punctuation">{</span>
  // input <span class="token operator">&lt;</span>https://www.npmjs.com/package/html-minifier-terser<span class="token operator">></span> options
  minify: true,
<span class="token punctuation">}</span><span class="token punctuation">)</span>,</code></pre></div>
</li>
</ul>
<h2 id="configuration" style="position:relative;"><a href="#configuration" aria-label="configuration permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h2>
<ul>
<li>
<p><strong>Crafting the Vite Configuration</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// &lt;root>/vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig<span class="token punctuation">,</span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteTsconfigPaths <span class="token keyword">from</span> <span class="token string">'vite-tsconfig-paths'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> svgr <span class="token keyword">from</span> <span class="token string">'vite-plugin-svgr'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite-plugin-html'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span>config <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    build<span class="token operator">:</span> <span class="token punctuation">{</span>
      outDir<span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token comment">// build 폴더명 변경(기본 dist)</span>
      target<span class="token operator">:</span> <span class="token string">'es2015'</span><span class="token punctuation">,</span> <span class="token comment">// es6 target transpile</span>
      sourcemap<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 소스맵 생성 여부</span>
      rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// chunks 파일을 만들 경우 아래와 같이 청크명과 필터를 걸어주세요.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/react'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">'venders'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">onwarn</span><span class="token punctuation">(</span>warning<span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// sourcemap: true 설정할 경우 node_modules에 소스맵 없는 경우에 대한 경고 무시를 위해 추가</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>warning<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'SOURCEMAP_ERROR'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">defaultHandler</span><span class="token punctuation">(</span>warning<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    define<span class="token operator">:</span> <span class="token punctuation">{</span>
      global<span class="token operator">:</span> <span class="token string">'globalThis'</span><span class="token punctuation">,</span> <span class="token comment">// 글로벌 객체를 빈 객체로 대체(global is not defined error 에러에 대한 방어코드)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">viteTsconfigPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">svgr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
</li>
</ul>
<h2 id="environment-variables" style="position:relative;"><a href="#environment-variables" aria-label="environment variables permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environment Variables</h2>
<ul>
<li>
<p>VITE라는 prefix를 설정하지 않을 경우 import.meta.env 에서 값을 얻어 올 수 없습니다.</p>
</li>
<li>
<p>기본적으로 속성값으로 DEV(vite), PROD(vite build)을 제공해줌으로 개발/빌드 환경 구분이 가능합니다.</p>
</li>
<li>
<p><strong>ChangeEnv Variables and Modes</strong></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// .env Files</span>
.env                # loaded in all cases
.env.local          # loaded in all cases<span class="token punctuation">,</span> ignored by git
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>         # only loaded in specified mode
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>.local   # only loaded in specified mode<span class="token punctuation">,</span> ignored by git

<span class="token comment">// Modes</span>
# .env.production.live
VITE_ENVIRONMENT=live

<span class="token comment">// command mode option flag</span>
<span class="token property">"build:dev"</span><span class="token operator">:</span> <span class="token string">"yarn vite --mode production.dev"</span><span class="token punctuation">,</span>
<span class="token property">"build:rc"</span><span class="token operator">:</span> <span class="token string">"yarn vite --mode production.rc"</span><span class="token punctuation">,</span>
<span class="token property">"build:live"</span><span class="token operator">:</span> <span class="token string">"yarn vite --mode production.live"</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>Update process.env.REACT_APP</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token operator">-</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_APP_VARIABLE</span> <span class="token operator">+</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_VARIABLE</span><span class="token punctuation">;</span></code></pre></div>
</li>
</ul>
<h2 id="ejs-variables" style="position:relative;"><a href="#ejs-variables" aria-label="ejs variables permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EJS Variables</h2>
<ul>
<li>
<p><strong>Update Configuration for Vite</strong>
빌드 시 HTML CJS 문법이 치환되도록 처리하기 위해서 vite-plugin-html 이용해서 내보내기 처리 추가</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">createHtmlPlugin({
  ....
  inject: {
    data: {
      VITE_VARIABLE: env.VITE_VARIABLE,
    },
  },
}),</code></pre></div>
</li>
<li>
<p><strong>Replace EJS Variables for Vite</strong>
문자만 치환할 경우</p>
<ul>
<li>“%” → “&#x3C;%= ~~ =>”</li>
<li>예) <script src="/variable"></script> → 문자안에 글자를 치환할 경우</li>
</ul>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html">// env VITE_VARIABLE='/variable' //
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span>
  <span class="token punctuation">></span></span>/index.html //// CRA
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%REACT_APP_VARIABLE%<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

  //// VITE
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;%= VITE_VARIABLE %><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span>
<span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre></div>
<p>엘리먼트(태그) 자체를 변경할 경우</p>
<ul>
<li>% → &#x3C;%- ~~ -></li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> // env
VITE_SCRIPT=&lt;script>(function ~~ )&lt;/script>

// &lt;root>/index.html
//// CRA
%VITE_SCRIPT%

//// VITE
&lt;%- VITE_SCRIPT %></code></pre></div>
</li>
<li>
<p><strong>Updating Vite Commands(with enviroment)</strong></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"vite"</span><span class="token punctuation">,</span>
<span class="token property">"start:dev"</span><span class="token operator">:</span> <span class="token string">"yarn start --mode development.dev"</span><span class="token punctuation">,</span>
<span class="token property">"start:rc"</span><span class="token operator">:</span> <span class="token string">"yarn start --mode development.rc"</span><span class="token punctuation">,</span>
<span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"vite build"</span><span class="token punctuation">,</span>
<span class="token property">"build:dev"</span><span class="token operator">:</span> <span class="token string">"yarn build --mode production.dev"</span><span class="token punctuation">,</span>
<span class="token property">"build:rc"</span><span class="token operator">:</span> <span class="token string">"yarn build --mode production.rc"</span><span class="token punctuation">,</span>
<span class="token property">"build:live"</span><span class="token operator">:</span> <span class="token string">"yarn build --mode production.live"</span><span class="token punctuation">,</span></code></pre></div>
</li>
</ul>
<h2 id="vite-lint-typescript-checker" style="position:relative;"><a href="#vite-lint-typescript-checker" aria-label="vite lint typescript checker permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Vite Lint, Typescript Checker</h2>
<ul>
<li>
<p><strong>Add module vite-plugin-checker</strong>
CRA 환경에서 내부적으로 fork-ts-checker-webpack-plugin 플러그인을 바탕으로 비동기로 타입 체크를 해주고 있지만, VITE 환경에서는 vite-plugin-checker 직접 설치 후 vite.config.js 구성에 추가해줘야 합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> checker <span class="token keyword">from</span> <span class="token string">'vite-plugin-checker'</span><span class="token punctuation">;</span>

<span class="token function">checker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  typescript<span class="token operator">:</span> config<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  eslint<span class="token operator">:</span> config<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token punctuation">{</span>
    lintCommand<span class="token operator">:</span> <span class="token string">'eslint "./src/**/*.{ts,tsx,js,jsx}"'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  stylelint<span class="token operator">:</span> config<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token punctuation">{</span>
    lintCommand<span class="token operator">:</span> <span class="token string">'stylelint "src/**/*.scss"'</span>
  <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></div>
</li>
</ul>
<h1 id="cra-to-vite-migration-tip" style="position:relative;"><a href="#cra-to-vite-migration-tip" aria-label="cra to vite migration tip permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CRA to Vite Migration Tip</h1>
<ul>
<li>
<p><strong>import.meta.glob dynamic load</strong>
Vite의 import.meta.glob을 사용하여 모든 아이콘을 동적으로 가져올 수 있습니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> icons <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'./*Icon.tsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> iconComponentPath <span class="token operator">=</span> <span class="token string">'./aIcon.tsx'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Icon <span class="token operator">=</span>
  icons <span class="token operator">&amp;&amp;</span> icons<span class="token punctuation">[</span>iconComponentPath <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">]</span>
    <span class="token operator">?</span> <span class="token function">lazy</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          icons<span class="token punctuation">[</span>iconComponentPath <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">{</span>
            <span class="token keyword">default</span><span class="token operator">:</span> ComponentType<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p><strong>sass-resources-loader(dart sass) → vite config preprocessorOptions.sass</strong>
공통적으로 사용되는 스타일을 전역적으로 적용할 때 사용하는 sass-resources-loader를 vite에서는 preprocessorOptions.sass로 대체가 가능</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// CRA</span>
rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'sass-resources-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          resources<span class="token operator">:</span> <span class="token punctuation">[</span>
            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./sass.scss'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">// vite.config.js</span>
css<span class="token operator">:</span> <span class="token punctuation">{</span>
  preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    scss<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Next line will prepend the import in all you scss files as you did with your vite.config.js file</span>
      additionalData<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        @import "./sass.scss";
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>단계별 에러 케이스 정리</strong>
@forward rules must be written before any other rules 에러</p>
<ul>
<li>@forward 구문이 다른 모든 규칙(@import, @use, 스타일 선언) 보다 위에 위치하도록 수정
@forward</li>
<li>Dart Sass에서 도입된 Sass 모듈 시스템의 일부로, 모듈화된 스타일시트를 구성하고 관리하는 데 중요한 역할을 합니다.</li>
<li>@import 방식과는 다르게, @forward는 Sass 코드의 모듈화와 재사용성을 더 쉽게 관리할 수 있도록 돕습니다.
@use: 모듈을 가져오면서 네임스페이스를 사용해 충돌을 방지하고, 명시적으로 필요한 부분만 가져올 수 있습니다.
@import는 파일을 단순히 포함하는 방식으로, 여러 번 포함될 수 있고 변수나 믹스인의 충돌 위험이 있습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// reset.scss</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">forward</span></span> <span class="token string">'reset'</span><span class="token punctuation">;</span>

<span class="token comment">// ./sass.scss</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">use</span></span> <span class="token string">'color'</span><span class="token punctuation">;</span>

css<span class="token operator">:</span> <span class="token punctuation">{</span>
  preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    scss<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Next line will prepend the import in all you scss files as you did with your vite.config.js file</span>
      additionalData<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        @forward 'reset';

        @use './color.scss' as *;
        @use './sass.scss' as *
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>setting module scss name for Vite(선택)</strong>
CRA에서는 SCSS 모듈을 사용할 때, 파일명과 클래스명을 결합해 고유한 클래스명을 자동으로 생성해주만, VITE 에서는 클래스명으로만 생성되는 규칙을 다르게 가져가고 있음</p>
<ul>
<li>규칙: [파일명]<em>[원래 클래스명]</em>[hash:base64:5]
단, 서비스 내에서 module scss를 전역으로 선택하는 경우가 없다면 굳이 세팅을 해줄 필요가 없습니다.(내부적으로는 세팅을 하지 않을 시 [클래스명, hash]값을 토대로 유니크한 값으로 자동 변경)</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./Test.module.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Test<span class="token punctuation">;</span>

<span class="token comment">// 변경 전</span>
<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Test_container__28qL6"</span>

<span class="token comment">// 변경 후</span>
<span class="token comment">//// vite.config.js</span>
<span class="token keyword">const</span> namespaceUUID <span class="token operator">=</span> <span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
css<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 파일명과 클래스명을 포함한 고유한 이름 생성</span>
    <span class="token function-variable function">generateScopedName</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> filename<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 파일 경로 기반 고유한 해시 생성</span>
      <span class="token keyword">const</span> file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.module'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[^/.]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// UUID 생성 후 Base64 인코딩</span>
      <span class="token keyword">const</span> hash <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">v5</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> namespaceUUID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>server(proxy, outside file)</strong>
CRA proxy 설정을 VITE proxy로 대체가 가능합니다.
VITE 환경 외에 외부 폴더/파일 접근 시 fs.allow 객체로 추가 시 dev server에서 접근이 가능합니다.
기존에는 proxy 패스를 배열로 관리했지만 vite에서는 각각 패스로 관리를 해줘야합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// CRA</span>
<span class="token comment">//// 기존 패키지 삭제</span>
yarn remove http<span class="token operator">-</span>proxy<span class="token operator">-</span>middleware

<span class="token comment">//// setupProxy.js</span>
<span class="token comment">// 수정 전</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createProxyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">setupProxy</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	  logLevel<span class="token operator">:</span> <span class="token string">'debug'</span><span class="token punctuation">,</span>
	  autoRewrite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> <span class="token string">'http://www.test.kr'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProxyRes</span><span class="token operator">:</span> <span class="token punctuation">(</span>proxyRes<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProxyReq</span><span class="token operator">:</span> <span class="token punctuation">(</span>proxyReq<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      proxyReq<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'origin'</span><span class="token punctuation">,</span> <span class="token string">'http://www.test.kr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// vite.config.js</span>
<span class="token comment">//// 수정 후</span>
<span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token operator">:</span> <span class="token punctuation">{</span>
	proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
		fs<span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 허용할 디렉터리 추가 (여기에 외부 파일 경로를 추가)</span>
	    allow<span class="token operator">:</span> <span class="token punctuation">[</span>
	      <span class="token string">'../../../outside'</span><span class="token punctuation">,</span>
	      <span class="token string">'/'</span>
	    <span class="token punctuation">]</span><span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string-property property">'/test'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		  logLevel<span class="token operator">:</span> <span class="token string">'debug'</span><span class="token punctuation">,</span>
		  autoRewrite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	    target<span class="token operator">:</span> <span class="token string">'http://www.test.kr'</span><span class="token punctuation">,</span>
	    <span class="token function-variable function">configure</span><span class="token operator">:</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	      proxy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'proxyRes'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>proxyRes<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	      proxy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'proxyReq'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>proxyReq<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	        proxyReq<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'origin'</span><span class="token punctuation">,</span> <span class="token string">'http://www.test.kr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>external file link settings(alias)</strong>
CRA에서 외부 파일내에 패스(tsconfig.json)를 접근 시 현재 프로젝트 환경 기준으로 패스를 바라보지만,
VITE에서는 외부 파일 기준으로 패스를 접근하다보니 alias 처리에 이슈가 있어서 tsconfig path가 아닌 절대 경로 패스로 재 지정해야 합니다.
예)</p>
<ul>
<li>CRA(root)
<ul>
<li>outside/index.tsx 컴포넌트 위치 기준</li>
</ul>
</li>
<li>VITE
<ul>
<li>root 위치 기준</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// CRA</span>
<span class="token keyword">const</span> modifiedConfig <span class="token operator">=</span> <span class="token function">aliasWebpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  tsconfig<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./tsconfig.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// vite.config.js</span>
resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  alias<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'@outside'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../outside'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// outside/index.tsx</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'../Button'</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p><strong>setting external file access permissions</strong>
CRA에서는 외부파일 접근 시 내부 config 파일에서 ModuleScopePlugin 플러그인에 추가해주는 번거로움이 있었지만,
VITE에서는 빌드 과정에서는 외부 파일 접근이 자유로우나, 개발 환경에서는 외부 파일 패스 경로를 설정해줘야합니다.</p>
<ul>
<li>단, 파일 패스 설정 시 외부 파일 패스외에 내부 파일 패스도 같이 설정해줘야 합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">fs<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 허용할 디렉터리 추가 (여기에 외부 파일 경로를 추가)</span>
  allow<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'../outside'</span><span class="token punctuation">,</span>
    <span class="token string">'/'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>setting baseurl for Vite</strong>
CRA에서는 내부적으로 BaseURL(PUBLIC_URL)을 기준으로 리소스 패스 경로를 설정해주지만, VITE에서는 해당 경로를 base 속성값으로 변경해줘야합니다.(env 환경 변수에 base url 패스를 지정해주세요.)
단, DEV 환경에서는 내부 리소스 패스로 설정해야함으로 패스를 지정하지 말아야합니다.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html">// CRA //// index.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%PUBLIC_URL%/favicon.ico<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

// VITE //// env.production.dev VITE_PUBLIC_URL=https://test ////
vite.config.js base: env.VITE_PUBLIC_URL || '/', //// index.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/favicon.ico<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

//// index.html(결과물)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://test/favicon.ico<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></code></pre></div>
</li>
<li></li>
</ul>
<h1 id="cra-to-vite-migration-storybook" style="position:relative;"><a href="#cra-to-vite-migration-storybook" aria-label="cra to vite migration storybook permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CRA to Vite Migration Storybook</h1>
<ul>
<li>
<p><strong>Installation</strong>
이전 버전 Storybook 삭제</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> remove @storybook/addon-*<span class="token punctuation">(</span>knobs, controls 등등<span class="token punctuation">)</span></code></pre></div>
<p>vite 연동을 위한 스토리북 패키지 추가
기존 CRA 환경에서는 @storybook/react 패키지 명령어를 사용해서 문제가 없었지만,
VITE에서는 @storybook/react-vite 패키지를 사용하면서 storybook 패키지를 추가적으로 설치가 필요합니다.
또한, storybook 연동 패키지가 6버전 사용 시 ‘storybook-channel-mock.js:7 Uncaught TypeError: import_channels.default is not a constructor’ 와 같은 에러가 발생하게 됩니다.
꼭 최신 버전인 8버전 이상에 패키지를 설치를 해주세요</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @storybook/builder-vite @storybook/react @storybook/react-vite storybook <span class="token parameter variable">-D</span></code></pre></div>
<p>Major breaking changes</p>
<ul>
<li><a href="https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#dropping-support-for-nodejs-16" target="_blank" rel="nofollow">Node 18+ is now required</a></li>
<li><a href="https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#new-addons-api" target="_blank" rel="nofollow">Addons API introduced in Storybook 7 is now required</a></li>
<li>vite 환경일 경우 root 패스에 vite.config.js가 필수로 추가</li>
</ul>
</li>
<li>
<p><strong>setting</strong>
.storybook/main
addon 설정</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"> addons<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">'@storybook/addon-links'</span><span class="token punctuation">,</span>
  <span class="token string">'@storybook/addon-essentials'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre></div>
<p>builder, framework 지정</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">core<span class="token operator">:</span> <span class="token punctuation">{</span>
  builder<span class="token operator">:</span> <span class="token string">'@storybook/builder-vite'</span><span class="token punctuation">,</span> <span class="token comment">// 👈 The builder enabled here.</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
framework<span class="token operator">:</span> <span class="token string">'@storybook/react-vite'</span><span class="token punctuation">,</span></code></pre></div>
<p>base static path 지정</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// CRA - @storybook/react</span>
<span class="token string-property property">"storybook"</span><span class="token operator">:</span> <span class="token string">"start-storybook -p 9009 -s public"</span><span class="token punctuation">,</span>

<span class="token comment">// VITE - @storybook/vite</span>
staticDirs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'../public'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 이전 버전(v6) -s public 옵션과 동일</span></code></pre></div>
<p>webpackFinal → ViteFinal 마이그레이션</p>
<ul>
<li>preprocess scss, 허용할 파일 패스 연동</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// webpack</span>
config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'sass-resources-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        resources<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../sass.scss'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Vite</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> mergeConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">mergeConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// Merge custom configuration into the default config</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> mergeConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  css<span class="token operator">:</span> <span class="token punctuation">{</span>
    preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      scss<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Next line will prepend the import in all you scss files as you did with your vite.config.js file</span>
      additionalData<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        @forward 'reset';

        @use './color.scss' as *;
        @use './sass.scss' as *
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
	    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<ul>
<li>외부 파일 접근</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// VITE</span>
server<span class="token operator">:</span> <span class="token punctuation">{</span>
  fs<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 허용할 디렉터리 추가 (여기에 외부 파일 경로를 추가)</span>
    allow<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'../outside'</span><span class="token punctuation">,</span>
      <span class="token string">'/'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
</li>
<li>
<p><strong>storybook code migration processing</strong>
<strong>No longer inferring default values of args(v6.3)</strong>
버전 업데이트가 되면서 argTypes에서 기본값 세팅을 할 수 없고 args에서 세팅하는걸로 변경되었습니다. 빌드 에러가 발생하진 않지만, 확인해보시면 undefined 설정되서 들어가게 되니 꼭 마이그레이션 시 변경 해주세요.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// CRA - storybook</span>
argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
  isModalOpened<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'모달 오픈여부'</span><span class="token punctuation">,</span>
    defaultValue<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    control<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// VITE - storybook</span>
argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
  isModalOpened<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'모달 오픈여부'</span><span class="token punctuation">,</span>
    control<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
args<span class="token operator">:</span> <span class="token punctuation">{</span>
  isModalOpened<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>New parameters format for addon viewport(v8.3)</strong></p>
<ul>
<li>viewports → options 변경</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 이전</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> parameters <span class="token operator">=</span> <span class="token punctuation">{</span>
  viewport<span class="token operator">:</span> <span class="token punctuation">{</span>
    viewports<span class="token operator">:</span> <span class="token punctuation">{</span>
      iphone5<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'phone'</span><span class="token punctuation">,</span>
        styles<span class="token operator">:</span> <span class="token punctuation">{</span>
          width<span class="token operator">:</span> <span class="token string">'320px'</span><span class="token punctuation">,</span>
          height<span class="token operator">:</span> <span class="token string">'568px'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 변경 후</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> parameters <span class="token operator">=</span> <span class="token punctuation">{</span>
  viewport<span class="token operator">:</span> <span class="token punctuation">{</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      iphone5<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'phone'</span><span class="token punctuation">,</span>
        styles<span class="token operator">:</span> <span class="token punctuation">{</span>
          width<span class="token operator">:</span> <span class="token string">'320px'</span><span class="token punctuation">,</span>
          height<span class="token operator">:</span> <span class="token string">'568px'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Story type deprecated(v7.0)</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Story <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> MyStory<span class="token operator">:</span> <span class="token function-variable function">Story</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>

<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StoryFn<span class="token punctuation">,</span> StoryObj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> MyCsf2Story<span class="token operator">:</span> <span class="token function-variable function">StoryFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MyCsf3Story<span class="token operator">:</span> StoryObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>start-storybook / build-storybook binaries removed(v7.0)</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">// 변경 전
<span class="token punctuation">{</span>
  <span class="token string">"scripts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"storybook"</span><span class="token builtin class-name">:</span> <span class="token string">"start-storybook &lt;some flags>"</span>,
    <span class="token string">"build-storybook"</span><span class="token builtin class-name">:</span> <span class="token string">"build-storybook &lt;some flags>"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 변경 후
<span class="token punctuation">{</span>
  <span class="token string">"scripts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"storybook"</span><span class="token builtin class-name">:</span> <span class="token string">"storybook dev &lt;some flags>"</span>,
    <span class="token string">"build-storybook"</span><span class="token builtin class-name">:</span> <span class="token string">"storybook build &lt;some flags>"</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"devDependencies"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"storybook"</span><span class="token builtin class-name">:</span> <span class="token string">"next"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Ignore story files from node_modules(v7.0)</strong></p>
<ul>
<li>기본적으로 node_modules 안에 스토리북은 무시하도록 변경</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  stories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../**/*.stories.*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 기존 glob.sync 처리는 굳이 안해줘도 됩니다.</span>
<span class="token comment">// const getStories = () => glob.sync(`${path.resolve(__dirname, '../')}/src/**/*.stories.@(js|jsx|ts|tsx)`);</span>
<span class="token comment">// stories: async () => getStories(),</span>

<span class="token comment">// 펀딩 스튜디오 적용</span>
stories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../src/**/*.stories.@(js|jsx|ts|tsx)"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>Removed deprecated shim packages(v8.0)</strong></p>
<table>
<thead>
<tr>
<th>Removal</th>
<th>Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td>@storybook/addons</td>
<td>@storybook/manager-api or @storyboook/preview-api</td>
</tr>
<tr>
<td>@storybook/channel-postmessage</td>
<td>@storybook/channels</td>
</tr>
<tr>
<td>@storybook/channel-websocket</td>
<td>@storybook/channels</td>
</tr>
<tr>
<td>@storybook/client-api</td>
<td>@storybook/preview-api</td>
</tr>
<tr>
<td>@storybook/core-client</td>
<td>@storybook/preview-api</td>
</tr>
<tr>
<td>@storybook/preview-web</td>
<td>@storybook/preview-api</td>
</tr>
<tr>
<td>@storybook/store</td>
<td>@storybook/preview-api</td>
</tr>
<tr>
<td>@storybook/api</td>
<td>@storybook/manager-api</td>
</tr>
<tr>
<td>@storybook/testing-library</td>
<td>@storybook/test</td>
</tr>
<tr>
<td><strong>Deprecated addon-knobs(v6.3) → static쪽도 버전 업하시려면 수정을 해주셔야합니다.</strong></td>
<td></td>
</tr>
<tr>
<td>addon-essentials 패키지 설치 후 knobs가 아닌 control을 사용</td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li><strong>Controls (</strong>@storybook/addon-controls**)**: 컴포넌트의 props를 UI에서 제어할 수 있도록 해줍니다.</li>
<li><strong>Actions (</strong>@storybook/addon-actions**)**: 이벤트 핸들러를 디버깅하기 쉽게 로그로 출력합니다.</li>
<li><strong>Docs (</strong>@storybook/addon-docs**)**: 컴포넌트의 문서를 자동 생성합니다.</li>
<li><strong>Viewport (</strong>@storybook/addon-viewport**)**: 다양한 화면 크기에 따른 컴포넌트의 동작을 확인합니다.</li>
<li>기타 애드온들 (e.g., Backgrounds, Toolbars &#x26; Icons 등).
<a href="https://github.com/storybookjs/storybook/blob/next/MIGRATION.md" target="_blank" rel="nofollow">https://github.com/storybookjs/storybook/blob/next/MIGRATION.md</a></li>
</ol>
</li>
<li>
<p><strong>package.json storybook command</strong></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// CRA</span>
<span class="token property">"storybook"</span><span class="token operator">:</span> <span class="token string">"start-storybook -p 9009 -s public"</span><span class="token punctuation">,</span>
<span class="token property">"build-storybook"</span><span class="token operator">:</span> <span class="token string">"build-storybook -s public -o .storybook/build --quiet"</span><span class="token punctuation">,</span>

<span class="token comment">// VITE</span>
<span class="token property">"storybook"</span><span class="token operator">:</span> <span class="token string">"storybook dev -p 9009"</span><span class="token punctuation">,</span>
<span class="token property">"build-storybook"</span><span class="token operator">:</span> <span class="token string">"storybook build -o .storybook/build --quiet"</span></code></pre></div>
</li>
</ul>
<h1 id="jest-to-vitest-migration" style="position:relative;"><a href="#jest-to-vitest-migration" aria-label="jest to vitest migration permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Jest to Vitest Migration</h1>
<ul>
<li>
<p><strong>Why Vitest is better than Jest</strong></p>
<ol>
<li><strong>빠른 성능</strong>: esbuild 기반으로 Jest보다 빠른 테스트 실행.(jest: Babel)</li>
<li><strong>ESM 지원</strong>: 최신 ES 모듈을 기본적으로 지원.(ES 방식 지원 가능하나 호환성 이슈 발생)</li>
<li><strong>타입스크립트 통합</strong>: 추가 설정 없이 TypeScript와 자연스럽게 통합.</li>
<li><strong>간단한 모킹 API</strong>: 직관적이고 쉽게 사용할 수 있는 mocking 기능 제공.</li>
<li><strong>Vite와의 호환성</strong>: Vite 설정 및 플러그인을 그대로 활용.</li>
<li><strong>현대적 기능</strong>: HMR과 빠른 watch 모드 지원.</li>
<li><strong>작은 학습 곡선</strong>: Vite 사용자에게 친숙한 설정.</li>
<li><strong>우수한 개발자 경험</strong>: 오류 보고 및 테스트 피드백이 현대적이고 상세함.</li>
</ol>
</li>
<li>
<p><strong>Installation</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> vitest jsdom @testing-library/dom @testing-library/jest-dom @testing-library/react @testing-library/user-event

// 기존 Jest 테스트 관련 패키지 삭제
<span class="token function">yarn</span> remove jest babel-jest
</code></pre></div>
</li>
<li>
<p><strong>setting</strong>
기존에 package.json/jest.setup.js 설정된 테스트 구성을 vitest.config.js로 이전</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
<span class="token comment">//// package.json</span>
<span class="token string-property property">"jest"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">"collectCoverageFrom"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"!&lt;rootDir>/node_modules/"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"moduleNameMapper"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"lodash-es"</span><span class="token operator">:</span> <span class="token string">"lodash"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"transformIgnorePatterns"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"/node_modules/"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"setupFilesAfterEnv"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"&lt;rootDir>/jest.setup.js"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 변경 후</span>
<span class="token comment">//// vitest.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"lodash-es"</span><span class="token operator">:</span> <span class="token string">"lodash"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">viteTsconfigPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tsconfig 파일 패스 연동</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    environment<span class="token operator">:</span> <span class="token string">'jsdom'</span><span class="token punctuation">,</span> <span class="token comment">// React 테스트 환경을 위해 설정</span>
    globals<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Jest와 동일한 글로벌 변수를 사용</span>
    setupFiles<span class="token operator">:</span> <span class="token string">'./src/setupTests.ts'</span><span class="token punctuation">,</span> <span class="token comment">// setup 파일</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// src/setupTest.ts</span>
<span class="token keyword">import</span> <span class="token string">'@testing-library/jest-dom'</span><span class="token punctuation">;</span></code></pre></div>
<p>기존 리액트 테스트 환경 테스트를 위해서 test 환경을 꼭 json 으로 설정해주세요.
타입스크립트 타입에 vitest 추가해주세요.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// tsconfig.json</span>
<span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dom"</span><span class="token punctuation">,</span> <span class="token string">"dom.iterable"</span><span class="token punctuation">,</span> <span class="token string">"es2020"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES6"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vite/client"</span><span class="token punctuation">,</span> <span class="token string">"react"</span><span class="token punctuation">,</span> <span class="token string">"react-dom"</span><span class="token punctuation">,</span> <span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token string">"vitest/globals"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// vitest/globals 추가</span>
  <span class="token property">"isolatedModules"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>eslint 글로벌 체크 타입 변수에 vi 추가</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// .eslint.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  globals<span class="token operator">:</span> <span class="token punctuation">{</span>
    context<span class="token operator">:</span> <span class="token string">'readonly'</span><span class="token punctuation">,</span>
    vi<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// vi 추가</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p><strong>jest code migration processing</strong>
<strong>module mocks</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./some-path'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./some-path'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Importing the Original of a Mocked Package</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> cloneDeep <span class="token punctuation">}</span> <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">requireActual</span><span class="token punctuation">(</span><span class="token string">'lodash/cloneDeep'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> cloneDeep <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> vi<span class="token punctuation">.</span><span class="token function">importActual</span><span class="token punctuation">(</span><span class="token string">'lodash/cloneDeep'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Replace property</strong>
<a href="https://vitest.dev/guide/migration#replace-property" target="_blank" rel="nofollow">Vitest</a>
<strong>Done Callback</strong></p>
<ul>
<li>Vitest v0.10.0 이후부터는 callback 스타일을 지원하지 않고 있어서 지원을 해야할 경우 Promise callback 함수로 변경 필요</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should work'</span><span class="token punctuation">,</span> done <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should work'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>done <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Hooks</strong>
beforeAll/beforeEach hook에 대해서 null/undefined 외에 값을 반환해야합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token operator">-</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setActivePinia</span><span class="token punctuation">(</span><span class="token function">createTestingPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setActivePinia</span><span class="token punctuation">(</span><span class="token function">createTestingPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>jest hooks는 동기적으로 수행되고, vitest는 기본적으로 병렬로 진행하게 됩니다. 단, hooks 동기적으로 수행 시 sequence.hooks 속성을 지정해야합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// vitest.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    sequence<span class="token operator">:</span> <span class="token punctuation">{</span>
      hooks<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Types</strong>
vitest는 네임스페이스 속성을 지원하지 않기 때문에 직접 유형을 가져와야합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
<span class="token keyword">let</span> fn<span class="token operator">:</span> jest<span class="token punctuation">.</span>Mock<span class="token operator">&lt;</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Mock <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fn<span class="token operator">:</span> Mock<span class="token operator">&lt;</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre></div>
<p><strong>Timeout</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
jest<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">5_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
vi<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span> testTimeout<span class="token operator">:</span> <span class="token number">5_000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p><strong>package.json test commands</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token string">"test"</span><span class="token builtin class-name">:</span> <span class="token string">"vitest"</span>,
<span class="token string">"test:run"</span><span class="token builtin class-name">:</span> <span class="token string">"vitest run"</span>,</code></pre></div>
</li>
</ul>
<h1 id="msw-migration-guide" style="position:relative;"><a href="#msw-migration-guide" aria-label="msw migration guide permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MSW Migration Guide</h1>
<ul>
<li>vitest 테스트와 msw 0.43.1 버전 같이 사용 시 아래 같은 문구에 에러가 발생</li>
<li>vitest에서 ECMAscript 모듈을 지원하고 있고 msw 이전버전에서는 미지원함에 따른 에러 발생으로 추측(버전을 최신 버전으로 변경해서 수정)</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">vitest Package subpath <span class="token string">'./lib'</span> <span class="token keyword">is</span> not defined by <span class="token string">"exports"</span> <span class="token keyword">in</span> node_modules<span class="token operator">/</span>headers<span class="token operator">-</span>polyfill<span class="token operator">/</span><span class="token keyword">package</span><span class="token punctuation">.</span>json</code></pre></div>
<ul>
<li><strong>Installation</strong>
<ul>
<li>msw 버전을 최신버전으로 업그레이드 함에 따른 storybook에 사용되는 storybook-addon도 동일하게 업그레이드 처리해야 합니다.</li>
<li>msw-storybook-addon 관련 스토리부 설정을 기존과 동일합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">yarn add <span class="token operator">-</span><span class="token constant">D</span> msw@<span class="token number">2.4</span><span class="token number">.11</span> msw<span class="token operator">-</span>storybook<span class="token operator">-</span>addon@<span class="token number">2.0</span><span class="token number">.3</span></code></pre></div>
</li>
<li><strong>msw code migration processing</strong>
<strong>worker-imports</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setupWorker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setupWorker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw/browser'</span><span class="token punctuation">;</span></code></pre></div>
<strong>Response resolver arguments</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> request <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> productId <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<strong>Response declaration</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'abc-123'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'abc-123'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후 2</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http<span class="token punctuation">,</span> HttpResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> handlers <span class="token operator">=</span> <span class="token punctuation">[</span>
  http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'abc-123'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<strong>Request params</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/post/:id'</span><span class="token punctuation">,</span> req <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/post/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<strong>Request cookies</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> req <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> cookies <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> cookies<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<strong>Request Body</strong>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 변경 전</span>
rest<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/resource'</span><span class="token punctuation">,</span> req <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// The library would assume a JSON request body</span>
  <span class="token comment">// based on the request's "Content-Type" header.</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 변경 후</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> request <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Read the request body as JSON.</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<a href="https://mswjs.io/docs/migrations/1.x-to-2.x/#resnetworkerror" target="_blank" rel="nofollow">1.x → 2.x</a></li>
</ul>
<h1 id="결과" style="position:relative;"><a href="#%EA%B2%B0%EA%B3%BC" aria-label="결과 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결과</h1>
<p>빌드 성능: <strong>6.16s → 2.49s ( 3.67s 빠름 )</strong></p>
<p><img src="./assets/06/Untitled3.png" alt="Untitled"></p>
<p><img src="./assets/06/Untitled4.png" alt="Untitled"></p>
<p>Dev Server 구동: <strong>167ms → 엄청 빠름^^</strong></p>
<p><img src="./assets/06/Untitled5.png" alt="Untitled"></p>
<h1 id="참고페이지" style="position:relative;"><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80" aria-label="참고페이지 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고페이지</h1>
<ul>
<li>
<p><a href="https://coreui.io/blog/how-to-migrate-create-react-app-to-vite/" target="_blank" rel="nofollow">How to Migrate from create-react-app to Vite? · CoreUI</a></p>
</li>
<li>
<p><a href="https://www.freecodecamp.org/news/how-to-migrate-from-create-react-app-to-vite/" target="_blank" rel="nofollow">How to Migrate from create-react-app to Vite using Jest and Browserslist</a></p>
</li>
<li>
<p><a href="https://nyagm.tistory.com/280" target="_blank" rel="nofollow">[vite] 프론트엔드 개발자를 위한 Vite 101</a></p>
</li>
<li>
<p><a href="https://khys.tistory.com/31" target="_blank" rel="nofollow">[JS] 비트(Vite)란? - 비트 알아보기</a></p>
</li>
<li>
<p><a href="https://engineering.ab180.co/stories/webpack-to-vite" target="_blank" rel="nofollow">Webpack → Vite: 번들러 마이그레이션 이야기</a></p>
</li>
<li>
<p><a href="https://nyagm.tistory.com/280" target="_blank" rel="nofollow">[vite] 프론트엔드 개발자를 위한 Vite 101</a></p>
</li>
<li>
<p><a href="https://www.freecodecamp.org/news/how-to-migrate-from-create-react-app-to-vite/" target="_blank" rel="nofollow">How to Migrate from create-react-app to Vite using Jest and Browserslist</a></p>
</li>
<li>
<p><a href="https://eun-jee.com/post/front-end/CRA_to_Vite/" target="_blank" rel="nofollow">CRA에서 Vite로 마이그레이션하기 (feat. 배포 시간 줄이기)</a></p>
</li>
<li>
<p><a href="https://storybook.js.org/docs/builders/vite" target="_blank" rel="nofollow">Docs | Storybook</a></p>
</li>
</ul></article><section class="PostContent__PostNavigator-sc-9jovib-6 eozcVb"><a href="/blog/2024/11/2024-11-23-nextjs-v15-migration/"><h5>이전글</h5><i>← </i>nextjs 15</a><a href="/blog/2024/10/2023-10-30-nextjs-v14/"><h5>다음글</h5>Nextjs(v14)<i> →</i></a></section><div></div></div><aside class="PostContent__TocRenderer-sc-9jovib-4 cbTbsU"><ul>
<li>
<p><a href="#vite%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0">Vite를 사용해야 하는 이유</a></p>
</li>
<li>
<p><a href="#cra-to-vite-migration">CRA to Vite Migration</a></p>
<ul>
<li><a href="#base">base</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#ejs-variables">EJS Variables</a></li>
<li><a href="#vite-lint-typescript-checker">Vite Lint, Typescript Checker</a></li>
</ul>
</li>
<li>
<p><a href="#cra-to-vite-migration-tip">CRA to Vite Migration Tip</a></p>
</li>
<li>
<p><a href="#cra-to-vite-migration-storybook">CRA to Vite Migration Storybook</a></p>
</li>
<li>
<p><a href="#jest-to-vitest-migration">Jest to Vitest Migration</a></p>
</li>
<li>
<p><a href="#msw-migration-guide">MSW Migration Guide</a></p>
</li>
<li>
<p><a href="#%EA%B2%B0%EA%B3%BC">결과</a></p>
</li>
<li>
<p><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80">참고페이지</a></p>
</li>
</ul></aside></div><div class="Footer__FooterWrapper-sc-rphy7j-0 iqMMNl">Thank You for Visiting My Blog,<br/>© 2021 Developer SeungAh, Powered By Gatsby.</div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2024/11/2024-11-16-vite/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-3f569fefb0788f5a0023.js\"],\"component---src-components-templates-post-template-tsx\":[\"/component---src-components-templates-post-template-tsx-d9d3da42943c44af159e.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-4d52495227296e18c78a.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-ed4d3b150f6b0138dbea.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-95992269d7f74c02239a.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="c3210c92db98a47d2773";</script><script src="/webpack-runtime-7612a97d8f43392f6335.js" async></script><script src="/framework-a96385c61229616bc6a1.js" async></script><script src="/app-3f569fefb0788f5a0023.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>