<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style data-styled="" data-styled-version="6.1.15">.dpzVnt{display:flex;flex:1;position:relative;margin:0 auto;align-items:start;width:1024px;max-width:1024px;}/*!sc*/
@media (max-width:1024px){.dpzVnt{margin:0;width:auto;}}/*!sc*/
data-styled.g1[id="PostContent__PostWrapper-sc-9jovib-0"]{content:"dpzVnt,"}/*!sc*/
.eUbyKZ{border-bottom:1px solid #e6e6e6;}/*!sc*/
.eUbyKZ>div{display:flex;flex:1;align-items:center;justify-content:space-between;margin:0 auto;max-width:1024px;padding:0 20px;}/*!sc*/
@media (max-width:1024px){.eUbyKZ>div{margin:0;min-width:auto;}}/*!sc*/
.eUbyKZ h1{font-size:24px;margin:12px 0 8px;}/*!sc*/
data-styled.g2[id="PostContent__PostHeadWrapper-sc-9jovib-1"]{content:"eUbyKZ,"}/*!sc*/
.bDPFHN{width:80%;}/*!sc*/
@media (max-width:1024px){.bDPFHN{width:100%;}}/*!sc*/
data-styled.g3[id="PostContent__PostContentWrapper-sc-9jovib-2"]{content:"bDPFHN,"}/*!sc*/
.dwHlbl{padding:0 20px;margin-bottom:48px;}/*!sc*/
.dwHlbl>h1{margin-bottom:8px;font-size:40px;}/*!sc*/
data-styled.g4[id="PostContent__PostTitle-sc-9jovib-3"]{content:"dwHlbl,"}/*!sc*/
.cbTbsU{display:inline-block;margin:12px 0 0 10px;position:sticky;top:20px;left:100%;transition:all 0.125s esse-in 0s;color:rgba(0,0,0,0.4);padding:0.25rem 0.75rem;border-left:2px solid gray;overflow:hidden auto;max-height:calc(-128px + 100vh);}/*!sc*/
.cbTbsU ul{list-style:none;}/*!sc*/
.cbTbsU ul li{margin-top:5px;}/*!sc*/
.cbTbsU ul li a{display:inline-block;}/*!sc*/
.cbTbsU ul li a.reach{color:#000000;}/*!sc*/
.cbTbsU ul ul{margin-left:12px;}/*!sc*/
@media (max-width:1024px){.cbTbsU{display:none;}}/*!sc*/
data-styled.g5[id="PostContent__TocRenderer-sc-9jovib-4"]{content:"cbTbsU,"}/*!sc*/
.lcuqXx{display:flex;flex-direction:column;word-break:keep-all;margin-bottom:250px;padding:0 20px;width:100%;line-height:1.8;font-size:16px;font-weight:400;}/*!sc*/
@media (max-width:1024px){.lcuqXx{margin-bottom:48px;}}/*!sc*/
.lcuqXx p{padding:3px 0;}/*!sc*/
.lcuqXx h1,.lcuqXx h2,.lcuqXx h3{font-weight:800;}/*!sc*/
.lcuqXx *+h1{margin-top:60px;}/*!sc*/
.lcuqXx *+h2{margin-top:40px;}/*!sc*/
.lcuqXx *+h3{margin-top:30px;}/*!sc*/
.lcuqXx hr+h1,.lcuqXx hr+h2,.lcuqXx hr+h3{margin-top:0;}/*!sc*/
.lcuqXx h1{font-size:30px;}/*!sc*/
.lcuqXx h2{font-size:25px;}/*!sc*/
.lcuqXx h3{font-size:20px;}/*!sc*/
.lcuqXx blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}/*!sc*/
.lcuqXx ol,.lcuqXx ul{margin-left:20px;padding:10px 0;}/*!sc*/
.lcuqXx hr{border:1px solid #000000;margin:100px 0;}/*!sc*/
.lcuqXx a{color:#4263eb;text-decoration:underline;}/*!sc*/
.lcuqXx pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}/*!sc*/
.lcuqXx pre[class*='language-'] ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.5);border-radius:3px;}/*!sc*/
.lcuqXx code[class*='language-'],.lcuqXx pre[class*='language-']{tab-size:2;}/*!sc*/
.lcuqXx img{width:100%;}/*!sc*/
.lcuqXx summary{cursor:pointer;font-size:24px;}/*!sc*/
data-styled.g6[id="PostContent__MarkdownRenderer-sc-9jovib-5"]{content:"lcuqXx,"}/*!sc*/
.eozcVb{margin:40px 0;display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0 20px;}/*!sc*/
.eozcVb h5{font-size:24px;margin-bottom:8px;}/*!sc*/
.eozcVb a{border-radius:6px;font-size:20px;color:#cc007a;font-weight:700;}/*!sc*/
data-styled.g7[id="PostContent__PostNavigator-sc-9jovib-6"]{content:"eozcVb,"}/*!sc*/
.kaFjH{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.7);color:#161b21;width:40px;height:40px;min-width:40px;font-size:20px;border:none;border-radius:50%;}/*!sc*/
.kaFjH>img{width:35px;height:35px;}/*!sc*/
data-styled.g8[id="PostContent__SocialLink-sc-9jovib-7"]{content:"kaFjH,"}/*!sc*/
.iqMMNl{display:grid;place-items:center;margin-top:auto;margin-left:0;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}/*!sc*/
@media (max-width:1024px){.iqMMNl{margin-left:0;}}/*!sc*/
data-styled.g16[id="Footer__FooterWrapper-sc-rphy7j-0"]{content:"iqMMNl,"}/*!sc*/
html{line-height:1.15;-webkit-text-size-adjust:100%;}/*!sc*/
body{margin:0;}/*!sc*/
main{display:block;}/*!sc*/
h1{font-size:2em;margin:0.67em 0;}/*!sc*/
hr{box-sizing:content-box;height:0;overflow:visible;}/*!sc*/
pre{font-family:monospace,monospace;font-size:1em;}/*!sc*/
a{background-color:transparent;}/*!sc*/
abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp{font-family:monospace,monospace;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
img{border-style:none;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
button,input{overflow:visible;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;}/*!sc*/
button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}/*!sc*/
button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}/*!sc*/
fieldset{padding:0.35em 0.75em 0.625em;}/*!sc*/
legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
textarea{overflow:auto;}/*!sc*/
[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}/*!sc*/
[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
details{display:block;}/*!sc*/
summary{display:list-item;}/*!sc*/
template{display:none;}/*!sc*/
[hidden]{display:none;}/*!sc*/
*{padding:0;margin:0;box-sizing:border-box;}/*!sc*/
html,body,#___gatsby{height:100%;word-break:keep-all;overflow-wrap:break-word;}/*!sc*/
#gatsby-focus-wrapper{height:100%;}/*!sc*/
a,a:hover{color:inherit;text-decoration:none;cursor:pointer;}/*!sc*/
.utterances{max-width:1024px;margin:0 auto;}/*!sc*/
data-styled.g18[id="sc-global-dhQtTb1"]{content:"sc-global-dhQtTb1,"}/*!sc*/
.iJvdpr{display:flex;flex-direction:column;height:100%;}/*!sc*/
data-styled.g19[id="Template__Container-sc-1a9t0ug-0"]{content:"iJvdpr,"}/*!sc*/
</style><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seungahhong.github.io/blog/2022/12/2022-12-30-react-query/" data-baseprotocol="https:" data-basehost="seungahhong.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-TYGQRJE1B8', 'auto', {});
      
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G8Z1HZWWYL"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G8Z1HZWWYL', {"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Template__Container-sc-1a9t0ug-0 iJvdpr"><header class="PostContent__PostHeadWrapper-sc-9jovib-1 eUbyKZ"><div><a href="/"><h1>홍승아블로그</h1></a><a href="https://github.com/seungahhong" rel="noopener noreferrer" title="notion" target="_blank" size="35" class="PostContent__SocialLink-sc-9jovib-7 kaFjH"><img src="/static/4a6687a74051de2b3536e95d0b6c992a/github.svg" alt="Github Link Image"/></a></div></header><div class="PostContent__PostWrapper-sc-9jovib-0 dpzVnt"><div class="PostContent__PostContentWrapper-sc-9jovib-2 bDPFHN"><div class="PostContent__PostTitle-sc-9jovib-3 dwHlbl"><h1>react-query</h1><time>2022.12.30</time></div><article class="PostContent__MarkdownRenderer-sc-9jovib-5 lcuqXx"><h1 id="개요" style="position:relative;"><a href="#%EA%B0%9C%EC%9A%94" aria-label="개요 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>개요</h1>
<ul>
<li>React를 위한 Data Synchronization Library</li>
<li>React application에서 <strong>서버 상태</strong>를 fetching, caching, synchronizing, updating 작업을 쉽게 만들어 줍니다.</li>
</ul>
<h1 id="서버-상태" style="position:relative;"><a href="#%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C" aria-label="서버 상태 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버 상태</h1>
<ul>
<li>원격에 위치한 공간에 저장되며 앱이 소유하거나 제어하지 않습니다.</li>
<li>데이터를 가져오고 업데이트하기 위해선 비동기 API가 필요합니다.</li>
<li>다른 사람과 함께 사용하며, 내가 모르는 사이에 업데이트될 수 있습니다.</li>
<li>앱에서 사용하는 데이터가 “유효 기간이 지난” 상태가 될 가능성을 가집니다.</li>
</ul>
<h1 id="react-query-장점" style="position:relative;"><a href="#react-query-%EC%9E%A5%EC%A0%90" aria-label="react query 장점 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Query 장점</h1>
<ul>
<li>캐싱</li>
<li>서버 데이터 중복 호출 제거 (따닥 방지)</li>
<li>만료된 데이터를 백그라운드에서 제거하기</li>
<li>데이터가 언제 만료되는지 알고 있기</li>
<li>만료된 데이터는 가능한 빨리 업데이트하기</li>
<li>페이지네이션, 레이지 로딩 데이터의 성능 최적화</li>
<li>서버 상태의 메모리 관리 및 가비지 콜렉션</li>
<li>쿼리 결과의 구조 공유를 통한 메모이제이션</li>
</ul>
<h1 id="react-query-단점" style="position:relative;"><a href="#react-query-%EB%8B%A8%EC%A0%90" aria-label="react query 단점 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Query 단점</h1>
<ul>
<li>라이브러리 의존성 추가</li>
<li>러닝 커브</li>
<li>Query lifecycle의 이해</li>
</ul>
<h1 id="query의-상태" style="position:relative;"><a href="#query%EC%9D%98-%EC%83%81%ED%83%9C" aria-label="query의 상태 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query의 상태</h1>
<p>React Query를 통해 관리하는 쿼리 데이터는 라이프사이클에 따라 fetching, fresh, stale, inactive, delete 상태를 가집니다.</p>
<ul>
<li>fetching - 요청 중인 쿼리</li>
<li>fresh - 만료되지 않은 쿼리. 컴포넌트가 마운트, 업데이트되어도 데이터를 다시 요청하지 않습니다.(staleTime범위)</li>
<li>stale - 만료된 쿼리. 컴포넌트가 마운트, 업데이트되면 데이터를 다시 요청합니다.(staleTime 종료될 경우)</li>
<li>inactive - 사용하지 않는 쿼리. 일정 시간이 지나면 가비지 컬렉터가 캐시에서 제거합니다.(cacheTime범위)
<ul>
<li>cacheTime이 유지된 상태에서 사이트로 포커스가 다시 올경우 stale 쿼리가 수행되지만, 화면에는 cache된 데이터로 보여주게 된다.</li>
</ul>
</li>
<li>delete - 가비지 컬렉터에 의해 캐시에서 제거된 쿼리(cacheTime 종료될 경우)</li>
</ul>
<h1 id="주요개념" style="position:relative;"><a href="#%EC%A3%BC%EC%9A%94%EA%B0%9C%EB%85%90" aria-label="주요개념 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>주요개념</h1>
<p>다음은 React Query에서 제공하는 API의 기본이 되는 설정입니다.</p>
<ul>
<li><code class="language-text">useQuery</code>(그리고 <code class="language-text">useInfiniteQuery</code>)로 가져온 데이터는 기본적으로 stale 상태가 됩니다.
<ul>
<li><code class="language-text">staleTime</code> 옵션으로 데이터가 stale 상태로 바뀌는데 걸리는 시간을 늘릴 수 있습니다.</li>
</ul>
</li>
<li>stale 쿼리는 다음 경우에 백그라운드에서 다시 가져옵니다.
<ul>
<li>새로운 쿼리 인스턴스가 마운트되었을 때</li>
<li>브라우저 윈도우가 다시 포커스되었을 때</li>
<li>네트워크가 다시 연결되었을 때</li>
<li><code class="language-text">refetchInterval</code> 옵션이 있을 때</li>
</ul>
</li>
<li>활성화된 <code class="language-text">useQuery</code>, <code class="language-text">useInfiniteQuery</code> 인스턴스가 없는 쿼리 결과는 “inactive” 라벨이 붙으며 다음에 사용될 때까지 남아있습니다.
<ul>
<li>inactive 쿼리는 300초(5분) 후에 메모리에서 해제됩니다.</li>
</ul>
</li>
<li>백그라운드에서 3회 이상 실패한 쿼리는 에러 처리됩니다.
<ul>
<li><code class="language-text">retry</code> 옵션으로 쿼리 함수에서 오류 발생시 재시도할 횟수, <code class="language-text">retryDelay</code> 옵션으로 재시도 대기 시간을 설정</li>
</ul>
</li>
<li>쿼리 결과는 memoization을 위해 structural sharing을 사용하며 데이터 reference는 변경되지 않습니다.
<ul>
<li>immutable.js에서 사용하는 기술.(<a href="https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2" target="_blank" rel="nofollow">참고할만한 글</a>)</li>
<li>99.9% 케이스에서는 이 옵션을 끌 필요가 없습니다.</li>
<li>structural sharing은 JSON 호환 데이터에만 적용되며, 다른 타입의 쿼리 결과는 항상 변경되었다고 판단합니다.</li>
</ul>
</li>
</ul>
<h2 id="데이터-가져오기-usequery" style="position:relative;"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-usequery" aria-label="데이터 가져오기 usequery permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터 가져오기 (useQuery)</h2>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>queryKey<span class="token punctuation">,</span> queryFunction<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>queryKey는 쿼리 캐시에 대한 key이며, string, array, object가 가능합니다.</p>
<p>queryFuntion은 Promise를 리턴하는 함수입니다. axios.get 이나 fetch 가 될 수 있습니다.</p>
<p>options 는 useQuery에 대한 옵션으로 cacheTime, staleTime, onSuccess, onError 등을 설정할 수 있습니다.</p>
<h2 id="데이터-업데이트하기-usemutation" style="position:relative;"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%ED%95%98%EA%B8%B0-usemutation" aria-label="데이터 업데이트하기 usemutation permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터 업데이트하기 (useMutation)</h2>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>newTodo <span class="token operator">=></span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/todos'</span><span class="token punctuation">,</span> newTodo<span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handleSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  mutation<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'Do Laundry'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// mutate이 후 의존적인 액션이 있다면 mutateAsync를 사용합니다.</span>
  <span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">mutateAsync</span><span class="token punctuation">(</span>newTodo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setAnotherState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">createAnotherAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>mutation<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>데이터의 CUD에는 useMutation을 사용하면 되고, options도 useQuery와 비슷하게 onSuccess, onError 콜백과 mutate를 호출할 때 실행되는 onMutate 콜백도 있습니다.</p>
<h2 id="쿼리-무효화-invalidation" style="position:relative;"><a href="#%EC%BF%BC%EB%A6%AC-%EB%AC%B4%ED%9A%A8%ED%99%94-invalidation" aria-label="쿼리 무효화 invalidation permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>쿼리 무효화 (Invalidation)</h2>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token function">useQueryClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 캐시에 있는 모든 쿼리를 무효화한다.</span>
queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// todo로 시작하는 모든 쿼리를 무효화한다. ex) ['todos', 1], ['todos', 2], ...</span>
queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ['todos', 1] 키를 가진 쿼리를 무효화한다.</span>
queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>useMutation등으로 업데이트 된 데이터를 다시 가져와야 하는 경우 (캐시를 무효화하고 싶은 경우) invalidateQueries 함수를 사용할 수 있습니다.</p>
<h2 id="개발자-도구-reactquerydevtools" style="position:relative;"><a href="#%EA%B0%9C%EB%B0%9C%EC%9E%90-%EB%8F%84%EA%B5%AC-reactquerydevtools" aria-label="개발자 도구 reactquerydevtools permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>개발자 도구 (ReactQueryDevTools)</h2>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactQueryDevtools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-query/devtools'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// useQuery Hook이 QueryClient에 접근하기 위해 QueryClientProvider를 컴포넌트 트리 상위에 추가해야합니다.</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">QueryClientProvider</span></span> <span class="token attr-name">client</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>queryClient<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Example</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactQueryDevtools</span></span> <span class="token attr-name">initialIsOpen</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">QueryClientProvider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="staletime-vs-cachetime" style="position:relative;"><a href="#staletime-vs-cachetime" aria-label="staletime vs cachetime permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>staleTime vs cacheTime</h1>
<p>컴포넌트A가 마운트 되면서 생성된 인스턴스는 <code class="language-text">staleTime (디폴트 0)</code> 이 지나버렸기 때문에 언마운트 시점에 캐시가 <code class="language-text">inactive</code> 상태가 되었고 컴포넌트B가 마운트 되면서 새로운 인스턴스가 생성되었다.</p>
<p>이 상황에서 <code class="language-text">cacheTime</code> 과 <code class="language-text">staleTime</code> 가 시작되는 시점을 잘못 이해하고 있었다.</p>
<p>쿼리 인스턴스가 마운트 되는 순간에는 <code class="language-text">staleTime</code> 이 시작된다. <code class="language-text">cacheTime</code> 은 쿼리 인스턴스가 완전히 언마운트 되어서 <code class="language-text">inactive</code> 상태가 되고 나면 시작된다.</p>
<p>마운트 되는 시점에 시작된 staleTime에서는 active, fresh한 상태를 가지고 있다.</p>
<p>그러다 staleTime이 끝나면 stale 상태를 가지고 있지만 아직 cacheTime이 시작되는 않는다. (화면에 아직 유효한 데이터가 존재하기 때문에 캐시 타임이 흐르지 않는다)</p>
<p>언마운트 되면서 화면에 존재하던 것들이 사라지고 inactive 상태를 지니면 이제서야 cacheTime이 시작된다. 이 cacheTime 동안에는 정말 캐시로 존재하기 때문에 다시 호출하면 이 캐싱된 데이터를 재사용할 수 있다.</p>
<p>그렇다면 staleTime과 cacheTime의 차이가 정확하게 무엇이였을까?</p>
<p>캐시를 사용하려고 하는건데 그럼 cacheTime만 있으면 되는게 아닌가? (staleTime=0, cacheTime=5분 으로 설정된 디폴트 옵션을 사용하면 되지 않나?)</p>
<p><code class="language-text">staleTime</code> 은 <code class="language-text">fresh -> stale</code> 로 변경되는 시간이다. <code class="language-text">cacheTime</code> 은 <code class="language-text">inactive</code> 한 상태의 쿼리를 캐시로 유지하는 시간이다.</p>
<p>기본값이 <code class="language-text">staleTime=0, cacheTime=5분</code> 인 이유이다.</p>
<p><code class="language-text">staleTime=0</code> 으로 두면서 모든 쿼리가 호출이 끝나면 바로 <code class="language-text">stale</code> 해지고, 다시 호출하면 서버로부터 가져오는 것을 기본으로 하는 것이다.</p>
<p>이때 리액트 쿼리는 캐싱된 데이터로 조금이나마 빠른 응답을 시켜주기 위해 <code class="language-text">cacheTime=5분</code> 으로 기본 설정해주었고, <code class="language-text">stale</code> 해진 쿼리를 서버로부터 다시 <code class="language-text">fresh</code> 한 데이터를 가져오기 전까지 사용할 수 있다.</p>
<h1 id="isfetching-vs-isloading" style="position:relative;"><a href="#isfetching-vs-isloading" aria-label="isfetching vs isloading permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>isFetching vs isLoading</h1>
<p>isFetching은 캐싱 된 데이터 유무에 상관없이 데이터 Fetching 때마다 true를 리턴합니다.</p>
<p>isLoading은 캐싱 된 데이터가 없을 때만 true를 리턴합니다. (initialData 옵션을 설정하면 항상 false를 리턴합니다.)</p>
<p>둘의 차이를 알면 더 적합한 Loading Indicator를 사용할 수 있습니다.</p>
<h1 id="enabled-refetch" style="position:relative;"><a href="#enabled-refetch" aria-label="enabled refetch permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>enabled refetch</h1>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> isFetching<span class="token punctuation">,</span> data<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> error<span class="token punctuation">,</span> refetch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
  <span class="token string">'super-heroes'</span><span class="token punctuation">,</span>
  getSuperHero<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handleClickRefetch <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">refetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>refetch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>data<span class="token operator">?.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hero<span class="token operator">:</span> Data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>hero<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>hero<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClickRefetch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Fetch Heroes</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li><code class="language-text">enabled</code>는 쿼리가 자동으로 실행되지 않도록 할 때 설정할 수 있다. <code class="language-text">false</code>를 주면 자동 실행되지 않는다. 또한 useQuery 리턴 데이터중 status가 idle 상태로 시작한다.</li>
<li><code class="language-text">refetch</code>는 쿼리를 <code class="language-text">수동</code>으로 다시 요청하는 기능이다. 쿼리 오류가 발생하면 오류만 기록된다. 오류를 발생시키려면 <code class="language-text">throwOnError</code>속성을 <code class="language-text">true</code>로해서 전달해야 한다.</li>
<li>보통 자동으로 쿼리 요청을 하지 않고 버튼 클릭이나 특정 이벤트를 통해 요청을 시도할 때 같이 사용한다.</li>
<li>만약 <code class="language-text">enabled: false</code>를 줬다면 <code class="language-text">queryClient</code>가 쿼리를 다시 가져오는 방법들 중 <code class="language-text">invalidateQueries</code>와 <code class="language-text">refetchQueries</code>를 무시한다.</li>
</ul>
<h1 id="infinite-scroll-pagination" style="position:relative;"><a href="#infinite-scroll-pagination" aria-label="infinite scroll pagination permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Infinite scroll, pagination</h1>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> inView <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  status<span class="token punctuation">,</span>
  data<span class="token punctuation">,</span>
  error<span class="token punctuation">,</span>
  isFetching<span class="token punctuation">,</span>
  isFetchingNextPage<span class="token punctuation">,</span>
  isFetchingPreviousPage<span class="token punctuation">,</span>
  fetchNextPage<span class="token punctuation">,</span>
  fetchPreviousPage<span class="token punctuation">,</span>
  hasNextPage<span class="token punctuation">,</span>
  hasPreviousPage<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'projects'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> pageParam <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/projects?cursor='</span> <span class="token operator">+</span> pageParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">getPreviousPageParam</span><span class="token operator">:</span> firstPage <span class="token operator">=></span> firstPage<span class="token punctuation">.</span>previousId <span class="token operator">??</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> lastPage <span class="token operator">=></span> lastPage<span class="token punctuation">.</span>nextId <span class="token operator">??</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>inView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetchNextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inView<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="참고" style="position:relative;"><a href="#%EC%B0%B8%EA%B3%A0" aria-label="참고 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고</h1>
<ul>
<li>
<p>효과적인 query key 관리: <a href="https://www.zigae.com/react-query-key/" target="_blank" rel="nofollow">https://www.zigae.com/react-query-key/</a></p>
</li>
<li>
<p>class component에도 React Query를 적용할 수 있나요?</p>
<ul>
<li><a href="https://stackoverflow.com/questions/65609409/how-can-i-use-react-query-in-a-react-class-component" target="_blank" rel="nofollow">https://stackoverflow.com/questions/65609409/how-can-i-use-react-query-in-a-react-class-component</a></li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">UseQuery</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token function">useQuery</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>key<span class="token punctuation">,</span> props<span class="token punctuation">.</span>fn<span class="token punctuation">,</span> props<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UseQuery</span></span>
  <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“todos”</span>
  <span class="token attr-name">fn</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">options</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> staleTime<span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span></span>
<span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>query <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UseQuery</span></span><span class="token punctuation">></span></span></code></pre></div>
</li>
<li>
<p>쿼리 결과에 의존하는 다른 쿼리를 호출해야하는 경우?</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// 쿼리 config의 enabled 사용. enabled가 true 일 때만 쿼리를 호출</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> email<span class="token punctuation">]</span><span class="token punctuation">,</span> getUserByEmail<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> userID <span class="token operator">=</span> user<span class="token operator">?.</span>id<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> isIdle<span class="token punctuation">,</span> data<span class="token operator">:</span> projects <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'projects'</span><span class="token punctuation">,</span> userID<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getProjectsByUser</span><span class="token punctuation">(</span>userID<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// The query will not execute until the userId exists</span>
    enabled<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>userID<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// isIdle will be `true` until `enabled` is true and the query begins to fetch.</span>
<span class="token comment">// It will then go to the `isLoading` stage and hopefully the `isSuccess` stage :)</span></code></pre></div>
</li>
</ul>
<h1 id="참고페이지" style="position:relative;"><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80" aria-label="참고페이지 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고페이지</h1>
<ul>
<li><a href="https://jiggag.github.io/blog/react-query-cache-is-alive/" target="_blank" rel="nofollow">리액트 쿼리, 캐시가 살아있다</a></li>
<li><a href="https://tech.kakao.com/2022/06/13/react-query/" target="_blank" rel="nofollow">My구독의 React Query 전환기</a></li>
<li><a href="https://github.com/ssi02014/react-query-tutorial" target="_blank" rel="nofollow">https://github.com/ssi02014/react-query-tutorial</a></li>
<li><a href="https://github.com/ssi02014/react-query-tutorial#enabled-refetch" target="_blank" rel="nofollow">GitHub - ssi02014/react-query-tutorial: 😃 react-query 자주 사용되는 개념 정리</a></li>
</ul></article><section class="PostContent__PostNavigator-sc-9jovib-6 eozcVb"><a href="/blog/2023/01/2023-01-01-fe-process/"><h5>이전글</h5><i>← </i>FE 개발 프로세스</a><a href="/blog/2022/08/2022-08-07-cypress/"><h5>다음글</h5>cypress<i> →</i></a></section><div></div></div><aside class="PostContent__TocRenderer-sc-9jovib-4 cbTbsU"><ul>
<li>
<p><a href="#%EA%B0%9C%EC%9A%94">개요</a></p>
</li>
<li>
<p><a href="#%EC%84%9C%EB%B2%84-%EC%83%81%ED%83%9C">서버 상태</a></p>
</li>
<li>
<p><a href="#react-query-%EC%9E%A5%EC%A0%90">React Query 장점</a></p>
</li>
<li>
<p><a href="#react-query-%EB%8B%A8%EC%A0%90">React Query 단점</a></p>
</li>
<li>
<p><a href="#query%EC%9D%98-%EC%83%81%ED%83%9C">Query의 상태</a></p>
</li>
<li>
<p><a href="#%EC%A3%BC%EC%9A%94%EA%B0%9C%EB%85%90">주요개념</a></p>
<ul>
<li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-usequery">데이터 가져오기 (useQuery)</a></li>
<li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%ED%95%98%EA%B8%B0-usemutation">데이터 업데이트하기 (useMutation)</a></li>
<li><a href="#%EC%BF%BC%EB%A6%AC-%EB%AC%B4%ED%9A%A8%ED%99%94-invalidation">쿼리 무효화 (Invalidation)</a></li>
<li><a href="#%EA%B0%9C%EB%B0%9C%EC%9E%90-%EB%8F%84%EA%B5%AC-reactquerydevtools">개발자 도구 (ReactQueryDevTools)</a></li>
</ul>
</li>
<li>
<p><a href="#staletime-vs-cachetime">staleTime vs cacheTime</a></p>
</li>
<li>
<p><a href="#isfetching-vs-isloading">isFetching vs isLoading</a></p>
</li>
<li>
<p><a href="#enabled-refetch">enabled refetch</a></p>
</li>
<li>
<p><a href="#infinite-scroll-pagination">Infinite scroll, pagination</a></p>
</li>
<li>
<p><a href="#%EC%B0%B8%EA%B3%A0">참고</a></p>
</li>
<li>
<p><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80">참고페이지</a></p>
</li>
</ul></aside></div><div class="Footer__FooterWrapper-sc-rphy7j-0 iqMMNl">Thank You for Visiting My Blog,<br/>© 2021 Developer SeungAh, Powered By Gatsby.</div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2022/12/2022-12-30-react-query/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-3f569fefb0788f5a0023.js\"],\"component---src-components-templates-post-template-tsx\":[\"/component---src-components-templates-post-template-tsx-d9d3da42943c44af159e.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-4d52495227296e18c78a.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-ed4d3b150f6b0138dbea.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-95992269d7f74c02239a.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="c3210c92db98a47d2773";</script><script src="/webpack-runtime-7612a97d8f43392f6335.js" async></script><script src="/framework-a96385c61229616bc6a1.js" async></script><script src="/app-3f569fefb0788f5a0023.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>