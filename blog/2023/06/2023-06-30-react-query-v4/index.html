<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.3"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style data-styled="" data-styled-version="6.1.8">.jxgAQZ{display:flex;flex:1;position:relative;margin:0 auto;align-items:start;width:1024px;max-width:1024px;}/*!sc*/
@media (max-width:1024px){.jxgAQZ{margin:0;width:auto;}}/*!sc*/
data-styled.g1[id="PostContent__PostWrapper-sc-9jovib-0"]{content:"jxgAQZ,"}/*!sc*/
.cLFlWp{border-bottom:1px solid #e6e6e6;}/*!sc*/
.cLFlWp>div{display:flex;flex:1;align-items:center;justify-content:space-between;margin:0 auto;max-width:1024px;padding:0 20px;}/*!sc*/
@media (max-width:1024px){.cLFlWp>div{margin:0;min-width:auto;}}/*!sc*/
.cLFlWp h1{font-size:24px;margin:12px 0 8px;}/*!sc*/
data-styled.g2[id="PostContent__PostHeadWrapper-sc-9jovib-1"]{content:"cLFlWp,"}/*!sc*/
.dyxwBB{width:80%;}/*!sc*/
@media (max-width:1024px){.dyxwBB{width:100%;}}/*!sc*/
data-styled.g3[id="PostContent__PostContentWrapper-sc-9jovib-2"]{content:"dyxwBB,"}/*!sc*/
.ceUAYl{padding:0 20px;margin-bottom:48px;}/*!sc*/
.ceUAYl>h1{margin-bottom:8px;font-size:40px;}/*!sc*/
data-styled.g4[id="PostContent__PostTitle-sc-9jovib-3"]{content:"ceUAYl,"}/*!sc*/
.dFYyrf{display:inline-block;margin:12px 0 0 10px;position:sticky;top:20px;left:10px;transition:all 0.125s esse-in 0s;color:rgba(0,0,0,0.4);padding:0 0.75rem;border-left:2px solid gray;overflow-y:auto;overflow-x:hidden;}/*!sc*/
.dFYyrf ul{list-style:none;}/*!sc*/
.dFYyrf ul li{margin-top:5px;}/*!sc*/
.dFYyrf ul li a{display:inline-block;}/*!sc*/
.dFYyrf ul li a.reach{color:#000000;}/*!sc*/
.dFYyrf ul ul{margin-left:12px;}/*!sc*/
@media (max-width:1024px){.dFYyrf{display:none;}}/*!sc*/
data-styled.g5[id="PostContent__TocRenderer-sc-9jovib-4"]{content:"dFYyrf,"}/*!sc*/
.kkFPBR{display:flex;flex-direction:column;word-break:keep-all;margin-bottom:250px;padding:0 20px;width:100%;line-height:1.8;font-size:16px;font-weight:400;}/*!sc*/
@media (max-width:1024px){.kkFPBR{margin-bottom:48px;}}/*!sc*/
.kkFPBR p{padding:3px 0;}/*!sc*/
.kkFPBR h1,.kkFPBR h2,.kkFPBR h3{font-weight:800;}/*!sc*/
.kkFPBR *+h1{margin-top:60px;}/*!sc*/
.kkFPBR *+h2{margin-top:40px;}/*!sc*/
.kkFPBR *+h3{margin-top:30px;}/*!sc*/
.kkFPBR hr+h1,.kkFPBR hr+h2,.kkFPBR hr+h3{margin-top:0;}/*!sc*/
.kkFPBR h1{font-size:30px;}/*!sc*/
.kkFPBR h2{font-size:25px;}/*!sc*/
.kkFPBR h3{font-size:20px;}/*!sc*/
.kkFPBR blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}/*!sc*/
.kkFPBR ol,.kkFPBR ul{margin-left:20px;padding:10px 0;}/*!sc*/
.kkFPBR hr{border:1px solid #000000;margin:100px 0;}/*!sc*/
.kkFPBR a{color:#4263eb;text-decoration:underline;}/*!sc*/
.kkFPBR pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}/*!sc*/
.kkFPBR pre[class*='language-'] ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.5);border-radius:3px;}/*!sc*/
.kkFPBR code[class*='language-'],.kkFPBR pre[class*='language-']{tab-size:2;}/*!sc*/
.kkFPBR img{width:100%;}/*!sc*/
.kkFPBR summary{cursor:pointer;font-size:24px;}/*!sc*/
data-styled.g6[id="PostContent__MarkdownRenderer-sc-9jovib-5"]{content:"kkFPBR,"}/*!sc*/
.gjJjeX{margin:40px 0;display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0 20px;}/*!sc*/
.gjJjeX h5{font-size:24px;margin-bottom:8px;}/*!sc*/
.gjJjeX a{border-radius:6px;font-size:20px;color:#cc007a;font-weight:700;}/*!sc*/
data-styled.g7[id="PostContent__PostNavigator-sc-9jovib-6"]{content:"gjJjeX,"}/*!sc*/
.htrznL{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.7);color:#161b21;width:40px;height:40px;min-width:40px;font-size:20px;border:none;border-radius:50%;}/*!sc*/
.htrznL>img{width:35px;height:35px;}/*!sc*/
data-styled.g8[id="PostContent__SocialLink-sc-9jovib-7"]{content:"htrznL,"}/*!sc*/
.gwEjGB{display:grid;place-items:center;margin-top:auto;margin-left:0;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}/*!sc*/
@media (max-width:1024px){.gwEjGB{margin-left:0;}}/*!sc*/
data-styled.g16[id="Footer__FooterWrapper-sc-rphy7j-0"]{content:"gwEjGB,"}/*!sc*/
html{line-height:1.15;-webkit-text-size-adjust:100%;}/*!sc*/
body{margin:0;}/*!sc*/
main{display:block;}/*!sc*/
h1{font-size:2em;margin:0.67em 0;}/*!sc*/
hr{box-sizing:content-box;height:0;overflow:visible;}/*!sc*/
pre{font-family:monospace,monospace;font-size:1em;}/*!sc*/
a{background-color:transparent;}/*!sc*/
abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp{font-family:monospace,monospace;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
img{border-style:none;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
button,input{overflow:visible;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;}/*!sc*/
button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}/*!sc*/
button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}/*!sc*/
fieldset{padding:0.35em 0.75em 0.625em;}/*!sc*/
legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
textarea{overflow:auto;}/*!sc*/
[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}/*!sc*/
[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
details{display:block;}/*!sc*/
summary{display:list-item;}/*!sc*/
template{display:none;}/*!sc*/
[hidden]{display:none;}/*!sc*/
*{padding:0;margin:0;box-sizing:border-box;}/*!sc*/
html,body,#___gatsby{height:100%;word-break:keep-all;overflow-wrap:break-word;}/*!sc*/
#gatsby-focus-wrapper{height:100%;}/*!sc*/
a,a:hover{color:inherit;text-decoration:none;cursor:pointer;}/*!sc*/
.utterances{max-width:1024px;margin:0 auto;}/*!sc*/
data-styled.g18[id="sc-global-dhQtTb1"]{content:"sc-global-dhQtTb1,"}/*!sc*/
.fexRTD{display:flex;flex-direction:column;height:100%;}/*!sc*/
data-styled.g19[id="Template__Container-sc-1a9t0ug-0"]{content:"fexRTD,"}/*!sc*/
</style><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://seungahhong.github.io/blog/2023/06/2023-06-30-react-query-v4/" data-baseprotocol="https:" data-basehost="seungahhong.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-TYGQRJE1B8', 'auto', {});
      
      
      
      
      
      }</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G8Z1HZWWYL"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G8Z1HZWWYL', {"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Template__Container-sc-1a9t0ug-0 fexRTD"><header class="PostContent__PostHeadWrapper-sc-9jovib-1 cLFlWp"><div><a href="/"><h1>홍승아블로그</h1></a><a href="https://github.com/seungahhong" rel="noopener noreferrer" title="notion" target="_blank" size="35" class="PostContent__SocialLink-sc-9jovib-7 htrznL"><img src="/static/4a6687a74051de2b3536e95d0b6c992a/github.svg" alt="Github Link Image"/></a></div></header><div class="PostContent__PostWrapper-sc-9jovib-0 jxgAQZ"><div class="PostContent__PostContentWrapper-sc-9jovib-2 dyxwBB"><div class="PostContent__PostTitle-sc-9jovib-3 ceUAYl"><h1>react-query(v4)</h1><time>2023.06.30</time></div><article class="PostContent__MarkdownRenderer-sc-9jovib-5 kkFPBR"><h1 id="install" style="position:relative;"><a href="#install" aria-label="install permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install</h1>
<h2 id="react-quey--tanstackreact-query로-변경" style="position:relative;"><a href="#react-quey--tanstackreact-query%EB%A1%9C-%EB%B3%80%EA%B2%BD" aria-label="react quey  tanstackreact query로 변경 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-quey → @tanstack/react-query로 변경</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> uninstall react-query
<span class="token function">npm</span> <span class="token function">install</span> @tanstack/react-query
<span class="token function">npm</span> <span class="token function">install</span> @tanstack/react-query-devtools</code></pre></div>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// v3</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactQueryDevtools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-query/devtools'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClientProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-query/react'</span><span class="token punctuation">;</span>

<span class="token comment">// v4</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactQueryDevtools <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query-devtools'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClientProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query/reactjs'</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="지원범위" style="position:relative;"><a href="#%EC%A7%80%EC%9B%90%EB%B2%94%EC%9C%84" aria-label="지원범위 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>지원범위</h1>
<ul>
<li>
<p>typescript</p>
<ul>
<li>TypeScript v4.1 or greater</li>
</ul>
</li>
<li>
<p>Supported Browsers</p>
<ul>
<li>v4부터 React Query는 최신 브라우저에 최적화</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">Chrome <span class="token operator">>=</span> <span class="token number">73</span><span class="token punctuation">;</span>
Firefox <span class="token operator">>=</span> <span class="token number">78</span><span class="token punctuation">;</span>
Edge <span class="token operator">>=</span> <span class="token number">79</span><span class="token punctuation">;</span>
Safari <span class="token operator">>=</span> <span class="token number">12.0</span><span class="token punctuation">;</span>
iOS <span class="token operator">>=</span> <span class="token number">12.0</span><span class="token punctuation">;</span>
opera <span class="token operator">>=</span> <span class="token number">53</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>Support for React 18</li>
</ul>
<h1 id="v3--v4-migraion-toolscodemod" style="position:relative;"><a href="#v3--v4-migraion-toolscodemod" aria-label="v3  v4 migraion toolscodemod permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>v3 → v4 migraion tools: <strong><a href="https://tanstack.com/query/v4/docs/react/guides/migrating-to-react-query-4#codemod" target="_blank" rel="nofollow">Codemod</a></strong></h1>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># jsx/js 인 경우</span>
npx jscodeshift ./path/to/src/ <span class="token punctuation">\</span><span class="token punctuation">\</span>
  <span class="token parameter variable">--extensions</span><span class="token operator">=</span>js,jsx <span class="token punctuation">\</span><span class="token punctuation">\</span>
  <span class="token parameter variable">--transform</span><span class="token operator">=</span>./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js

<span class="token comment"># tsx/ts 인 경우</span>
npx jscodeshift ./path/to/src/ <span class="token punctuation">\</span><span class="token punctuation">\</span>
  <span class="token parameter variable">--extensions</span><span class="token operator">=</span>ts,tsx <span class="token punctuation">\</span><span class="token punctuation">\</span>
  <span class="token parameter variable">--parser</span><span class="token operator">=</span>tsx <span class="token punctuation">\</span><span class="token punctuation">\</span>
  <span class="token parameter variable">--transform</span><span class="token operator">=</span>./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js</code></pre></div>
<h1 id="new-features" style="position:relative;"><a href="#new-features" aria-label="new features permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New Features</h1>
<h2 id="the-idle-state-has-been-removed" style="position:relative;"><a href="#the-idle-state-has-been-removed" aria-label="the idle state has been removed permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The idle state has been removed</h2>
<ul>
<li>
<p>오프라인 지원을 개선하기 위해 새로운 fetchStatus가 도입</p>
</li>
<li>
<p>동일한 상태를 더 잘 캡처하는 fetchStatus: ‘idle’로 인해 idle state는 불필요해짐</p>
<ul>
<li>
<p><strong><code class="language-text">status</code></strong>: <code class="language-text">data</code>, 쿼리 결과값에 대한 정보를 나타냄</p>
<ul>
<li>loading: 아직 data가 없음</li>
<li>error: data는 없고 에러가 있음</li>
<li>success: data가 있음</li>
</ul>
</li>
<li>
<p><strong><code class="language-text">fetchStatus</code></strong>: <code class="language-text">queryFn</code>에 대한 정보를 나타냄</p>
<ul>
<li>idle: 쿼리가 아무것도 안하고 있는 상태</li>
<li>paused: 쿼리가 패칭을 시도했지만 일시중지된 상태. network mode와 연관</li>
<li>fetching: 쿼리가 패칭중인 상태</li>
</ul>
</li>
<li>
<p>v3에서 background refetch 상황에서는 패칭에 대한 상태값을 isLoading으로 알 수가 없어서 isFetching을 사용</p>
<ul>
<li>isFetching 외에 fetchStatus.fetching 사용가능</li>
<li>status가 query의 상태를 제대로 표현할 수 없었던 것이죠.</li>
<li>비활성화된 쿼리(사용하지 않는 쿼리)에 대한 초기 상태값이 isLoading 변경</li>
<li>isLoading → isInitialLoading</li>
<li>캐시된 데이터가 없는(isLoading) 쿼리를 요청(isFetching)하면 isInitialLoading === true</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isSuccess<span class="token operator">:</span> q1Succeed <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> q2Data<span class="token punctuation">,</span> isLoading<span class="token operator">:</span> q2Loading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery2</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> q1Succeed<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> q3Data<span class="token punctuation">,</span> isLoading<span class="token operator">:</span> q3Loading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery3</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> q1Succeed<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> refetch<span class="token operator">:</span> q4Refetch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery4</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>q2Loading <span class="token operator">||</span> q3Loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>q2Data<span class="token punctuation">.</span>tmpData<span class="token punctuation">}</span><span class="token plain-text"> / </span><span class="token punctuation">{</span>q3Data<span class="token punctuation">.</span>tmpData<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// useQuery1	useQuery2	useQuery3	useQuery4</span>
<span class="token comment">// 1	idle	  idle	    idle	    idle</span>
<span class="token comment">// 2	loading	idle	    idle	    idle</span>
<span class="token comment">// 3	success	idle	    idle	    idle</span>
<span class="token comment">// 4	success	loading	  loading	  idle</span>
<span class="token comment">// 5	success	success	  success	  idle</span></code></pre></div>
<h2 id="queries-and-mutations-per-default-need-network-connection-to-run" style="position:relative;"><a href="#queries-and-mutations-per-default-need-network-connection-to-run" aria-label="queries and mutations per default need network connection to run permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Queries and mutations, per default, need network connection to run</h2>
<ul>
<li>query와 mutation의 명시적인 오프라인 모드를 제공하는 기능인 networkMode 옵션이 추가</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  defaultOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    queries<span class="token operator">:</span> <span class="token punctuation">{</span>
      networkMode<span class="token operator">:</span> <span class="token string">'offlineFirst'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
      networkMode<span class="token operator">:</span> <span class="token string">'offlineFirst'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>
<p>networkMode의 설정값은 3가지입니다.</p>
<ul>
<li><strong><code class="language-text">online</code></strong>: 오프라인 상태에서 network connection이 있기 전까지 fetch를 하지 않고, 이때 쿼리의 상태를 <code class="language-text">fetchStatus:paused</code> 로 표시합니다.</li>
<li><strong><code class="language-text">always</code></strong>: 오프라인 상태에서도 온라인처럼 fetch를 시도합니다. 오프라인 상태에서 요청을 보내는 것이니 <code class="language-text">status:error</code> 상태가 될 겁니다.</li>
<li><strong><code class="language-text">offlineFirst</code></strong>: v3에서의 동작과 같습니다. queryFn 최초 호출 후 retry를 멈춥니다.</li>
</ul>
</li>
</ul>
<h2 id="tracked-query-per-default성능개선" style="position:relative;"><a href="#tracked-query-per-default%EC%84%B1%EB%8A%A5%EA%B0%9C%EC%84%A0" aria-label="tracked query per default성능개선 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tracked Query per default(성능개선)</h2>
<ul>
<li>
<p><a href="https://github.com/TanStack/query/discussions/1554" target="_blank" rel="nofollow">Tracked Query</a>: useQuery의 리턴값 중, 실질적으로 직접 접근하는 값들이 변했을때만 리렌더링이 되게끔 하는 최적화 처리</p>
</li>
<li>
<p>v4부터는 이 처리가 없이도 <a href="https://github.com/TanStack/query/discussions/1554" target="_blank" rel="nofollow">자체적으로 query를 proxy처리하고</a>, 컴포넌트에서 어떤 값에 접근하는지 판단하여 해당 값을 렌더링 처리해줌.</p>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// v3</span>
<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> fetchUser<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// notifyOnChangeProps: ['data'], // data가 바뀌었을 때만 리렌더링</span>
    notifyOnChangeProps<span class="token operator">:</span> <span class="token string">'tracked'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Username: </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// v4</span>
<span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// notifyOnChangeProps가 없어도 data가 바뀌었을 때만 리렌더링</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> fetchUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Username: </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="change-features" style="position:relative;"><a href="#change-features" aria-label="change features permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Change Features</h1>
<h2 id="new-api-for-usequeries" style="position:relative;"><a href="#new-api-for-usequeries" aria-label="new api for usequeries permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>new API for useQueries</h2>
<ul>
<li>useQueries에 여러개 쿼리를 넘길 때 방식의 변화</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// v3</span>
<span class="token function">useQueries</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> queryKey1<span class="token punctuation">,</span> queryFn1<span class="token punctuation">,</span> options1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> queryKey2<span class="token punctuation">,</span> queryFn2<span class="token punctuation">,</span> options2 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// v4</span>
<span class="token function">useQueries</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  queries<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> queryKey1<span class="token punctuation">,</span> queryFn1<span class="token punctuation">,</span> options1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> queryKey2<span class="token punctuation">,</span> queryFn2<span class="token punctuation">,</span> options2 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="query-keys-and-mutation-keys-need-to-be-an-array쿼리키는-배열만-가능" style="position:relative;"><a href="#query-keys-and-mutation-keys-need-to-be-an-array%EC%BF%BC%EB%A6%AC%ED%82%A4%EB%8A%94-%EB%B0%B0%EC%97%B4%EB%A7%8C-%EA%B0%80%EB%8A%A5" aria-label="query keys and mutation keys need to be an array쿼리키는 배열만 가능 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query Keys (and Mutation Keys) need to be an Array(쿼리키는 배열만 가능)</h2>
<ul>
<li>
<p>Query key (혹은 Mutation Key)가 배열로 변경</p>
</li>
<li>
<p>v3에서 key는 String | Array 둘 다 가능했다. 하지만 v4에서는 Array 형태만 가능</p>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// v3</span>
<span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> fetchTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// v4</span>
<span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fetchTodos<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="onsuccess-is-no-loger-called-from-setquerydata" style="position:relative;"><a href="#onsuccess-is-no-loger-called-from-setquerydata" aria-label="onsuccess is no loger called from setquerydata permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>onSuccess is no loger called from setQueryData</h2>
<ul>
<li>
<p>onSuccess 콜백이 setQueryData를 호출했을 때 더이상 호출되지 않습니다.</p>
</li>
<li>
<p>onSuccess 콜백은 실질적인 요청이 발생한 후에만 호출됩니다.</p>
</li>
<li>
<p>data가 바뀐 것을 실질적으로 구독하고 싶다면 onSuccess → useEffect 사용 권고</p>
</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> queryKey<span class="token punctuation">,</span> queryFn <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">mySideEffectHere</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="undefined-is-an-illegal-cache-value-for-successful-queriesqueryfn-undefined-리턴-불가" style="position:relative;"><a href="#undefined-is-an-illegal-cache-value-for-successful-queriesqueryfn-undefined-%EB%A6%AC%ED%84%B4-%EB%B6%88%EA%B0%80" aria-label="undefined is an illegal cache value for successful queriesqueryfn undefined 리턴 불가 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Undefined is an illegal cache value for successful queries(queryFn undefined 리턴 불가)</h2>
<p><code class="language-text">queryFn</code>이 <code class="language-text">undefined</code>를 리턴할 수 없도록 타입, 런타임 단에서 막힘</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// ❌</span>
<span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="the-cancel-method-on-promises-is-no-longer-supported" style="position:relative;"><a href="#the-cancel-method-on-promises-is-no-longer-supported" aria-label="the cancel method on promises is no longer supported permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The cancel method on promises is no longer supported</h2>
<ul>
<li>
<p>query cancellation 지원을 위해서 사용되던 cancel 메서드 사용안됨</p>
</li>
<li>
<p>대신 쿼리 취소를 위해서는 내부적으로 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" rel="nofollow">AbortController API</a>를 사용하고 쿼리 취소를 지원하기 위해 쿼리 함수에 대한 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" target="_blank" rel="nofollow">AbortSignal instance</a>를 제공하는 <a href="https://tanstack.com/query/v4/docs/react/guides/query-cancellation" target="_blank" rel="nofollow">newer API</a>(v3.30.0에 도입됨)를 사용을 권고</p>
</li>
</ul>
<h2 id="logging-in-production" style="position:relative;"><a href="#logging-in-production" aria-label="logging in production permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logging in production</h2>
<ul>
<li>production 모드에서는 로깅 처리 비활성(개발 모드에서는 오류 표시)</li>
</ul>
<h2 id="setlogger-is-removed" style="position:relative;"><a href="#setlogger-is-removed" aria-label="setlogger is removed permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>setLogger is removed</h2>
<ul>
<li>전역으로 세팅했던 로그에 대한 활성화 사용법 변경</li>
</ul>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// v3</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClient<span class="token punctuation">,</span> setLogger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span><span class="token punctuation">;</span>
<span class="token function">setLogger</span><span class="token punctuation">(</span>customLogger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// v4</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span> logger<span class="token operator">:</span> customLogger <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="react-router-dom-v6-연동" style="position:relative;"><a href="#react-router-dom-v6-%EC%97%B0%EB%8F%99" aria-label="react router dom v6 연동 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-router-dom v6 연동</h1>
<p><a href="https://tanstack.com/query/v4/docs/react/examples/react/react-router" target="_blank" rel="nofollow">https://tanstack.com/query/v4/docs/react/examples/react/react-router</a></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  defaultOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    queries<span class="token operator">:</span> <span class="token punctuation">{</span>
      staleTime<span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    element<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Root</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
    errorElement<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorPage</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token function">rootLoader</span><span class="token punctuation">(</span>queryClient<span class="token punctuation">)</span><span class="token punctuation">,</span>
    action<span class="token operator">:</span> <span class="token function">rootAction</span><span class="token punctuation">(</span>queryClient<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="참고페이지" style="position:relative;"><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80" aria-label="참고페이지 permalink" class="custom-class before"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고페이지</h1>
<ul>
<li><a href="https://tanstack.com/query/v4/docs/react/guides/migrating-to-react-query-4" target="_blank" rel="nofollow">https://tanstack.com/query/v4/docs/react/guides/migrating-to-react-query-4</a></li>
<li><a href="https://nuhends.tistory.com/134" target="_blank" rel="nofollow">https://nuhends.tistory.com/134</a></li>
<li><a href="https://maxkim-j.github.io/posts/tanstack-query-v4-preview/" target="_blank" rel="nofollow">https://maxkim-j.github.io/posts/tanstack-query-v4-preview/</a></li>
</ul></article><section class="PostContent__PostNavigator-sc-9jovib-6 gjJjeX"><a href="/blog/2023/07/2023-07-22-zustand/"><h5>이전글</h5><i>← </i>zustand</a><a href="/blog/2023/04/2023-04-02-playwright/"><h5>다음글</h5>Playwright<i> →</i></a></section><div></div></div><aside class="PostContent__TocRenderer-sc-9jovib-4 dFYyrf"><ul>
<li>
<p><a href="#install">Install</a></p>
<ul>
<li><a href="#react-quey--tanstackreact-query%EB%A1%9C-%EB%B3%80%EA%B2%BD">react-quey → @tanstack/react-query로 변경</a></li>
</ul>
</li>
<li>
<p><a href="#%EC%A7%80%EC%9B%90%EB%B2%94%EC%9C%84">지원범위</a></p>
</li>
<li>
<p><a href="#v3--v4-migraion-toolscodemod">v3 → v4 migraion tools: <strong>Codemod</strong></a></p>
</li>
<li>
<p><a href="#new-features">New Features</a></p>
<ul>
<li><a href="#the-idle-state-has-been-removed">The idle state has been removed</a></li>
<li><a href="#queries-and-mutations-per-default-need-network-connection-to-run">Queries and mutations, per default, need network connection to run</a></li>
<li><a href="#tracked-query-per-default%EC%84%B1%EB%8A%A5%EA%B0%9C%EC%84%A0">Tracked Query per default(성능개선)</a></li>
</ul>
</li>
<li>
<p><a href="#change-features">Change Features</a></p>
<ul>
<li><a href="#new-api-for-usequeries">new API for useQueries</a></li>
<li><a href="#query-keys-and-mutation-keys-need-to-be-an-array%EC%BF%BC%EB%A6%AC%ED%82%A4%EB%8A%94-%EB%B0%B0%EC%97%B4%EB%A7%8C-%EA%B0%80%EB%8A%A5">Query Keys (and Mutation Keys) need to be an Array(쿼리키는 배열만 가능)</a></li>
<li><a href="#onsuccess-is-no-loger-called-from-setquerydata">onSuccess is no loger called from setQueryData</a></li>
<li><a href="#undefined-is-an-illegal-cache-value-for-successful-queriesqueryfn-undefined-%EB%A6%AC%ED%84%B4-%EB%B6%88%EA%B0%80">Undefined is an illegal cache value for successful queries(queryFn undefined 리턴 불가)</a></li>
<li><a href="#the-cancel-method-on-promises-is-no-longer-supported">The cancel method on promises is no longer supported</a></li>
<li><a href="#logging-in-production">Logging in production</a></li>
<li><a href="#setlogger-is-removed">setLogger is removed</a></li>
</ul>
</li>
<li>
<p><a href="#react-router-dom-v6-%EC%97%B0%EB%8F%99">react-router-dom v6 연동</a></p>
</li>
<li>
<p><a href="#%EC%B0%B8%EA%B3%A0%ED%8E%98%EC%9D%B4%EC%A7%80">참고페이지</a></p>
</li>
</ul></aside></div><div class="Footer__FooterWrapper-sc-rphy7j-0 gwEjGB">Thank You for Visiting My Blog,<br/>© 2021 Developer SeungAh, Powered By Gatsby.</div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2023/06/2023-06-30-react-query-v4/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-eb342060903654dce2c2.js\"],\"component---src-components-templates-post-template-tsx\":[\"/component---src-components-templates-post-template-tsx-723e7b035cf0d2b0658c.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-22d84f1f3fa9bb01b3c3.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-5cfd1d934041f3be9b53.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-6eda80b6301364e9743b.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="b27c6141cef71e4dd07d";</script><script src="/webpack-runtime-7295481a8fc0d625c5ab.js" async></script><script src="/framework-8d4464cf751c05b8bed6.js" async></script><script src="/app-eb342060903654dce2c2.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>